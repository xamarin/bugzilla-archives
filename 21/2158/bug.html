<html lang="en"><head>
    <title>2158 – [GTK] crash in find_window_for_ns_event</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style>/* js/yui/assets/skins/sam/autocomplete.css */
.yui-skin-sam .yui-ac{position:relative;font-family:arial;font-size:100%}.yui-skin-sam .yui-ac-input{position:absolute;width:100%}.yui-skin-sam .yui-ac-container{position:absolute;top:1.6em;width:100%}.yui-skin-sam .yui-ac-content{position:absolute;width:100%;border:1px solid #808080;background:#fff;overflow:hidden;z-index:9050}.yui-skin-sam .yui-ac-shadow{position:absolute;margin:.3em;width:100%;background:#000;-moz-opacity:.10;opacity:.10;filter:alpha(opacity=10);z-index:9049}.yui-skin-sam .yui-ac iframe{opacity:0;filter:alpha(opacity=0);padding-right:.3em;padding-bottom:.3em}.yui-skin-sam .yui-ac-content ul{margin:0;padding:0;width:100%}.yui-skin-sam .yui-ac-content li{margin:0;padding:2px 5px;cursor:default;white-space:nowrap;list-style:none;zoom:1}.yui-skin-sam .yui-ac-content li.yui-ac-prehighlight{background:#b3d4ff}.yui-skin-sam .yui-ac-content li.yui-ac-highlight{background:#426fd9;color:#FFF}
/* js/yui/assets/skins/sam/calendar.css */
.yui-calcontainer{position:relative;float:left;_overflow:hidden}.yui-calcontainer iframe{position:absolute;border:0;margin:0;padding:0;z-index:0;width:100%;height:100%;left:0;top:0}.yui-calcontainer iframe.fixedsize{width:50em;height:50em;top:-1px;left:-1px}.yui-calcontainer.multi .groupcal{z-index:1;float:left;position:relative}.yui-calcontainer .title{position:relative;z-index:1}.yui-calcontainer .close-icon{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar{position:relative}.yui-calendar .calnavleft{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar .calnavright{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar .calheader{position:relative;width:100%;text-align:center}.yui-calcontainer .yui-cal-nav-mask{position:absolute;z-index:2;margin:0;padding:0;width:100%;height:100%;_width:0;_height:0;left:0;top:0;display:none}.yui-calcontainer .yui-cal-nav{position:absolute;z-index:3;top:0;display:none}.yui-calcontainer .yui-cal-nav .yui-cal-nav-btn{display:-moz-inline-box;display:inline-block}.yui-calcontainer .yui-cal-nav .yui-cal-nav-btn button{display:block;*display:inline-block;*overflow:visible;border:0;background-color:transparent;cursor:pointer}.yui-calendar .calbody a:hover{background:inherit}p#clear{clear:left;padding-top:10px}.yui-skin-sam .yui-calcontainer{background-color:#f2f2f2;border:1px solid #808080;padding:10px}.yui-skin-sam .yui-calcontainer.multi{padding:0 5px 0 5px}.yui-skin-sam .yui-calcontainer.multi .groupcal{background-color:transparent;border:0;padding:10px 5px 10px 5px;margin:0}.yui-skin-sam .yui-calcontainer .title{background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;border-bottom:1px solid #ccc;font:100% sans-serif;color:#000;font-weight:bold;height:auto;padding:.4em;margin:0 -10px 10px -10px;top:0;left:0;text-align:left}.yui-skin-sam .yui-calcontainer.multi .title{margin:0 -5px 0 -5px}.yui-skin-sam .yui-calcontainer.withtitle{padding-top:0}.yui-skin-sam .yui-calcontainer .calclose{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -300px;width:25px;height:15px;top:.4em;right:.4em;cursor:pointer}.yui-skin-sam .yui-calendar{border-spacing:0;border-collapse:collapse;font:100% sans-serif;text-align:center;margin:0}.yui-skin-sam .yui-calendar .calhead{background:transparent;border:0;vertical-align:middle;padding:0}.yui-skin-sam .yui-calendar .calheader{background:transparent;font-weight:bold;padding:0 0 .6em 0;text-align:center}.yui-skin-sam .yui-calendar .calheader img{border:0}.yui-skin-sam .yui-calendar .calnavleft{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -450px;width:25px;height:15px;top:0;bottom:0;left:-10px;margin-left:.4em;cursor:pointer}.yui-skin-sam .yui-calendar .calnavright{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -500px;width:25px;height:15px;top:0;bottom:0;right:-10px;margin-right:.4em;cursor:pointer}.yui-skin-sam .yui-calendar .calweekdayrow{height:2em}.yui-skin-sam .yui-calendar .calweekdayrow th{padding:0;border:0}.yui-skin-sam .yui-calendar .calweekdaycell{color:#000;font-weight:bold;text-align:center;width:2em}.yui-skin-sam .yui-calendar .calfoot{background-color:#f2f2f2}.yui-skin-sam .yui-calendar .calrowhead,.yui-skin-sam .yui-calendar .calrowfoot{color:#a6a6a6;font-size:85%;font-style:normal;font-weight:normal;border:0}.yui-skin-sam .yui-calendar .calrowhead{text-align:right;padding:0 2px 0 0}.yui-skin-sam .yui-calendar .calrowfoot{text-align:left;padding:0 0 0 2px}.yui-skin-sam .yui-calendar td.calcell{border:1px solid #ccc;background:#fff;padding:1px;height:1.6em;line-height:1.6em;text-align:center;white-space:nowrap}.yui-skin-sam .yui-calendar td.calcell a{color:#06c;display:block;height:100%;text-decoration:none}.yui-skin-sam .yui-calendar td.calcell.today{background-color:#000}.yui-skin-sam .yui-calendar td.calcell.today a{background-color:#fff}.yui-skin-sam .yui-calendar td.calcell.oom{background-color:#ccc;color:#a6a6a6;cursor:default}.yui-skin-sam .yui-calendar td.calcell.oom a{color:#a6a6a6}.yui-skin-sam .yui-calendar td.calcell.selected{background-color:#fff;color:#000}.yui-skin-sam .yui-calendar td.calcell.selected a{background-color:#b3d4ff;color:#000}.yui-skin-sam .yui-calendar td.calcell.calcellhover{background-color:#426fd9;color:#fff;cursor:pointer}.yui-skin-sam .yui-calendar td.calcell.calcellhover a{background-color:#426fd9;color:#fff}.yui-skin-sam .yui-calendar td.calcell.previous{color:#e0e0e0}.yui-skin-sam .yui-calendar td.calcell.restricted{text-decoration:line-through}.yui-skin-sam .yui-calendar td.calcell.highlight1{background-color:#cf9}.yui-skin-sam .yui-calendar td.calcell.highlight2{background-color:#9cf}.yui-skin-sam .yui-calendar td.calcell.highlight3{background-color:#fcc}.yui-skin-sam .yui-calendar td.calcell.highlight4{background-color:#cf9}.yui-skin-sam .yui-calendar a.calnav{border:1px solid #f2f2f2;padding:0 4px;text-decoration:none;color:#000;zoom:1}.yui-skin-sam .yui-calendar a.calnav:hover{background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;border-color:#a0a0a0;cursor:pointer}.yui-skin-sam .yui-calcontainer .yui-cal-nav-mask{background-color:#000;opacity:.25;filter:alpha(opacity=25)}.yui-skin-sam .yui-calcontainer .yui-cal-nav{font-family:arial,helvetica,clean,sans-serif;font-size:93%;border:1px solid #808080;left:50%;margin-left:-7em;width:14em;padding:0;top:2.5em;background-color:#f2f2f2}.yui-skin-sam .yui-calcontainer.withtitle .yui-cal-nav{top:4.5em}.yui-skin-sam .yui-calcontainer.multi .yui-cal-nav{width:16em;margin-left:-8em}.yui-skin-sam .yui-calcontainer .yui-cal-nav-y,.yui-skin-sam .yui-calcontainer .yui-cal-nav-m,.yui-skin-sam .yui-calcontainer .yui-cal-nav-b{padding:5px 10px 5px 10px}.yui-skin-sam .yui-calcontainer .yui-cal-nav-b{text-align:center}.yui-skin-sam .yui-calcontainer .yui-cal-nav-e{margin-top:5px;padding:5px;background-color:#edf5ff;border-top:1px solid black;display:none}.yui-skin-sam .yui-calcontainer .yui-cal-nav label{display:block;font-weight:bold}.yui-skin-sam .yui-calcontainer .yui-cal-nav-mc{width:100%;_width:auto}.yui-skin-sam .yui-calcontainer .yui-cal-nav-y input.yui-invalid{background-color:#ffee69;border:1px solid #000}.yui-skin-sam .yui-calcontainer .yui-cal-nav-yc{width:4em}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn{border:1px solid #808080;background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;background-color:#ccc;margin:auto .15em}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn button{padding:0 8px;font-size:93%;line-height:2;*line-height:1.7;min-height:2em;*min-height:auto;color:#000}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn.yui-default{border:1px solid #304369;background-color:#426fd9;background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 -1400px}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn.yui-default button{color:#fff}
/* skins/standard/global.css */
body {font-family: sans-serif;color: #000;background: #fff url(../../skins/standard/global/body-back.gif) repeat-x;}body, td, th, input, dt, #titles {font-family: Verdana, sans-serif;font-size: small;}pre, code, kbd {font-size: medium;}#bugzilla-body {clear: both;}#bugzilla-body th {font-weight: bold;vertical-align: top;}#header {margin-bottom: 1em;}#header form, #header form input,#footer form, #footer form input{font-size: 95%;display: inline;}#header .links {border-left: 1px solid #747E93;border-right: 1px solid #747E93;border-bottom: 1px solid #747E93;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;padding: 0.5em;}#lang_links_container {float: right;white-space: nowrap;}#lang_links_container .links {border: none;padding: .5em;}.lang_current {font-weight: bold;}#message {border: 1px solid red;margin: 0.3em 0em;padding: 0.3em;color: green;}form.mini_login input.bz_login  {width: 10em;}form.mini_login input.bz_password {width: 6em;}form.mini_login input.bz_remember {margin: 0;}#banner {}#titles {width: 100%;background-color: #404D6C;color: #fff;border-top-left-radius: 5px;border-top-right-radius: 5px;margin: 0;vertical-align: bottom;display: table;}#titles a {color: #fff;}#titles p {margin: 0;padding: 0;}#titles #title {font-weight: bold;padding: 0.5em;white-space: nowrap;display: table-cell;}#titles #subtitle {font-weight: normal;text-align: center;padding: 0.5em;display: table-cell;}#titles #information {font-weight: normal;text-align: right;font-size: 90%;padding: 0.5em;white-space: nowrap;display: table-cell;}#footer {clear: both;margin-top: 1em;width: 100%;background: #edf2f2;border-top: 1px solid #ddd;border-bottom: 1px solid #ddd;}#footer #useful-links {padding-left: 1ex;padding-right: 1ex;}#footer ul {list-style-type: none;}#links-saved ul {display: inline;}#links-saved th {vertical-align: top;}#footer .label {white-space: nowrap;vertical-align: top;}#footer .links {vertical-align: top;}ul.links {margin: 0;padding: 0;list-style-type: none;}ul.links li {display: inline;white-space: nowrap;}table.tabs {width: 100%;}.tabs th, .tabs td {padding: 1em;}.tabs td {background: #eee;text-align: center;border-style: solid;border-color: black;border-width: 0px 0px 2px 0px;}.tabs td.selected {background: white;border-width: 2px 2px 0px 2px;}.tabs td.spacer {background: white;}a {color: #039;}a:visited {color: #636;}a:hover {color: #333;}a:active {color: #000;}.clickable_area {cursor: pointer;}textarea {font-family: monospace;}a.controller {font-size: 115%;}div#docslinks {float: right;border: 1px solid black;padding: 1ex;font-size: 80%;}#docslinks h2 {margin: 0;}.rss {background: transparent url(../../skins/standard/../../images/rss_small.png) no-repeat;padding-left: 16px;line-height: 1.5em;}.bz_bug_link {}.bz_bug_link.bz_status_UNCONFIRMED {font-style: italic;}.bz_obsolete {text-decoration: line-through;}.bz_inactive {text-decoration: line-through;}.bz_closed,.bz_CLOSED td {text-decoration: line-through;}.bz_private {color: darkred;background: #f3eeee;}.bz_disabled {color: #a0a0a0;}.bz_comment_table td {vertical-align: top;}.bz_comment {margin-bottom: 2em;}.bz_comment_text, .uneditable_textarea, tbody.file pre {font-family: monospace;white-space: pre-wrap;}.bz_comment_text {width: 50em;}.bz_comment_text span.quote {color: #65379c;white-space: pre;overflow: auto;display: block;}.bz_comment_user, .bz_comment_time, .bz_comment_number,.bz_private_checkbox, .bz_comment_actions{margin: 0 .5em;}.bz_comment_actions, .bz_comment_number, .bz_private_checkbox {float: right;}.bz_collapse_expand_comments {padding: 0;margin: 0 0 0 1em;list-style-type: none;}.bz_collapse_expand_comments li {margin-bottom: .5em;}.bz_collapse_comment {text-decoration: none;}.bz_private_checkbox input {margin: 0;vertical-align: middle;}.bz_comment_head, .bz_first_comment_head {padding-top: .1em;padding-bottom: .1em;padding-left: .5em;background-color: #e0e0e0;}.bz_comment_user_images img {vertical-align: bottom;}.bz_comment_hilite pre {background-color: lightgreen;margin: 0;padding: 1em 0;}.bz_comment_collapse_reason,.bz_default_collapsed .bz_comment_number {font-weight: normal;}.bz_default_hidden, .bz_tui_hidden, .bz_hidden_field, .bz_hidden_option {display: none !important;}table#flags th,table#flags td {vertical-align: middle;text-align: left;}#email_prefs, #saved_search_prefs, #shared_search_prefs,#bug_activity {border: 1px solid black;border-collapse: collapse;}#email_prefs th,#shared_search_prefs th,#saved_search_prefs th {text-align: center;}#email_prefs th, #email_prefs td,#shared_search_prefs th, #shared_search_prefs td,#saved_search_prefs th, #saved_search_prefs td,#bug_activity td {border: 1px solid;padding: 0.3em;}#email_prefs th.role_header {width: 10%;}#bug_activity td {vertical-align: top;}#user_prefs th, #user_prefs td {padding: 0.5em;}#permissions {margin-left: auto;margin-right: auto;width: 40em;}#permissions p {margin-top: 2em;margin-bottom: 0.5em;}#permissions li {list-style-type: none;}#permissions table td {vertical-align: top;}.column_header {background-color: #66f;}.column_header th {text-align: center;}.flag_select {min-width: 3em;}input.requestee {width: 15em;}#error_msg {font-size: x-large;}#post_err_msg, form#check {clear: both;}.warning {color: red;}.throw_error {background-color: red;color: black;font-size: 120%;margin-bottom: 2em;padding: 0.5em 1em;float: left;}.label {font-weight: bold;}.throw_error a:visited {color: darkblue ;}dt {font-weight: bold;}body > dl > dt {border-top: dotted gray thin;}dl dl > dt {border-top: none;}.arrow_button {font-size: 150%;}#attachment_table {border-collapse: collapse;border: 1px solid #333333;}#attachment_table th, .bz_attach_footer, .bz_time_tracking_table th,.dependency_tree_controls {background-color: #E0E0E0;color: black;}#attachment_table td, .bz_time_tracking_table th, .bz_time_tracking_table td {border: 1px solid #333333;}#attachment_table th, #attachment_table td {padding: 0.3em;}.bz_attach_extra_info, .bz_info {font-size: smaller;}.bz_attach_flags, .bz_attach_footer, .bz_flags, .nowrap {white-space: nowrap;}.bz_attach_view_hide {float: right;padding-left: 1em;}#user_match_table {border-collapse: collapse;}#user_match_table td {vertical-align: top;border-bottom: 1px solid black;padding: 1em 0.5em;}div.user_match {margin-bottom: 1em;}.indented {margin-left: 3em;}.box {border: 1px solid black;color: black;background-color: #ffc;margin: 1em;padding: 0.5em 1em;}.collapsed,.bz_default_collapsed .bz_private_checkbox,.bz_default_collapsed .bz_comment_user,.bz_default_collapsed .bz_comment_user_images,.bz_default_collapsed .bz_comment_time,.bz_default_collapsed .bz_comment_tags,.bz_default_collapsed .bz_comment_text,.bz_default_collapsed .bz_collapsed_actions{display: none;}#serverpush_msg {margin-top: 20%;text-align: center;font-size: xx-large;}@media print {#header, #footer {display: none;}div.bz_query_buttons {display: none;}body {background-image: none;background-color: #fff;}}.field_label {text-align: right;vertical-align: top;font-weight: bold;}.field_help_link {cursor: help;}.field_value, form#Create th, form#Create td, .top {vertical-align: top;}.bottom {vertical-align: bottom;}.field_value .text_input {width: 100%;min-width: 25em;}.uneditable_textarea {max-width: 30em;font-size: medium;}th.required:before {content: "* ";}th.required:before, span.required_star {color: red;}input.required, select.required, span.required_explanation {background-color: #fff7cd;color: #000;}.calendar_button {background: transparent url(../../skins/standard/global/calendar.png) no-repeat;width: 20px;height: 20px;vertical-align: middle;}.calendar_button span { display: none }.yui-calcontainer {display: none;background-color: white;padding: 10px;border: 1px solid #404D6C;}.bug_urls {margin: 0;padding: 0;list-style-type: none;}pre.field_textarea_readonly {margin: 2px;padding: 4px;overflow: auto;float: left;max-width: 30em;max-height: 7em;border: 1px solid #CCC;font-family: monospace;white-space: pre-wrap;}.yui-skin-sam .yui-ac-input { position:static !important;vertical-align:middle !important; }.yui-skin-sam .yui-ac-container { left:0px !important; }.yui-skin-sam .yui-ac { display: inline-block; }#bugzilla-body .yui-ac-content {max-height: 19em;overflow: auto;overflow-x: hidden;}#keywords_container {padding-top: .2em;}#keywords_container .yui-ac-content {margin-left: -1px;}#comment_tabs {border-spacing: 0;}.comment_tab {display: table-cell;border: 1px solid silver;padding: 2px 1em;cursor: pointer;background: transparent;}.active_comment_tab {background: #fff;font-weight: bold;}#comment_preview {border: 1px solid silver;padding: 1px;overflow: auto;margin: 0px;}#comment_preview_text {margin: 0px;width: auto;}#comment_preview_loading {font-style: italic;}#comment {margin: 0px 0px 1em 0px;}.validation_error_text {font-size: 120%;color: #B70000;font-weight: bold;}.validation_error_field, input.validation_error_field {border: 2px solid #B70000;background-color: #FFEBEB;}form th {text-align: right;}.left {text-align: left;}.center {text-align: center;}.right {text-align: right;}.middle {vertical-align: middle;}.inline {display: inline;}tr.shared_search {background-color: #fff7cd;color: #000;}.multi-columns {columns: 3;-moz-columns: 3;-webkit-columns: 3;}#page-index {padding: 0.2em 0.2em 0.15em 0.2em;max-width: 1000px;}.intro, .outro {text-align: center;}#new_release {border: 2px solid red;padding: 0.5em 1em;margin: 1em;font-weight: bold;}#new_release .notice {font-size: 80%;font-weight: normal;}#welcome-admin a {font-weight: bold;}.bz_common_actions {text-align: center;}.bz_common_actions ul {list-style-type: none;padding: 0;}.bz_common_actions ul li {display: inline;vertical-align: top;}.bz_common_actions ul li a {display: inline-block;height: 170px;width: 145px;margin: 0 2ex 2em 0;}.bz_common_actions ul li a span {position: relative;top: 90%;font-weight: bold;}.bz_common_actions a,.bz_common_actions a:visited,.bz_common_actions a:hover {text-decoration: none;}#enter_bug { background: url(../../skins/standard/index/file-a-bug.png)  no-repeat; }#query     { background: url(../../skins/standard/index/search.png)      no-repeat; }#account   { background: url(../../skins/standard/index/new-account.png) no-repeat; }#help      { background: url(../../skins/standard/index/help.png)        no-repeat; }#quicksearchForm {clear: both;text-align: center;margin-bottom: 2em;}#quicksearchForm #quicksearch_main {width: 27em;}#quicksearchForm {margin: 0;padding: 0;}#page-index table {border-collapse: collapse;margin: auto;}#welcome {font-size: x-large;font-weight: bold;text-align: center;margin: 0 0 0.8em 0;padding: 0;}#common_queries ul {list-style: none;padding-left: 1.5em;}#common_queries li a {text-decoration: none;}ul#quicksearch_links {margin-bottom: 1em;}ul.additional_links {list-style: none;margin: 0;padding: 0;}ul.additional_links li {display: inline;}ul.additional_links li.bz_default_hidden {display: none;}body.narrow_page #bugzilla-body > * {max-width: 45em;}.req_new {color: red;}.req_table {border-collapse: collapse;}.req_table td, .req_table th {border: 1px solid black;padding: .25em;}.qs_help li {margin-top: 1ex;}.qs_fields th {padding: 0 .25em;}.qs_fields th.field_nickname {text-align: left;}.qs_fields td {padding: .25em;border-top: 1px solid gray;}.qs_fields .field_name {width: 10em;}table.field_value_explanation {table-layout: fixed;border-collapse: collapse;}.field_value_explanation thead h2 {margin: 0;}.field_value_explanation .header_row td {text-align: center;font-size: 120%;font-weight: bold;}.field_value_explanation tbody td {border: 1px solid black;padding: 1em;}.field_value_explanation dt, .field_descriptions dt {margin-top: 1em;}.field_descriptions dt {font-size: 120%;}#duplicates_table {border-collapse: collapse;}#duplicates_table .resolved {background-color: #d9d9d9;color: black;}#duplicates_table thead tr {background-color: #ccc;color: black;}#duplicates_table thead tr th {vertical-align: middle;}#duplicates_table td, #duplicates_table th {border: 1px solid black;padding: .1em .25em;}#duplicates_table tbody td {text-align: center;}#duplicates_table tbody td.short_desc {text-align: left;}
/* skins/standard/bug.css */
.enter_bug_form table {border-spacing: 0;border-width: 0;}.enter_bug_form td, .enter_bug_form th {padding: .25em;}.enter_bug_form th {text-align: right;}#Create #field_container_component {width: 1px;}#Create #field_container_reporter {width: 100%;}#Create .comment, #guided_form #description {vertical-align: top;overflow: auto;color: green;}#guided_form #description {display: inline;margin-left: 10px;}#Create #comp_desc_container td {padding: 0;}#Create #comp_desc {height: 11ex;}#Create #os_guess_note {padding-top: 0;}#Create #os_guess_note div {max-width: 35em;}#Create .field_value .text_input {max-width: 50em;}#possible_duplicates th {text-align: center;background: none;border-collapse: collapse;}#possible_duplicates td {vertical-align: middle;}#possible_duplicates .yui-dt-col-update_token {white-space: nowrap;}table#flags th, table#flags td,table#bug_flags th, table#bug_flags td,table#attachment_flags th, table#attachment_flags td {text-align: left;vertical-align: baseline;font-size: small;}.guided_form_field {background-color: #ffc;}#somebugs {width: 100%;height: 500px;}.good {color: #090;}.bad {color: #900;}.bz_short_desc_container {margin: 8px 0;padding: 0.3em;background-color: rgb(208, 208, 208);border-radius: 0.5em;font-size: 125%;font-weight: bold;}.bz_bug .edit_form {width: 100%;}.bz_bug .edit_form table {width: 100%;}.bz_bug #alias {min-width: 0;width: 10em;}table#flags {width: auto;}.bz_column_spacer {width: 0.5em;}.related_actions {font-size: 0.85em;float: right;list-style-type: none;white-space: nowrap;margin: 0;padding: 0;}.related_actions li {display: inline;}.navigation_link {color: #777;font-style: italic;}.bz_show_bug_column {vertical-align: top;}.bz_section_spacer {height: 1em;}#duplicate_settings {white-space: nowrap;}#bz_big_form_parts td {vertical-align: top;}.bz_group_visibility_section {margin-left: 1em;}.bz_group_visibility_section .instructions {font-style: italic;}#bz_restrict_group_visibility_help .instructions {margin-top: 0;}#bz_enable_role_visibility_help {margin-top: 1em;}.bz_time_tracking_table {border-collapse: collapse;}.bz_time_tracking_table th {text-align: center;}.bz_time_tracking_table td {text-align: center;}.bz_time_tracking_table th,.bz_time_tracking_table td {padding: 4px;}.bz_time_tracking_table .bz_summarize_time {text-align: right;}.bz_time_tracking_table #deadline {width: 7em;}#summary tr td {vertical-align:top;}#status {margin-bottom: 3ex;}.knob-buttons {float: right;}.text_input, .bz_userfield, #keywords_container, #tag_container {width: 100%;}.bz_bug .bz_short_desc_container {width: inherit;}.bz_comment_tags {margin-top: 3px;}.bz_comment_tag {border: 1px solid #c8c8ba;padding: 1px 3px;margin-right: 2px;border-radius: 0.5em;background-color: #eee;color: #000;}#bz_ctag_div {display: inline-block;}#bz_ctag_error {border: 1px solid #ff6666;padding: 0px 2px;border-radius: 0.5em;margin: 2px;display: inline-block;}#comment_tags_collapse_expand_container {padding-top: 1em;}#comment_tags_collapse_expand {list-style-type: none;padding-left: 1em;}#comment_tags_collapse_expand li {margin-bottom: 0px;}ul.tree {padding-left: 0em;margin-left: 1em;display: block;}ul.tree ul {padding-top: 3px;display: block;}ul.tree li {padding-top: 3px;text-indent: -1.2em;padding-left: 0.5em;padding-bottom: 3px;list-style-type: none;background: url(../../skins/standard/dependency-tree/bug-item.png) no-repeat;}ul.tree li a.b {padding-left: 30px;margin-right: -14px;text-decoration: none;}ul.tree li a.b_open {background: url(../../skins/standard/dependency-tree/tree-open.png) center no-repeat;cursor: pointer;}ul.tree li a.b_closed {background: url(../../skins/standard/dependency-tree/tree-closed.png) center no-repeat;cursor: pointer;}ul.tree a.tree_link img {border: 0;}.summ_info {display: none;font-size: 75%;}.hint {font-size: 90%;margin: 0.2em;padding: 0.1em;}.hint h3, .hint ul {margin-top: 0.1em;margin-bottom: 0.1em;}.summ A, .summ_deep A {text-decoration: none;color: darkblue;}.summ_h A {background-color: #ffffaa;color: #333;font-weight: bold;}.dependency_tree_controls input[type=submit] {min-width: 3em;}table.attachment_entry th {text-align: right;vertical-align: baseline;white-space: nowrap;}table.attachment_entry td {text-align: left;vertical-align: baseline;padding-bottom: 5px;}.file_head {font-weight: bold;font-size: 1em;background-color: #c3c3c3;border: 1px solid black;}.file_head a {text-decoration: none;font-family: monospace;font-size: 1.1em;}.file_collapse {display: none;}.section_head {background-color: #f0f0f0;border: 1px solid black;text-align: left;padding: 0.2em;}.section_head .link_here {float: right;padding-left: 1em;padding-right: 0.5em;}.lines_count a {padding-left: 0.5em;padding-right: 1em;}table.file_table {table-layout: fixed;width: 100%;empty-cells: show;border-spacing: 0px;border-collapse: collapse;border-bottom: 1px solid black;}tbody.file pre {display: inline;font-size: 0.9em;}tbody.file pre:empty {display: block;}.changed {background-color: lightblue;}.added {background-color: lightgreen;}.removed {background-color: #FFCC99;}.num {background-color: #ffe9ae;text-align:right;padding: 0 0.3em;width: 3em;}table.attachment_info th {text-align: right;vertical-align: top;}table.attachment_info td {text-align: left;vertical-align: top;}#noview {text-align: left;vertical-align: middle;}#attachment_attributes div {padding-bottom: 0.4em;}#attachment_attributes label {font-weight: bold;}#attachment_attributes .block {display: block;}#smallCommentFrame, #attachment_flags {float: left;}#smallCommentFrame {margin-right: 1.5em;}#attachment_comments_and_flags, #attachment_actions {clear: both;margin-bottom: 1ex;}#attachment_information_read_only .title {font-weight: bold;font-size: 1.5em;padding: 0;margin: 0;}#attachment_information_read_only .title #bz_edit {font-size: 0.7em;}#attachment_information_read_only .details {font-size: 90%;}#attachment_info.read #attachment_information_edit {display: none;}#attachment_info.edit #attachment_information_read_only {display: none;}#attachment_info.edit #attachment_view_window {float: left;width: 80%;}#attachment_info.edit #attachment_information_edit {width: 20%;}#attachment_info.edit #attachment_information_edit input.text,#attachment_info.edit #attachment_information_edit textarea {width: 90%;}#attachment_isobsolete {padding-right: 1em;}#attachment_information_edit {float: left;}#smallCommentFrame textarea {display: block;}textarea.bz_private {border: 1px solid #F8C8BA;}#update {clear: both;display: block;}div#update_container {clear: both;padding: 1.5em 0;}#attachment_flags {margin-bottom: 1em;}#attachment_flags p {padding-bottom: 0;margin-bottom: 0;}#editFrame, #viewDiffFrame, #viewFrame {height: 400px;width: 95%;margin-left: 2%;}.viewall_frame_container {width: 75%;margin: 2em auto;}.viewall_desc {width: 100%;border: 1px solid black;border-spacing: 0px;border-collapse: collapse;}.viewall_desc th, .viewall_desc td {border: 1px solid black;padding: 0.3em;}.viewall_frame {width: 100%;height: 350px;}.no_javascript .bz_hide, .no_javascript .bz_edit {display: none;}#hidden_obsolete_message {text-align: left;width: 75%;margin: 0  auto;font-weight: bold;}
/* skins/contrib/Dusk/global.css */
body {background: #c8c8c8;font-family: Helvetica, Arial, Geneva;padding-left: 1em;padding-right: 1em;}#titles {border-top-left-radius: 5px;border-top-right-radius: 5px;}#header .links, #footer {background-color: #929bb1;color: #ddd;}#header {border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;border: none;}#header a, #footer a {color: white;text-decoration: none;}#header a:hover, #footer a:hover {text-decoration: underline;}#bugzilla-body {background: #f0f0f0;color: black;border: 1px solid #747e93;padding: 10px;font-size: 10pt;border-radius: 5px;}a {color: #6070cf;}a:hover {color: #8090ef;}hr {border-color: #969696;border-style: dashed;border-width: 1px;margin-top: 10px;}#bug-form td {padding-top: 2px;}#attachment-list {border: 2px solid #c8c8ba;font-size: 9pt;}#attachment-list th {background-color: #e6e6d8;border: none;border-bottom: 1px solid #c8c8ba;text-align: left;}#attachment-list th a {color: #646456;}#attachment-list td {border: none;}#attachment-list-actions td {border-top: 1px solid #c8c8ba;}#comments th {font-size: 9pt;font-weight: bold;padding-top: 5px;padding-right: 5px;padding-bottom: 10px;text-align: right;vertical-align: top;white-space: nowrap;}#comments td {padding-top: 2px;}.reply-button a {padding-left: 2px;padding-right: 2px;}.bz_comment {background-color: #e8e8e8;margin: 1px 1px 10px 1px;border-width: 1px;border-style: solid;border-color: #c8c8ba;padding: 5px;font-size: 9pt;}.bz_comment_head, .bz_first_comment_head {margin: 0; padding: 0;background-color: transparent;font-weight: bold;}.bz_comment_user {margin-left: 0;}.bz_comment.bz_private {background-color: #f0e8e8;border-color: #f8c8ba;}.comment_rule {display: none;}#footer {border: 1px solid #747e93;width: 100%;border-radius: 5px;}#footer #links-actions,#footer #links-edit,#footer #links-saved,#footer #links-special {margin-top: 2ex;}#footer .links {border-spacing: 30px;margin-bottom: 2ex;}.separator {color: #cccccc;}.tabbed .tabbody {background: #f8f8f8;padding: 1em;border-style: solid;border-color: #000000;border-width: 0 3px 3px 1px;}.tabs {margin: 0;padding: 0;border-collapse: collapse;}.tabs td {background: #c8c8c8;border-width: 1px;}.tabs td.selected {background: #f8f8f8;border-width: 1px 3px 0 1px;}.tabs td.spacer {background: transparent;border-top: none;border-left: none;border-right: none;}.bz_row_odd {background-color: #f0f0f0;}#page-index .outro {clear:both;}@media print {#header,#footer,.navigation {display: none;}body {background-image: none;background-color: #ffffff;}#bugzilla-body {border: none;margin: 0;padding: 0;}}
</style>

<style>/* skins/custom/global.css */
#banner > div {border-radius: 5px;}#banner a {color: #6070cf}
</style>

    


    


    

    
    <link rel="search" type="application/opensearchdescription+xml" title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><link href="https://c.s-microsoft.com/mscc/statics/mscc-0.4.1.min.css" rel="stylesheet" type="text/css">

      

    <style>.wrapper {
    margin: 0 auto;
    box-sizing: border-box;
    -ms-box-sizing: border-box;
}

#global-footer {
    background-color: #354b60;
}

#global-footer li,#global-footer ul {
    list-style: none;
    padding: 0;
    border: 0;
    margin: 0;
    font: inherit;
    color: inherit;
    line-height: normal
}

#global-footer footer {
    margin-top: 60px;
    background: rgba(44,62,80,.5);
    clear: both;
    padding: 30px;
    margin: 0;
    font-size: 14px;
    color: #ecf0f1;
}

#global-footer footer .wrapper {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -ms-flex-align: center;
    /* align-items:center; */
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
}

#global-footer footer .microsoft-logo img {
    display: block;
    margin: 0 auto;
    width: 110px;
}

#global-footer footer .contact {
    text-align: left
}

#global-footer footer .legal {
    text-align: right
}

#global-footer footer a,#global-footer footer span {
    padding: 0 10px
}

#global-footer footer a {
    color: inherit;
    text-decoration: none;
}

#global-footer footer a:hover {
    color: #fff;
    text-decoration: none;
}

#global-footer .sub-footer {
    background-color: #233140;
    color: hsla(0,0%,100%,.7);
    font-size: 14px;
    padding: 3px;
    -webkit-font-smoothing: antialiased;
    -moz-font-smoothing: antialiased
}

@media (max-width: 992px) {
    html:not(.non-responsive) #global-footer footer {
        padding:0
    }

    html:not(.non-responsive) #global-footer footer .wrapper {
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        max-width: 430px
    }

    html:not(.non-responsive) #global-footer footer .microsoft-logo {
        -webkit-box-ordinal-group: 1;
        -ms-flex-order: 0;
        order: 0
    }

    html:not(.non-responsive) #global-footer footer .wrapper>:not(.microsoft-logo) {
        -webkit-box-ordinal-group: 2;
        -ms-flex-order: 1;
        order: 1
    }

    html:not(.non-responsive) #global-footer footer .contact,html:not(.non-responsive) #global-footer footer .legal,html:not(.non-responsive) #global-footer footer .microsoft-logo {
        float: none;
        padding: 20px 0;
        text-align: center
    }

    html:not(.non-responsive) #global-footer footer .contact,html:not(.non-responsive) #global-footer footer .legal {
        padding-top: 0
    }
}
</style>
  </head>

  <body class="bugzilla-xamarin-com
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_Xamarin_Studio
                 bz_component_General
                 bz_bug_2158 yui-skin-sam">

  <div id="header">

    <div id="titles">
      <span id="title">Bugzilla – Bug&nbsp;2158</span>

        <span id="subtitle" class="subheader">[GTK] crash in find_window_for_ns_event</span>

        <span id="information" class="header_addl_info">Last modified: 2013-05-29 15:11:28 UTC</span>
    </div>


    <div id="common_links">
    </div>
  </div>

  <div id="bugzilla-body">




<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2013-05-29 15:11:28">
  <input type="hidden" name="id" value="2158">
  <input type="hidden" name="token" value="1559139009-L3RCjzXhncxDdVoQ9fBK5HnDoMrz227aOkf2KlQ9DZQ">
<div class="bz_short_desc_container edit_form">
     <a href="bug.html"><b>Bug&nbsp;2158</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">[GTK] crash in find_window_for_ns_event</span>
     </span>

    <div id="summary_input"><span class="field_label " id="field_label_short_desc">


  <a title="The bug summary is a short sentence which succinctly describes what the bug is about." class="field_help_link" href="#">Summary:</a>

</span>[GTK] crash in find_window_for_ns_event
    </div>
  </div>
  
  <table class="edit_form">
    <tbody><tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">
        <table>
          <tbody><tr>
    <th class="field_label">
      <a href="#">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_alias">


  <a title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla." class="field_help_link" href="#">Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_product">


  <a title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list." class="field_help_link" href="#">Product:</a>

</th>
  <td class="field_value " id="field_container_product">Xamarin Studio

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label " id="field_label_classification">


  <a title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation." class="field_help_link" href="#">Classification:</a>

</th>
  <td class="field_value " id="field_container_classification">Desktop

</td>
    </tr>
    
    
    
    <tr><th class="field_label " id="field_label_component">


  <a title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list." class="field_help_link" href="#">Component:</a>

</th>
  <td class="field_value " id="field_container_component">General

  ()
</td>
    </tr>
    <tr><th class="field_label " id="field_label_version">


  <a title="The version field defines the version of the software the bug was found in." class="field_help_link" href="#">Version:</a>

</th>
<td>Trunk
  </td>
    </tr>
    
    
    
    <tr><th class="field_label " id="field_label_rep_platform">


  <a title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;." class="field_help_link" href="#">Hardware:</a>

</th>
      <td class="field_value">PC
        Mac OS
      </td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
      <th class="field_label">
        <label accesskey="i">
          <a href="#"><u>I</u>mportance</a></label>:
      </th>
      <td>Highest
       critical
      </td>
    </tr>

      <tr><th class="field_label " id="field_label_target_milestone">


  <a title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it." class="field_help_link" href="#">Target Milestone:</a>

</th><td>---
  </td>
      </tr>

          <tr><th class="field_label " id="field_label_assigned_to">


  <a title="The person in charge of resolving the bug." class="field_help_link" href="#">Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Bugzilla</span>
</span>
      </td>
    </tr>

    
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_bug_file_loc">


  <a title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen." class="field_help_link" href="#">URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
    <th class="field_label">
      <label>Duplicates (1)</label>:
    </th>
    <td class="field_value">
      <span id="duplicates"><a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED DUPLICATE - crash (monodevelop 2.8.8.4, mono 2.11, mac os snow leopard)" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4199">4199</a> 
      </span>
      ()
    </td>
  </tr>
<tr><th class="field_label " id="field_label_dependson">


  <a title="The bugs listed here must be resolved before this bug can be resolved." class="field_help_link" href="#">Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>

  <tr><th class="field_label " id="field_label_blocked">


  <a title="This bug must be resolved before the bugs listed in this field can be resolved." class="field_help_link" href="#">Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>

        </tbody></table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tbody><tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2011-11-22 13:37 UTC by <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
    </td>
  </tr>

  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2013-05-29 15:11 UTC
      (<a href="activity.html">History</a>)
    </td>

  </tr>
<tr>
      <th class="field_label">
        <label accesskey="a">
          CC List:
        </label>
      </th>
      <td>6
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="duncan.mak">duncan.mak</option>
                <option value="knocte">knocte</option>
                <option value="kris">kris</option>
                <option value="miguel">miguel</option>
                <option value="mitch">mitch</option>
                <option value="mono-bugs+monodevelop">mono-bugs+monodevelop</option>
            </select>
        </div>
          
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr>
      <th class="field_label " id="field_label_cf_tags">


  <a title="A custom Free Text field in this installation of Bugzilla." class="field_help_link" href="#">Tags:</a>

</th>
  <td class="field_value " id="field_container_cf_tags">gtk

</td>
    </tr>
    <tr>
      <th class="field_label " id="field_label_cf_bug_regression">


  <a title="If this bug is not a regression select no, otherwise select yes and complete the &quot;last known good build&quot; entry." class="field_help_link" href="#">Is this bug a regression?:</a>

</th>
  <td class="field_value " id="field_container_cf_bug_regression">---

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field" id="field_label_cf_bug_regression_build">


  <a title="What is the last known good build? (e.g. C7, 4.5.x, etc.)" class="field_help_link" href="#">Last known good build:</a>

</th>
  <td class="field_value  bz_hidden_field" id="field_container_cf_bug_regression_build">

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </tbody></table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </tbody></table>

  <table id="bz_big_form_parts">
  <tbody><tr>
  <td>

    


<br>
<table id="attachment_table">
  <tbody><tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1373&amp;file=debug%202158.diff" title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch for debugging this issue</span></b></a>

          <span class="bz_attach_extra_info">
              (1.28 KB,
                patch)

            <br>
            <a href="#attach_1373" title="Go to the comment associated with the attachment">2012-02-17 15:16 UTC</a>,

            <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1373&amp;file=debug%202158.diff">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1374&amp;file=debug%202158.diff" title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch for debugging this issue (has a non-useful g_warning removed)</span></b></a>

          <span class="bz_attach_extra_info">
              (1.23 KB,
                patch)

            <br>
            <a href="#attach_1374" title="Go to the comment associated with the attachment">2012-02-17 15:17 UTC</a>,

            <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1374&amp;file=debug%202158.diff">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1644&amp;file=debug%202158.diff" title="View the content of the attachment">
          <b>Almost the same patch, but don't return uninitialized memory</b></a>

          <span class="bz_attach_extra_info">
              (1.30 KB,
                patch)

            <br>
            <a href="#attach_1644" title="Go to the comment associated with the attachment">2012-04-10 11:41 UTC</a>,

            <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1644&amp;file=debug%202158.diff">Details</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2181&amp;file=testtext%20torture.diff" title="View the content of the attachment">
          <b>testtext torture patch</b></a>

          <span class="bz_attach_extra_info">
              (2.12 KB,
                patch)

            <br>
            <a href="#attach_2181" title="Go to the comment associated with the attachment">2012-07-09 19:54 UTC</a>,

            <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2181&amp;file=testtext%20torture.diff">Details</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2182&amp;file=xamarin%202158.diff" title="View the content of the attachment">
          <b>Patch that guards for return a combination of a window and coordinates out of window bounds</b></a>

          <span class="bz_attach_extra_info">
              (3.50 KB,
                patch)

            <br>
            <a href="#attach_2182" title="Go to the comment associated with the attachment">2012-07-09 20:00 UTC</a>,

            <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2182&amp;file=xamarin%202158.diff">Details</a>
        </td>
      </tr>
      <tr id="a6" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2705&amp;file=xamarin%202158%20update%208oct2012.diff" title="View the content of the attachment">
          <b>Updated patch USE WITH CAUTION</b></a>

          <span class="bz_attach_extra_info">
              (4.83 KB,
                patch)

            <br>
            <a href="#attach_2705" title="Go to the comment associated with the attachment">2012-10-08 07:26 UTC</a>,

            <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2705&amp;file=xamarin%202158%20update%208oct2012.diff">Details</a>
        </td>
      </tr>
      <tr id="a7" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2717&amp;file=filter%20out%20button%20press%20on%20window%20frame.patch" title="View the content of the attachment">
          <b>Patch that doesn't break press/release pairing</b></a>

          <span class="bz_attach_extra_info">
              (4.77 KB,
                patch)

            <br>
            <a href="#attach_2717" title="Go to the comment associated with the attachment">2012-10-09 10:50 UTC</a>,

            <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2717&amp;file=filter%20out%20button%20press%20on%20window%20frame.patch">Details</a>
        </td>
      </tr>

  
</tbody></table>
<br>

  </td>
  <td>
  </td>
  </tr></tbody></table>
<hr>

<div id="add_comment" class="bz_section_additional_comments">
<div class="box" style="margin: 1px 1px 10px 1px; max-width: 47.8em">
    <p>
        <strong>Notice (2018-05-24)</strong>: bugzilla.xamarin.com is now in
        <strong>read-only</strong> mode.
    </p>
    <p>
        Please join us on
        <a href="https://developercommunity.visualstudio.com/spaces/8/index.html">
        Visual Studio Developer Community</a> and in the
        <a href="https://github.com/xamarin">Xamarin</a> and
        <a href="https://github.com/mono">Mono</a> organizations on
        GitHub to continue tracking issues. Bugzilla will remain
        available for reference in read-only mode. We will continue to work
        on <strong>open</strong> Bugzilla bugs, copy them to the new locations
        as needed for follow-up, and add the new items under <strong>Related
        Links</strong>.
    </p>
    <p>
        Our sincere thanks to everyone who has contributed on this bug
        tracker over the years. Thanks also for your understanding as we
        make these adjustments and improvements for the future.
    </p>
    <hr><p>
        <strong>Please create a new report</strong> on 
        <a href="https://docs.microsoft.com/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017">Developer Community</a> or <a href="https://github.com/mono/monodevelop/issues">GitHub</a> with
        your current version information, steps to reproduce, and relevant error
        messages or log files if you are hitting an issue that looks similar to
        this resolved bug and you do not yet see a matching new report.
    </p>
</div>

    <div style="margin: 4ex 0">
        <table><tbody><tr><th class="field_label " id="field_label_see_also">


  <a title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields." class="field_help_link" href="#">Related Links:</a>

</th>
  <td class="field_value " id="field_container_see_also">

</td>
    </tr>
        </tbody></table>
    </div>

    <table id="bug_status_bottom" class="status">
        <tbody><tr>
            <th class="field_label">
                <a href="#">Status</a>:
            </th>
            <td><div id="status">RESOLVED

    <noscript><br>resolved as </noscript>

  <span id="resolution_settings">FIXED
  </span>

</div>


            </td>
        </tr>
    </tbody></table>

</div>
    <hr>

  
  <div id="comments">




<!-- This auto-sizes the comments and positions the collapse/expand links
     to the right. -->
<table class="bz_comment_table">
<tbody><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-22 13:37:13 UTC
        </span>

      </div>




<pre class="bz_comment_text">When triggering the GTK context menu in a GtkEntry near the left edge of the screen, I saw the following crash. This was with the tip of the GTK+ 2.24 branch.

Native stacktrace:

	0   mono                                0x000d4e22 mono_handle_native_sigsegv + 376
	1   mono                                0x0000f0e4 mono_sigsegv_signal_handler + 322
	2   libsystem_c.dylib                   0x93ccc59b _sigtramp + 43
	3   ???                                 0xffffffff 0x0 + 4294967295
	4   libgdk-quartz-2.0.0.dylib           0x04b7941d find_window_for_ns_event + 503
	5   libgdk-quartz-2.0.0.dylib           0x04b7a261 gdk_event_translate + 543
	6   libgdk-quartz-2.0.0.dylib           0x04b7a9a2 _gdk_events_queue + 117
	7   libgdk-quartz-2.0.0.dylib           0x04b7b963 gdk_event_dispatch + 57
	8   libglib-2.0.0.dylib                 0x043b9962 g_main_dispatch + 489
	9   libglib-2.0.0.dylib                 0x043baf30 g_main_context_dispatch + 138
	10  libglib-2.0.0.dylib                 0x043bb444 g_main_context_iterate + 1193
	11  libglib-2.0.0.dylib                 0x043bbc3e g_main_loop_run + 956
	12  libgtk-quartz-2.0.0.dylib           0x045c6f13 gtk_dialog_run + 542
	13  ???                                 0x16143464 0x0 + 370422884
	14  ???                                 0x16143420 0x0 + 370422816
	15  ???                                 0x16143294 0x0 + 370422420
	16  ???                                 0x16142a78 0x0 + 370420344
	17  ???                                 0x11ce3d38 0x0 + 298728760
	18  ???                                 0x11ce3ca0 0x0 + 298728608
	19  ???                                 0x11ce3c74 0x0 + 298728564
	20  ???                                 0x11ce3c4c 0x0 + 298728524
	21  ???                                 0x11ce3c2f 0x0 + 298728495
	22  ???                                 0x11ce3bcc 0x0 + 298728396
	23  ???                                 0x0a8d449c 0x0 + 177030300
	24  ???                                 0x0a8f26ec 0x0 + 177153772
	25  ???                                 0x11ce3ad8 0x0 + 298728152
	26  ???                                 0x0dab23c6 0x0 + 229319622
	27  ???                                 0x0bdd0d89 0x0 + 199036297
	28  ???                                 0x0bda163c 0x0 + 198841916
	29  libglib-2.0.0.dylib                 0x043bd069 g_timeout_dispatch + 77
	30  libglib-2.0.0.dylib                 0x043b9962 g_main_dispatch + 489
	31  libglib-2.0.0.dylib                 0x043baf30 g_main_context_dispatch + 138
	32  libglib-2.0.0.dylib                 0x043bb444 g_main_context_iterate + 1193
	33  libglib-2.0.0.dylib                 0x043bbc3e g_main_loop_run + 956
	34  libgtk-quartz-2.0.0.dylib           0x046661b7 gtk_main + 239
	35  ???                                 0x0e33dfec 0x0 + 238280684
	36  ???                                 0x0e33dfb4 0x0 + 238280628
	37  ???                                 0x0e33df94 0x0 + 238280596
	38  ???                                 0x035d1730 0x0 + 56432432
	39  ???                                 0x004eff98 0x0 + 5177240
	40  ???                                 0x004efd9c 0x0 + 5176732
	41  ???                                 0x004efe56 0x0 + 5176918
	42  mono                                0x0000ee9f mono_jit_runtime_invoke + 1332
	43  mono                                0x001ee3a6 mono_runtime_invoke + 137
	44  mono                                0x001f0c60 mono_runtime_exec_main + 585
	45  mono                                0x001effee mono_runtime_run_main + 843
	46  mono                                0x000a5a26 mono_jit_exec + 200
	47  mono                                0x000a5c5d main_thread_handler + 555
	48  mono                                0x000a7d70 mono_main + 6993
	49  mono                                0x00001b2e mono_main_with_options + 536
	50  mono                                0x00001b8d main + 49
	51  mono                                0x000018d9 start + 53</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-22 13:44:24 UTC
        </span>

      </div>




<pre class="bz_comment_text">This might be related to <a class="bz_bug_link 
          bz_status_VERIFIED  bz_closed" title="VERIFIED FIXED - Context menus flaky near left edge of screen" href="https://bugzilla.xamarin.com/show_bug.cgi?id=2157">bug 2157</a>.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeffrey Stedfast</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-01-09 15:21:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">Marking as Lowest w/o a reproducible test case</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Miguel de Icaza [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-01-09 15:39:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">This is still a crasher, upgrading the priority.

This is a Gtk+ issue, so we should discuss with the fine folks at Lanedo for some help.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-09 18:41:54 UTC
        </span>

      </div>




<pre class="bz_comment_text">I saw a similar crash using the Mono beta 2.10.9 with the new GTK. It happened while using the text editor, no obvious trigger.

Process:         mono [1023]
Path:            /Users/USER/*/MonoDevelop.app/Contents/MacOS/bin/monodevelop
Identifier:      com.ximian.monodevelop
Version:         2.8.6 (2.8.6)
Code Type:       X86 (Native)
Parent Process:  launchd [266]

Date/Time:       2012-02-09 18:38:00.149 -0500
OS Version:      Mac OS X 10.7.3 (11D50)
Report Version:  9

Interval Since Last Report:          97421 sec
Crashes Since Last Report:           2
Per-App Interval Since Last Report:  153814 sec
Per-App Crashes Since Last Report:   1
Anonymous UUID:                      8DA76007-2B36-4F78-AD50-63448AF4B9F2

Crashed Thread:  0  Dispatch queue: com.apple.main-thread

Exception Type:  EXC_BAD_ACCESS (SIGABRT)
Exception Codes: KERN_INVALID_ADDRESS at 0x000000008fe00000

VM Regions Near 0x8fe00000:
    CoreServices           000000001f39b000-000000001f735000 [ 3688K] rw-/rwx SM=COW  
--&gt; 
    __TEXT                 000000008fe4d000-000000008fe80000 [  204K] r-x/rwx SM=COW  /usr/lib/dyld

Application Specific Information:
objc[1023]: garbage collection is OFF
abort() called

Thread 0 Crashed:: Dispatch queue: com.apple.main-thread
0   libsystem_kernel.dylib        	0x9bfde9c6 __pthread_kill + 10
1   libsystem_c.dylib             	0x958eef78 pthread_kill + 106
2   libsystem_c.dylib             	0x958dfbdd abort + 167
3   monodevelop                   	0x00093b60 mono_handle_native_sigsegv + 624
4   monodevelop                   	0x000055b8 mono_sigsegv_signal_handler + 248
5   libsystem_c.dylib             	0x9594459b _sigtramp + 43
6   ???                           	0xffffffff 0 + 4294967295
7   monodevelop                   	0x000054c0 mono_sigill_signal_handler + 64
8   libgdk-quartz-2.0.0.dylib     	0x047489a2 find_window_for_ns_event + 610
9   libgdk-quartz-2.0.0.dylib     	0x04749be4 gdk_event_translate + 724
10  libgdk-quartz-2.0.0.dylib     	0x0474a5c0 _gdk_events_queue + 128
11  libgdk-quartz-2.0.0.dylib     	0x0474b852 gdk_event_dispatch + 82
12  libglib-2.0.0.dylib           	0x0405226e g_main_dispatch + 510
13  libglib-2.0.0.dylib           	0x04053afb g_main_context_dispatch + 155
14  libglib-2.0.0.dylib           	0x040540a3 g_main_context_iterate + 1331
15  libglib-2.0.0.dylib           	0x040549ea g_main_loop_run + 1050
16  libgtk-quartz-2.0.0.dylib     	0x042fd200 gtk_main + 240
17  ???                           	0x0c9f2dfc 0 + 211758588
18  ???                           	0x0c9f2dc4 0 + 211758532
19  ???                           	0x0c9f2da4 0 + 211758500
20  ???                           	0x0400409c 0 + 67125404
21  ???                           	0x003eef90 0 + 4124560
22  ???                           	0x003eed9c 0 + 4124060
23  ???                           	0x003eee56 0 + 4124246
24  monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
25  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
26  monodevelop                   	0x00171354 mono_runtime_exec_main + 420
27  monodevelop                   	0x00176725 mono_runtime_run_main + 725
28  monodevelop                   	0x00069c15 mono_jit_exec + 149
29  monodevelop                   	0x0006c00d mono_main + 9197
30  monodevelop                   	0x00002869 main + 441
31  monodevelop                   	0x00002676 start + 54

Thread 1:
0   libsystem_kernel.dylib        	0x9bfdcc22 mach_msg_trap + 10
1   libsystem_kernel.dylib        	0x9bfdc1f6 mach_msg + 70
2   monodevelop                   	0x000d7c2a mach_exception_thread + 90
3   monodevelop                   	0x0020441d GC_start_routine + 93
4   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
5   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 2:
0   libsystem_kernel.dylib        	0x9bfdcc5e semaphore_wait_trap + 10
1   monodevelop                   	0x001e4f6a mono_sem_wait + 26
2   monodevelop                   	0x0010c72a finalizer_thread + 74
3   monodevelop                   	0x001a9b06 start_wrapper + 422
4   monodevelop                   	0x001dcbea thread_start_routine + 154
5   monodevelop                   	0x0020441d GC_start_routine + 93
6   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
7   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 3:: Dispatch queue: com.apple.libdispatch-manager
0   libsystem_kernel.dylib        	0x9bfdf90a kevent + 10
1   libdispatch.dylib             	0x93fbcc58 _dispatch_mgr_invoke + 969
2   libdispatch.dylib             	0x93fbb6a7 _dispatch_mgr_thread + 53

Thread 4:
0   libsystem_kernel.dylib        	0x9bfde83e __psynch_cvwait + 10
1   libsystem_c.dylib             	0x958f0e21 _pthread_cond_wait + 827
2   libsystem_c.dylib             	0x958a142c pthread_cond_wait$UNIX2003 + 71
3   monodevelop                   	0x001c7092 _wapi_handle_timedwait_signal_handle + 482
4   monodevelop                   	0x001c70d8 _wapi_handle_wait_signal_handle + 40
5   monodevelop                   	0x001d9d48 WaitForSingleObjectEx + 664
6   monodevelop                   	0x001a848d ves_icall_System_Threading_WaitHandle_WaitOne_internal + 77
7   ???                           	0x0400aa30 0 + 67152432
8   ???                           	0x0400a450 0 + 67150928
9   ???                           	0x0400a12a 0 + 67150122
10  ???                           	0x04009fb2 0 + 67149746
11  ???                           	0x030b0941 0 + 51054913
12  monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
13  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
14  monodevelop                   	0x0016d3cc mono_runtime_delegate_invoke + 92
15  monodevelop                   	0x001a9b32 start_wrapper + 466
16  monodevelop                   	0x001dcbea thread_start_routine + 154
17  monodevelop                   	0x0020441d GC_start_routine + 93
18  libsystem_c.dylib             	0x958eced9 _pthread_start + 335
19  libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 5:
0   libsystem_kernel.dylib        	0x9bfdebb2 __semwait_signal + 10
1   libsystem_c.dylib             	0x958a17b9 nanosleep$UNIX2003 + 187
2   monodevelop                   	0x001dbdc7 SleepEx + 295
3   monodevelop                   	0x001a0fc7 monitor_thread + 119
4   monodevelop                   	0x001a9b06 start_wrapper + 422
5   monodevelop                   	0x001dcbea thread_start_routine + 154
6   monodevelop                   	0x0020441d GC_start_routine + 93
7   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
8   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 6:
0   libsystem_kernel.dylib        	0x9bfdcc76 semaphore_timedwait_trap + 10
1   monodevelop                   	0x001e4ed5 mono_sem_timedwait + 309
2   monodevelop                   	0x001a40a1 async_invoke_thread + 2817
3   monodevelop                   	0x001a9b06 start_wrapper + 422
4   monodevelop                   	0x001dcbea thread_start_routine + 154
5   monodevelop                   	0x0020441d GC_start_routine + 93
6   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
7   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 7:
0   libsystem_kernel.dylib        	0x9bfde83e __psynch_cvwait + 10
1   libsystem_c.dylib             	0x958f0e21 _pthread_cond_wait + 827
2   libsystem_c.dylib             	0x958a13e0 pthread_cond_timedwait$UNIX2003 + 70
3   monodevelop                   	0x001c702a _wapi_handle_timedwait_signal_handle + 378
4   monodevelop                   	0x001d9d6b WaitForSingleObjectEx + 699
5   monodevelop                   	0x001a848d ves_icall_System_Threading_WaitHandle_WaitOne_internal + 77
6   ???                           	0x0400aa30 0 + 67152432
7   ???                           	0x0c969ad0 0 + 211196624
8   ???                           	0x0c969a44 0 + 211196484
9   ???                           	0x0c969930 0 + 211196208
10  ???                           	0x04009fb2 0 + 67149746
11  ???                           	0x030b0941 0 + 51054913
12  monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
13  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
14  monodevelop                   	0x0016d3cc mono_runtime_delegate_invoke + 92
15  monodevelop                   	0x001a9b32 start_wrapper + 466
16  monodevelop                   	0x001dcbea thread_start_routine + 154
17  monodevelop                   	0x0020441d GC_start_routine + 93
18  libsystem_c.dylib             	0x958eced9 _pthread_start + 335
19  libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 8:
0   libsystem_kernel.dylib        	0x9bfdebb2 __semwait_signal + 10
1   libsystem_c.dylib             	0x958a17b9 nanosleep$UNIX2003 + 187
2   monodevelop                   	0x001dbdc7 SleepEx + 295
3   monodevelop                   	0x001ac2a8 ves_icall_System_Threading_Thread_Sleep_internal + 88
4   ???                           	0x0c98c9ac 0 + 211339692
5   ???                           	0x0c98c928 0 + 211339560
6   ???                           	0x0c98c7dc 0 + 211339228
7   ???                           	0x04009fb2 0 + 67149746
8   ???                           	0x030b0941 0 + 51054913
9   monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
10  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
11  monodevelop                   	0x0016d3cc mono_runtime_delegate_invoke + 92
12  monodevelop                   	0x001a9b32 start_wrapper + 466
13  monodevelop                   	0x001dcbea thread_start_routine + 154
14  monodevelop                   	0x0020441d GC_start_routine + 93
15  libsystem_c.dylib             	0x958eced9 _pthread_start + 335
16  libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 9:
0   libsystem_kernel.dylib        	0x9bfdf90a kevent + 10
1   monodevelop                   	0x001a1f36 tp_kqueue_wait + 1142
2   monodevelop                   	0x001a9b06 start_wrapper + 422
3   monodevelop                   	0x001dcbea thread_start_routine + 154
4   monodevelop                   	0x0020441d GC_start_routine + 93
5   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
6   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 10:
0   libsystem_kernel.dylib        	0x9bfdcc76 semaphore_timedwait_trap + 10
1   monodevelop                   	0x001e4ed5 mono_sem_timedwait + 309
2   monodevelop                   	0x001a40a1 async_invoke_thread + 2817
3   monodevelop                   	0x001a9b06 start_wrapper + 422
4   monodevelop                   	0x001dcbea thread_start_routine + 154
5   monodevelop                   	0x0020441d GC_start_routine + 93
6   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
7   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 11:
0   libsystem_kernel.dylib        	0x9bfdeb42 __select + 10
1   libglib-2.0.0.dylib           	0x04067c2f g_poll + 1295
2   libgdk-quartz-2.0.0.dylib     	0x0474acec select_thread_func + 332
3   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
4   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 12:
0   libsystem_kernel.dylib        	0x9bfdcc76 semaphore_timedwait_trap + 10
1   monodevelop                   	0x001e4ed5 mono_sem_timedwait + 309
2   monodevelop                   	0x001a40a1 async_invoke_thread + 2817
3   monodevelop                   	0x001a9b06 start_wrapper + 422
4   monodevelop                   	0x001dcbea thread_start_routine + 154
5   monodevelop                   	0x0020441d GC_start_routine + 93
6   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
7   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 13:
0   libsystem_kernel.dylib        	0x9bfdcc76 semaphore_timedwait_trap + 10
1   monodevelop                   	0x001e4ed5 mono_sem_timedwait + 309
2   monodevelop                   	0x001a40a1 async_invoke_thread + 2817
3   monodevelop                   	0x001a9b06 start_wrapper + 422
4   monodevelop                   	0x001dcbea thread_start_routine + 154
5   monodevelop                   	0x0020441d GC_start_routine + 93
6   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
7   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 14:
0   libsystem_kernel.dylib        	0x9bfde83e __psynch_cvwait + 10
1   libsystem_c.dylib             	0x958f0e21 _pthread_cond_wait + 827
2   libsystem_c.dylib             	0x958a142c pthread_cond_wait$UNIX2003 + 71
3   monodevelop                   	0x001c7092 _wapi_handle_timedwait_signal_handle + 482
4   monodevelop                   	0x001c70d8 _wapi_handle_wait_signal_handle + 40
5   monodevelop                   	0x001d9d48 WaitForSingleObjectEx + 664
6   monodevelop                   	0x001a848d ves_icall_System_Threading_WaitHandle_WaitOne_internal + 77
7   ???                           	0x0400aa30 0 + 67152432
8   ???                           	0x0400a450 0 + 67150928
9   ???                           	0x0f1c291f 0 + 253503775
10  ???                           	0x04009fb2 0 + 67149746
11  ???                           	0x030b0941 0 + 51054913
12  monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
13  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
14  monodevelop                   	0x0016d3cc mono_runtime_delegate_invoke + 92
15  monodevelop                   	0x001a9b32 start_wrapper + 466
16  monodevelop                   	0x001dcbea thread_start_routine + 154
17  monodevelop                   	0x0020441d GC_start_routine + 93
18  libsystem_c.dylib             	0x958eced9 _pthread_start + 335
19  libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 15:
0   libsystem_kernel.dylib        	0x9bfde83e __psynch_cvwait + 10
1   libsystem_c.dylib             	0x958f0e21 _pthread_cond_wait + 827
2   libsystem_c.dylib             	0x958a142c pthread_cond_wait$UNIX2003 + 71
3   monodevelop                   	0x001c7092 _wapi_handle_timedwait_signal_handle + 482
4   monodevelop                   	0x001c70d8 _wapi_handle_wait_signal_handle + 40
5   monodevelop                   	0x001d9d48 WaitForSingleObjectEx + 664
6   monodevelop                   	0x001a848d ves_icall_System_Threading_WaitHandle_WaitOne_internal + 77
7   ???                           	0x0400aa30 0 + 67152432
8   ???                           	0x0400a450 0 + 67150928
9   ???                           	0x0f36ae17 0 + 255241751
10  ???                           	0x04009fb2 0 + 67149746
11  ???                           	0x030b0941 0 + 51054913
12  monodevelop                   	0x0000d612 mono_jit_runtime_invoke + 722
13  monodevelop                   	0x0016d28e mono_runtime_invoke + 126
14  monodevelop                   	0x0016d3cc mono_runtime_delegate_invoke + 92
15  monodevelop                   	0x001a9b32 start_wrapper + 466
16  monodevelop                   	0x001dcbea thread_start_routine + 154
17  monodevelop                   	0x0020441d GC_start_routine + 93
18  libsystem_c.dylib             	0x958eced9 _pthread_start + 335
19  libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 16:: com.apple.CFSocket.private
0   libsystem_kernel.dylib        	0x9bfdeb42 __select + 10
1   com.apple.CoreFoundation      	0x94f13ee5 __CFSocketManager + 1557
2   libsystem_c.dylib             	0x958eced9 _pthread_start + 335
3   libsystem_c.dylib             	0x958f06de thread_start + 34

Thread 17:
0   libsystem_kernel.dylib        	0x9bfdf02e __workq_kernreturn + 10
1   libsystem_c.dylib             	0x958eeccf _pthread_wqthread + 773
2   libsystem_c.dylib             	0x958f06fe start_wqthread + 30

Thread 0 crashed with X86 Thread State (32-bit):
  eax: 0x00000000  ebx: 0x13360674  ecx: 0xbfffe45c  edx: 0x9bfde9c6
  edi: 0xac6052c0  esi: 0x00000006  ebp: 0xbfffe478  esp: 0xbfffe45c
   ss: 0x00000023  efl: 0x00000246  eip: 0x9bfde9c6   cs: 0x0000000b
   ds: 0x00000023   es: 0x00000023   fs: 0x00000000   gs: 0x0000000f
  cr2: 0xac5fd738
Logical CPU: 0</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-09 19:45:45 UTC
        </span>

      </div>




<pre class="bz_comment_text">Happened again, again when clicking on the text editor.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-09 22:24:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">The most recent crash may have been caused by <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - Pango in Mono 2.10.9_2 causing in MonoDevelop" href="https://bugzilla.xamarin.com/show_bug.cgi?id=3340">bug 3340</a>.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-10 13:55:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">The important bit of the trace is:

7   monodevelop                       0x000054c0 mono_sigill_signal_handler +
64
8   libgdk-quartz-2.0.0.dylib         0x047489a2 find_window_for_ns_event + 610
9   libgdk-quartz-2.0.0.dylib         0x04749be4 gdk_event_translate + 724
10  libgdk-quartz-2.0.0.dylib         0x0474a5c0 _gdk_events_queue + 128
11  libgdk-quartz-2.0.0.dylib         0x0474b852 gdk_event_dispatch + 82


It is likely find_window_for_ns_event() does not find the correct window (or returns NULL).

If you have an idea about how this can be produced, that would be very welcome.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-10 14:04:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">I saw this again so it doesn't appear to be related to the pango issue - but the cause was not obvious. I'll try running MD inside gdb to get more info next time.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-14 20:00:27 UTC
        </span>

      </div>




<pre class="bz_comment_text">I'm seeing this crasher at least couple of times a day, so I'm say it's our most important GTK+ bug at this point. However, I still haven't identified a trigger.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-15 16:02:20 UTC
        </span>

      </div>




<pre class="bz_comment_text"><span class="quote">&gt; I'm seeing this crasher at least couple of times a day, so I'm say it's our
&gt; most important GTK+ bug at this point. However, I still haven't identified a
&gt; trigger.</span>

Michael: can you confirm whether the stack trace is always the same?  If not, could you perhaps get us another trace?

When I was just looking at the stack trace again, it felt a bit suspicious:

7   monodevelop                       0x000054c0 mono_sigill_signal_handler + 64
8   libgdk-quartz-2.0.0.dylib         0x047489a2 find_window_for_ns_event + 610

I assumed that a SIGSEGV was caught when I posted <a href="bug.html">comment 7</a>. However, it is a SIGILL. SIGILL is usually an illegal instruction and I cannot really see how find_window_for_ns_event() could trigger that.  Unless mono triggers SIGILL for special occasions, is that the case?

If I disassemble find_window_for_ns_event, + 610 is the first instruction after the call to get_window_point_from_screen_point(). In find_window_for_ns_event() no pointer is dereferenced after the call to get_window_point_from_screen_point(), so I am wondering if a SIGSEGV due to GTK+ is likely.

In case the program counter information is unreliable it could also be a crash in get_window_point_from_screen_point(). Though the screen_point, x and y arguments are for this code path always set (x and y also by the caller of find_window_for_ns_event()). This leaves the possibility of window being NULL, which could happen if grab-&gt;window == NULL in find_window_for_ns_event().</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-15 16:50:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">They certainly always contain find_window_for_ns_event and are similar enough that I believed them to be the same, though as you mention one trace does have the mono_sigill_signal_handler frame.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-17 15:14:16 UTC
        </span>

      </div>




<pre class="bz_comment_text">The stack trace in the opening comment does not contain SIGILL and goes right in to a SIGSEGV from find_window_for_ns_event().  Due to the age of the trace, I cannot use the offsets into the assembler code anymore to get clues.

I revisited the stack trace from <a href="bug.html">comment 4</a>. Earlier I said the +610 for find_window_for_ns_event() is the instruction after the call to get_window_point_from_screen_point(). However, the +724 for gdk_event_translate() is also the instruction after the call to find_window_for_ns_event(), so (as usual actually) these offsets should be taken with a grain of salt.

That said, I think we should investigate the code that I suspect might be the problem around +610 some more.  I will attach a patch which adds two g_warning()s to this code which will be performed when one of the values is NULL.  Due to the added if guards, the crash, if caused by this code fragment, should disappear as well.

It would be great if somebody could run MonoDevelop with this for a few days to see if these warnings are hit.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-17 15:16:04 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="https://bugzilla.xamarin.com/attachment.cgi?id=1373&amp;file=debug%202158.diff" name="attach_1373" title="Patch for debugging this issue">attachment 1373</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1373&amp;file=debug%202158.diff" title="Patch for debugging this issue">[details]</a></span>
Patch for debugging this issue

Patch to investigate if the suspected code fragment is indeed hit when one of the pointers is NULL.</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-17 15:17:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="https://bugzilla.xamarin.com/attachment.cgi?id=1374&amp;file=debug%202158.diff" name="attach_1374" title="Patch for debugging this issue (has a non-useful g_warning removed)">attachment 1374</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1374&amp;file=debug%202158.diff" title="Patch for debugging this issue (has a non-useful g_warning removed)">[details]</a></span>
Patch for debugging this issue (has a non-useful g_warning removed)</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-17 16:23:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thanks, I've added the patch in bockbuild. Jeff and I will run with it locally.</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-02 17:23:55 UTC
        </span>

      </div>




<pre class="bz_comment_text">I'm still seeing this on the latest Mono 2.10.9. Duncan, did we get this patch into those builds?</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-02 18:51:58 UTC
        </span>

      </div>




<pre class="bz_comment_text">Specifically, 210090008.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Duncan Mak</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-02 19:50:23 UTC
        </span>

      </div>




<pre class="bz_comment_text">I believe we do have the patch included. I checked the tarball that was used and I see the patch in there.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-03 00:27:13 UTC
        </span>

      </div>




<pre class="bz_comment_text">I tried getting the line number with atos, and it just returned the same instruction offset as the crash report. And dwarfdump wasn't any better - it seems to have trouble reading anything from the DWARF resource in the dSYM. Maybe the dSYM shipped by Mono for gdk-quartz is broken.

The offsets with Mono 210090008 are:
8   libgdk-quartz-2.0.0.dylib           0x0466fa20 find_window_for_ns_event + 586
9   libgdk-quartz-2.0.0.dylib           0x046708de gdk_event_translate + 585
10  libgdk-quartz-2.0.0.dylib           0x04671022 _gdk_events_queue + 117

AFAICT from disassembling the file with otool, it's still the instruction after the call to
get_window_point_from_screen_point. There are a couple of g_log calls shortly before that point, so it looks like the patch is included.</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-04 16:25:43 UTC
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED DUPLICATE - crash (monodevelop 2.8.8.4, mono 2.11, mac os snow leopard)" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4199">Bug 4199</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-10 10:58:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">Hmm, the instruction after get_window_point_from_screen_point() is a simply
return. Let me cook up a patch that adds even more printf and makes sure
it returns NULL rather than uninitialized stack memory.</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-10 11:41:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=1644&amp;file=debug%202158.diff" name="attach_1644" title="Almost the same patch, but don't return uninitialized memory">attachment 1644</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=1644&amp;file=debug%202158.diff" title="Almost the same patch, but don't return uninitialized memory">[details]</a></span>
Almost the same patch, but don't return uninitialized memory

I ended up making only the change mentioned above.

While reading the code, I noticed that the different "toplevel" functions/users
in this file have different ideas about what s "toplevel" is, some additionally
check for WINDOW_IS_TOPLEVEL(). Especially evil seems find_toplevel_under_window()
which always returns display-&gt;pointer_info.toplevel_under_pointer but
only returns translated coordinates if WINDOW_IS_TOPLEVEL() is also TRUE.

This looks fishy. Kris, what do you think?</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-10 16:12:02 UTC
        </span>

      </div>




<pre class="bz_comment_text"><span class="quote">&gt; Hmm, the instruction after get_window_point_from_screen_point() is a simply
&gt; return. Let me cook up a patch that adds even more printf and makes sure
&gt; it returns NULL rather than uninitialized stack memory.</span>


IIRC it already properly returns NULL, since gdk_window_get_effective_toplevel() will always return a proper value as far as I can see.


<span class="quote">&gt; which always returns display-&gt;pointer_info.toplevel_under_pointer but
&gt; only returns translated coordinates if WINDOW_IS_TOPLEVEL() is also TRUE.</span>
&gt;
<span class="quote">&gt; This looks fishy. Kris, what do you think?</span>

The several WINDOW_IS_TOPLEVEL() checks originate from a patch which made offscreen windows work with the backend without constantly crashing. The real issue could be that get_window_point_from_screen_point() is not offscreen-window-aware.</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-21 05:04:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">Michael, if you are seeing this crash regularly in the latest Mono 2.10.9, could you get us the messages printed to the console by the g_log()s?   This likely contains valuable debugging information for us.</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-27 15:56:48 UTC
        </span>

      </div>




<pre class="bz_comment_text">Sorry, I haven't always been running MD in the bockbuild environment, so it's taken a while to get the traces. Here it is, with the latest patchset:
Gdk-Critical: gdk_window_get_events: assertion `GDK_IS_WINDOW (window)' failed
GLib-GObject-Critical: g_object_ref: assertion `G_IS_OBJECT (object)' failed
Gdk-Warning: grab-&gt;window == NULL
Gdk-Critical: generate_grab_broken_event: assertion `window != NULL' failed
GLib-GObject-Critical: g_object_unref: assertion `G_IS_OBJECT (object)' failed

This was just when editing in the text editor, though the code completion or tooltip may have been involved. I think that <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - MonoDevelops text editor stops responding to mouse events" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4497">bug 4497</a> *might* be a duplicate of this, since the symptoms are the same, and AFAIK we included an earlier version of the patch into recent Mono builds.</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-29 16:58:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thanks!  This is very valuable information.  Based on these log messages I think the code path that goes wrong is:

 # In proxy_button_event(), pointer_window is NULL in the if type == GDK_BUTTON_PRESS &amp;&amp; .. clause.
 # This causes the warning from gdk_window_get_events() 
 # The call to _gdk_display_add_pointer_grab() with pointer_window == NULL could cause the g_object_ref warning.
 # The fact that a grab with a NULL window is registered causes the two further warnings.

Either _gdk_window_find_descendant_at() returns NULL, or the "Find the event window that gets the grab" code ends up with NULL.

The former is possible if:
 # the point is not in the given top-level window at all;

The latter is also a possibility, especially given the while condition explicitly guards for this.</pre>
    </div>

    <div id="c27" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-29 18:16:21 UTC
        </span>

      </div>




<pre class="bz_comment_text">I have to add that the "Find the event window that gets the grab" code stops iterating as soon as the next parent is NULL. w is not set to NULL in such cases. I get the impression that it is more likely that the former code gives the latter code a NULL pointer_window to start with.

This would imply that we have a possible case in which an event is generated with coordinates out of the bounds of the toplevel. (Or, the toplevel is resized in between the event being generated and handled?).  I need to think about whether we can come up with an easy way to stress test this somehow ...</pre>
    </div>

    <div id="c28" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-29 20:08:49 UTC
        </span>

      </div>




<pre class="bz_comment_text">I think it has something to do with the code completion window, which gets hidden (but not destroyed) in response to keystrokes, and <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - MonoDevelops text editor stops responding to mouse events" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4497">bug 4497</a> indicates something strange is going on with its grabs.</pre>
    </div>

    <div id="c29" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-07 17:18:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">I got a fresh trace, with symbols, on a fully updated and patched GTK+:

Thread 1 (process 13903):
#0  0x9221bfd5 in __wait4 ()
#1  0x95f974ec in waitpid$UNIX2003 ()
#2  0x000e174b in mono_handle_native_sigsegv (signal=11, ctx=0xbfffe918) at mini-exceptions.c:2192
#3  0x000115df in mono_sigsegv_signal_handler (_dummy=11, info=0xbfffe8d8, context=0xbfffe918) at mini.c:5917
#4  &lt;signal handler called&gt;
#5  0x939e7d47 in objc_msgSend ()
#6  0xbfffeb58 in ?? ()
#7  0x043a3589 in find_window_for_ns_event (nsevent=0x19ee7040, x=0xbfffeb58, y=0xbfffeb54, x_root=0xbfffeb50, y_root=0xbfffeb4c) at gdkevents-quartz.c:716
#8  0x043a4a18 in gdk_event_translate (event=0xc9b808, nsevent=0x19ee7040) at gdkevents-quartz.c:1325
#9  0x043a53f0 in _gdk_events_queue (display=0x10be800) at gdkevents-quartz.c:1528
#10 0x043a6732 in gdk_event_dispatch (source=0x65c860, callback=0, user_data=0x0) at gdkeventloop-quartz.c:670
#11 0x03b20d21 in g_main_dispatch (context=0x65c8c0) at gmain.c:2441
#12 0x03b2261b in g_main_context_dispatch (context=0x65c8c0) at gmain.c:3011
#13 0x03b22c4a in g_main_context_iterate (context=0x65c8c0, block=1, dispatch=1, self=0x1b6bff0) at gmain.c:3089
#14 0x03b2358d in g_main_loop_run (loop=0x1d840a0) at gmain.c:3297
#15 0x03e30a80 in gtk_main () at gtkmain.c:1256
#16 0x0de64bc4 in ?? ()
#17 0x0de64b8c in ?? ()
#18 0x0de64b6c in ?? ()
#19 0x01feed00 in ?? ()
#20 0x00741f90 in ?? ()
#21 0x00741d9c in ?? ()
#22 0x00741e56 in ?? ()
#23 0x0001132f in mono_jit_runtime_invoke (method=0x286681c, obj=0x0, params=0xbffff2d8, exc=0x0) at mini.c:5791
#24 0x00221aaa in mono_runtime_invoke (method=0x286681c, obj=0x0, params=0xbffff2d8, exc=0x0) at object.c:2755
#25 0x0022478c in mono_runtime_exec_main (method=0x286681c, args=0x4f6e00, exc=0x0) at object.c:3930
#26 0x002239f1 in mono_runtime_run_main (method=0x286681c, argc=0, argv=0xbffff5e0, exc=0x0) at object.c:3560
#27 0x000acecf in mono_jit_exec (domain=0x4efe00, assembly=0x1d3fd50, argc=1, argv=0xbffff5dc) at driver.c:944
#28 0x000ad120 in main_thread_handler (user_data=0xbffff508) at driver.c:1003
#29 0x000af578 in mono_main (argc=2, argv=0xbffff5d8) at driver.c:1855
#30 0x00002874 in mono_main_with_options (argc=2, argv=0xbffff5d8) at main.c:66
#31 0x00002908 in main (argc=2, argv=0xbffff5d8) at main.c:97

Here is the file with the current patchset: <a href="https://gist.github.com/d6c02072f333710dbbba#L716">https://gist.github.com/d6c02072f333710dbbba#L716</a></pre>
    </div>

    <div id="c30" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-07 17:19:41 UTC
        </span>

      </div>




<pre class="bz_comment_text">FYI, that was from Mono's gdb backtracing of itself, Apple Crash Reporter trace for the same crash was:
0   libsystem_kernel.dylib        	0x9221b9c6 __pthread_kill + 10
1   libsystem_c.dylib             	0x95fe4f78 pthread_kill + 106
2   libsystem_c.dylib             	0x95fd5bdd abort + 167
3   mono                          	0x000e17dc mono_handle_native_sigsegv + 908
4   mono                          	0x000115df mono_sigsegv_signal_handler + 351
5   libsystem_c.dylib             	0x9603a59b _sigtramp + 43
6   ???                           	0xffffffff 0 + 4294967295
7   mono                          	0x00011480 mono_sigill_signal_handler + 96
8   libgdk-quartz-2.0.0.dylib     	0x043a3589 find_window_for_ns_event + 713
9   libgdk-quartz-2.0.0.dylib     	0x043a4a18 gdk_event_translate + 776
10  libgdk-quartz-2.0.0.dylib     	0x043a53f0 _gdk_events_queue + 128
11  libgdk-quartz-2.0.0.dylib     	0x043a6732 gdk_event_dispatch + 82
12  libglib-2.0.0.dylib           	0x03b20d21 g_main_dispatch + 513 (gmain.c:2441)
13  libglib-2.0.0.dylib           	0x03b2261b g_main_context_dispatch + 155 (gmain.c:3014)
14  libglib-2.0.0.dylib           	0x03b22c4a g_main_context_iterate + 1466 (gmain.c:3092)
15  libglib-2.0.0.dylib           	0x03b2358d g_main_loop_run + 1037 (gmain.c:3296)
16  libgtk-quartz-2.0.0.dylib     	0x03e30a80 gtk_main + 240 (gtkmain.c:1257)</pre>
    </div>

    <div id="c31" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-13 09:46:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">Michael, is the resolver in this case still patched to destroy the window instead of hiding it?


The crash appears to occur in get_window_point_from_screen_point, presumably at the point where a message is sent to the nswindow. This could mean the private-&gt;impl-&gt;toplevel pointer that we get from the grab-&gt;window is busted (or private-&gt;impl or private is busted if the crash happens earlier, but that is hard to see here).</pre>
    </div>

    <div id="c32" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-13 12:28:43 UTC
        </span>

      </div>




<pre class="bz_comment_text">To possibly get more information out of the stack traces, a full backtrace, generated with "bt full" would be nice.

So far, we still don't seem to be able to trigger this.</pre>
    </div>

    <div id="c33" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-14 12:10:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">Yes, that was with the patch to destroy the window.</pre>
    </div>

    <div id="c34" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-06-07 16:04:47 UTC
        </span>

      </div>




<pre class="bz_comment_text">I've also seen this crash after the text editor pops up the error bubble animation at a compile error.</pre>
    </div>

    <div id="c35" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-07-09 11:38:30 UTC
        </span>

      </div>




<pre class="bz_comment_text">I *finally* managed to trigger this crash.  I managed to trigger it in a standalone GTK+ testcase that I wrote a couple of weeks ago, which pops up/pops down a popup window on every key press in a text view. Also the window changes size every time it is shown.  So it's good that we also managed to reproduce this outside of MonoDevelop.

Other prerequisites to reproduce this are: running this test case under valgrind on a Snow Leopard machine and while typing make drag movements from the pop window to outside the popup window.

The trace produced by valgrind is as follows:


==96219== Invalid read of size 8
==96219==    at 0x1000A64E6: get_window_point_from_screen_point (gdkevents-quartz.c:395)
==96219==    by 0x1000A7AA9: find_window_for_ns_event (gdkevents-quartz.c:688)
==96219==    by 0x1000A6CD5: gdk_event_translate (gdkevents-quartz.c:1269)
==96219==    by 0x1000A696D: _gdk_events_queue (gdkevents-quartz.c:1441)
==96219==    by 0x1000A5978: gdk_event_dispatch (gdkeventloop-quartz.c:670)
==96219==    by 0x10180B16D: g_main_dispatch (gmain.c:2387)
==96219==    by 0x10180BDA4: g_main_context_dispatch (gmain.c:2924)
==96219==    by 0x10180BF53: g_main_context_iterate (gmain.c:2995)
==96219==    by 0x10180C360: g_main_loop_run (gmain.c:3189)
==96219==    by 0x1002A452A: gtk_main (gtkmain.c:1257)
==96219==    by 0x1000115CE: main (in /source/gnome/gtk+-2-24/tests/.libs/testtext)

Which is pretty much what is seen above.  What happens is a read from a NULL pointer (a NULL GdkWindow) in get_window_point_from_screen_point.  What is VERY strange is that exactly this condition should have been excluded in the trace given by Michael in <a href="bug.html">comment 29</a>, because the file that is claimed to have produced this crash includes NULL checks for this.  Though it could be the case that valgrind free() is setting everything to NULL such that we are dealing with a NULL pointer crash here and a random pointer crash in the normal case.

What appears to be causing this problem is that we are pushing in events that have coordinates outside of the window that is given in the event.  It looks like we cannot rely on pointer_info-&gt;toplevel_under_pointer in gdkevents-quartz.c while the window is constantly resizing, so essentially this is a race condition. Apart from that, there seems to be another code path that is resulting in wrong coordinate, window combos.

I am still investigating this so I can come up with a fix. After that, I will make an analysis whether the related bugs are really related. To be continued.</pre>
    </div>

    <div id="c36" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-07-09 19:54:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=2181&amp;file=testtext%20torture.diff" name="attach_2181" title="testtext torture patch">attachment 2181</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2181&amp;file=testtext%20torture.diff" title="testtext torture patch">[details]</a></span>
testtext torture patch

For reference: the completely evil patch to testtext I used to trigger the issue.</pre>
    </div>

    <div id="c37" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-07-09 20:00:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=2182&amp;file=xamarin%202158.diff" name="attach_2182" title="Patch that guards for return a combination of a window and coordinates out of window bounds">attachment 2182</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2182&amp;file=xamarin%202158.diff" title="Patch that guards for return a combination of a window and coordinates out of window bounds">[details]</a></span>
Patch that guards for return a combination of a window and coordinates out of window bounds

With this patch I seem no longer able to trigger this crash with the test case.  The patch still feels like a hack to me.  However, NSEvents do appear to come in with a window set, but with coordinates out of the bounds of this window. For button press/release events this will cause nothing but trouble, so we either have to find the right toplevel window or we simply ignore the event.

Finding the right toplevel could bring other problems, also, this scenario will very rarely occur.  So for now I have the impression simply ignoring these events is a good pick.


Testing would of course be good, and I would love to learn about any potential regressions (which should in theory be rare, because the scenario rarely occurs).</pre>
    </div>

    <div id="c38" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-07-09 20:12:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">It is hard to say whether fixing this bug also fixes bugs 4651 and 4497.

What did happen with this bug is that faulty grabs were created, grabs with a NULL (or perhaps in the case without valgrind, a busted) window pointer. This *could* make a case that <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - MonoDevelops text editor stops responding to mouse events" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4497">bug 4497</a> is fixed, because in 4497 stuck grabs are experienced.  But I can absolutely not say for sure.

In <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - MonoDevelop crashed when editing code with syntax errors" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4651">bug 4651</a> we are dealing with a different stack trace. This trace cannot be created if event_window is NULL, because there's an if statement guarding for a NULL window pointer right at the start of _gdk_windowing_got_event().  However, recall that I mentioned in <a href="bug.html">comment 35</a> that the trace in <a href="bug.html">comment 29</a> could also not happen with a NULL window pointer, but, perhaps, when valgrind is not used we are dealing with a busted pointer instead of a NULL pointer. If so, this busted pointer could also come into play in this case, causing <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - MonoDevelop crashed when editing code with syntax errors" href="https://bugzilla.xamarin.com/show_bug.cgi?id=4651">bug 4651</a>.


So, we cannot really say whether 4497 and 4651 have been fixed as well now -- the above comments are purely speculations.</pre>
    </div>

    <div id="c39" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c39">Comment 39</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-07-10 19:43:13 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thanks, I landed the patch in bockbuild. It'll be a week or so before I can be reasonably sure it fixes the issue - sometimes the crash can happen several times in a few hours, sometimes it doesn't happen for several days...</pre>
    </div>

    <div id="c40" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-08-09 00:48:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">Unfortunately it looks like this doesn't fix it, I just saw:
Thread 1 (process 69871):
#0  0x95d8c095 in __wait4 ()
#1  0x9872c9ae in waitpid$UNIX2003 ()
#2  0x000e15cb in mono_handle_native_sigsegv (signal=11, ctx=0xbfffe8a8) at mini-exceptions.c:2192
#3  0x0001150f in mono_sigsegv_signal_handler (_dummy=11, info=0xbfffe868, context=0xbfffe8a8) at mini.c:5917
#4  &lt;signal handler called&gt;
#5  0x932d2c07 in objc_msgSend ()
#6  0xbfffeae8 in ?? ()
#7  0x05fb2b6d in find_window_for_ns_event (nsevent=0x49e3aa00, x=0xbfffeae8, y=0xbfffeae4, x_root=0xbfffeae0, y_root=0xbfffeadc) at gdkevents-quartz.c:775
#8  0x05fb45b8 in gdk_event_translate (event=0x13fb660, nsevent=0x49e3aa00) at gdkevents-quartz.c:1522
#9  0x05fb4f90 in _gdk_events_queue (display=0x3869800) at gdkevents-quartz.c:1732
#10 0x05fb62d2 in gdk_event_dispatch (source=0x358f2d0, callback=0, user_data=0x0) at gdkeventloop-quartz.c:670
#11 0x05616d21 in g_main_dispatch (context=0x358f330) at gmain.c:2441
#12 0x0561861b in g_main_context_dispatch (context=0x358f330) at gmain.c:3011
#13 0x05618c4a in g_main_context_iterate (context=0x358f330, block=1, dispatch=1, self=0x27b1050) at gmain.c:3089
#14 0x0561958d in g_main_loop_run (loop=0xccee940) at gmain.c:3297
#15 0x05a361e0 in gtk_main () at gtkmain.c:1257
#16 0x0f88a73c in ?? ()
#17 0x0f88a704 in ?? ()
#18 0x0f88a6e4 in ?? ()
#19 0x041d06c0 in ?? ()
#20 0x004eefe8 in ?? ()
#21 0x004eede4 in ?? ()
#22 0x004eeeaa in ?? ()
#23 0x0001125f in mono_jit_runtime_invoke (method=0x82b81c, obj=0x0, params=0xbffff2b8, exc=0x0) at mini.c:5791
#24 0x00224fda in mono_runtime_invoke (method=0x82b81c, obj=0x0, params=0xbffff2b8, exc=0x0) at object.c:2755
#25 0x00227c5c in mono_runtime_exec_main (method=0x82b81c, args=0x18007c0, exc=0x0) at object.c:3930
#26 0x00226ec1 in mono_runtime_run_main (method=0x82b81c, argc=1, argv=0xbffff5b4, exc=0x0) at object.c:3560
#27 0x000ad86f in mono_jit_exec (domain=0x65d2a0, assembly=0x275d330, argc=2, argv=0xbffff5b0) at driver.c:944
#28 0x000adac0 in main_thread_handler (user_data=0xbffff4d8) at driver.c:1003
#29 0x000aff02 in mono_main (argc=4, argv=0xbffff5a8) at driver.c:1855
#30 0x000027a4 in mono_main_with_options (argc=4, argv=0xbffff5a8) at main.c:66
#31 0x00002838 in main (argc=4, argv=0xbffff5a8) at main.c:97</pre>
    </div>

    <div id="c41" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c41">Comment 41</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-08-13 15:01:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">Something I've been noticing for some time is that this often happens when I click on the editor immediately after a build. 

After a build, MD uses a popup window to show an animation that "calls out" the first compiler error bubble. I think the crash is related to clicking on the editor while this window is appearing/disappearing.</pre>
    </div>

    <div id="c42" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c42">Comment 42</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-08 07:26:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=2705&amp;file=xamarin%202158%20update%208oct2012.diff" name="attach_2705" title="Updated patch USE WITH CAUTION">attachment 2705</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2705&amp;file=xamarin%202158%20update%208oct2012.diff" title="Updated patch USE WITH CAUTION">[details]</a></span>
Updated patch USE WITH CAUTION

Recently, a related crash came to our attention in GIMP, see GNOME BUG 684419. It turns out this crash was being triggered by clicks on the title bar. It is likely this occurs in MonoDevelop too, but I cannot comment whether this fixes the crash in <a href="#c40">Comment 40</a>. The traces simply lack details ...

This is an updated version of the patch in <a href="bug.html">comment 37</a> (July 9), that also fixes the crash of 684419. It changes a few things, by now checking whether the event occurs outside of the view frame, which should be more reliable and also automatically includes checking for the titlebar location, since the title bar is out of the bounds of the view frame.

Please use this patch WITH CAUTION, I have not tested it against the test case in <a href="bug.html">comment 36</a> and hope to do that somewhere this week. Once I have tested I will make this known here.</pre>
    </div>

    <div id="c43" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c43">Comment 43</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-08 12:33:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thanks, I've applied it to my local GTK+ build and will keep an eye out for the crash.</pre>
    </div>

    <div id="c44" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c44">Comment 44</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-09 10:31:25 UTC
        </span>

      </div>




<pre class="bz_comment_text">I completely agree for button press events, but won't that filter out
and break things when a press-move-release sequence ends outside
the window's view frame?</pre>
    </div>

    <div id="c45" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c45">Comment 45</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-09 10:41:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">Yes indeed, the patch has exactly the effect I suspected, it breaks
the expected invariant press/repease pairing.</pre>
    </div>

    <div id="c46" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c46">Comment 46</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-09 10:50:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=2717&amp;file=filter%20out%20button%20press%20on%20window%20frame.patch" name="attach_2717" title="Patch that doesn't break press/release pairing">attachment 2717</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=2717&amp;file=filter%20out%20button%20press%20on%20window%20frame.patch" title="Patch that doesn't break press/release pairing">[details]</a></span>
Patch that doesn't break press/release pairing

New patch that does the filtering only on press events.
Seems to work fine for the use case in gnome bug 684419
and doesn'T break press/release event pairing.</pre>
    </div>

    <div id="c47" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c47">Comment 47</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-10 12:38:37 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thanks, updated patch in bockbuild.</pre>
    </div>

    <div id="c48" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c48">Comment 48</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-12 19:18:35 UTC
        </span>

      </div>




<pre class="bz_comment_text">I still get the crash with the patch. It happened when I clicked on the editor immediately after a build. I suspect it has something to do with the animated "bubble" popout window.

Thread 0 Crashed:: Dispatch queue: com.apple.main-thread
0   libsystem_kernel.dylib        	0x9183fa6a __pthread_kill + 10
1   libsystem_c.dylib             	0x99b4bacf pthread_kill + 101
2   libsystem_c.dylib             	0x99b824f8 abort + 168
3   mono-sgen                     	0x00094c30 mono_handle_native_sigsegv + 624
4   mono-sgen                     	0x00005628 mono_sigsegv_signal_handler + 248
5   libsystem_c.dylib             	0x99b3686b _sigtramp + 43
6   ???                           	0xffffffff 0 + 4294967295
7   mono-sgen                     	0x00005530 mono_sigill_signal_handler + 64
8   libgdk-quartz-2.0.0.dylib     	0x052b74ad find_window_for_ns_event + 701 (gdkevents-quartz.c:870)
9   libgdk-quartz-2.0.0.dylib     	0x052b8fbb gdk_event_translate + 779 (gdkevents-quartz.c:1636)
10  libgdk-quartz-2.0.0.dylib     	0x052b9a30 _gdk_events_queue + 128 (gdkevents-quartz.c:1851)
11  libgdk-quartz-2.0.0.dylib     	0x052bafde gdk_event_dispatch + 222 (gdkeventloop-quartz.c:672)
12  libglib-2.0.0.dylib           	0x048ffd21 g_main_dispatch + 513 (gmain.c:2441)
13  libglib-2.0.0.dylib           	0x0490161b g_main_context_dispatch + 155 (gmain.c:3014)
14  libglib-2.0.0.dylib           	0x04901c4a g_main_context_iterate + 1466 (gmain.c:3092)
15  libglib-2.0.0.dylib           	0x0490258d g_main_loop_run + 1037 (gmain.c:3296)
16  libgtk-quartz-2.0.0.dylib     	0x04d35be0 gtk_main + 240 (gtkmain.c:1258)
17  ???                           	0x1288657c 0 + 310928764
18  ???                           	0x12886544 0 + 310928708
19  ???                           	0x12886524 0 + 310928676
20  ???                           	0x02fda66c 0 + 50177644
21  ???                           	0x004c0fe8 0 + 4984808
22  ???                           	0x004c0de4 0 + 4984292
23  ???                           	0x004c0eaa 0 + 4984490
24  mono-sgen                     	0x0000d9e2 mono_jit_runtime_invoke + 722
25  mono-sgen                     	0x001aa27a mono_runtime_invoke + 170
26  mono-sgen                     	0x001acd9c mono_runtime_exec_main + 620
27  mono-sgen                     	0x001ac001 mono_runtime_run_main + 929
28  mono-sgen                     	0x00069715 mono_jit_exec + 149
29  mono-sgen                     	0x0006bca9 mono_main + 9609
30  mono-sgen                     	0x000028d9 main + 553
31  mono-sgen                     	0x00002665 start + 53</pre>
    </div>

    <div id="c49" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c49">Comment 49</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-10-13 04:34:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">My plan is to put together another valgrind smash test mimicking the animated bubbles. This strategy has worked before, so hopefully it will help us fix this case as well.</pre>
    </div>

    <div id="c50" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c50">Comment 50</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-13 04:38:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">The patch here has gone off my radar. Kris, shouldn't we upstream the
patch in <a href="bug.html">comment 46</a>?</pre>
    </div>

    <div id="c51" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c51">Comment 51</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-13 04:45:04 UTC
        </span>

      </div>




<pre class="bz_comment_text">What I mean is, while this patch doesn't seem to fix the crash Michael
pasted in <a href="bug.html">comment 48</a>, it does fix a whole class of other crashes, and
it looks correct to me.</pre>
    </div>

    <div id="c52" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c52">Comment 52</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-14 02:43:17 UTC
        </span>

      </div>




<pre class="bz_comment_text"><span class="quote">&gt; The patch here has gone off my radar. Kris, shouldn't we upstream the
&gt; patch in <a href="bug.html">comment 46</a>?</span>

I wanted to test the updated patches (that fix the issue in GIMP) with the valgrind test case.  I have done that now, so we should be upstreaming this now.</pre>
    </div>

    <div id="c53" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c53">Comment 53</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-14 02:44:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">I will get back to <a href="bug.html">comment 48</a> later of course.</pre>
    </div>

    <div id="c54" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c54">Comment 54</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-15 06:41:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">The patch has been pushed to upstream gtk-2-24, gtk-3-6 and master.</pre>
    </div>

    <div id="c55" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c55">Comment 55</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-15 17:20:23 UTC
        </span>

      </div>




<pre class="bz_comment_text">Updated bockbuild.</pre>
    </div>

    <div id="c56" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c56">Comment 56</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-11-24 14:20:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">To look into the trace in <a href="bug.html">comment 48</a> (actually into the comment on the "bubbles", because the trace just looks like any other in this bug...) I have started to try to trigger crashes with a resizing popup window similar to the bubbles on top of a text view.  So far I have not succeeded yet.

What I did find is that the bubbles actually move to be behind the MonoDevelop window when one clicks inside the MonoDevelop window. With the normal bubbles this cannot be seen because the animation is so quick.  But if you extend the duration of the animation, this behavior does appear. Perhaps this is triggered when the press and release happen in the MonoDevelop editor and the bubble respectively, so I have to focus on events before the bubble and not just after the bubble has appeared. I will try this avenue next.</pre>
    </div>

    <div id="c57" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c57">Comment 57</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-02 11:59:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">A button press before a simulated bubble window appears and releasing within it doesn't seem to be any problem.


I still do not really have a clue what could be causing the crashes Michael is still seeing.

My plan of action from now on would be the following:

 - For the earlier fix, we observed that the crash that happened could not actually happen due to guards being in place. Since we were quite happy having a fix, we did not further research this apparent discrepancy. My plan is to revisit these original fixes, figure out if the guard worked or not (basically, did we really deal with NULL, a busted pointer or with an object already freed). Potentially, this could bring to light a race condition that could perhaps give an idea where to look for further crashes. In case of an object already being freed, can we figure a simple debug tool (perhaps like NSZombies, though we don't have the flexibility the objective-C runtime has) that we can use without valgrind and then run MonoDevelop with this enabled.

 - In <a href="bug.html">comment 41</a> Michael indicates that this often happens immediately after a build. I *assume* the build is triggered through the menu, by either clicking or using the menu accelerator. I want to see if this menu can have any impact on events that are delivered right after.  (For example, I did see in the past that clicking on the global menu bar gives the GTK+ application some events with NSWindow == NULL. The question is whether this happens after the use of accelerators too and how this affects us).

 - Also with regard to <a href="bug.html">comment 41</a>, I tried to emulate the bubble windows on top of text view. This didn't seem to bring up any issues.  I guess next, I should try to stress test this on top of the MonoDevelop text editor.</pre>
    </div>

    <div id="c58" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c58">Comment 58</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-02 12:00:28 UTC
        </span>

      </div>




<pre class="bz_comment_text">Michael, it would actually be quite good to know:

 (a) whether you are still observing this crash and whether this still regularly occurs after a build.

 (b) whether in <a href="bug.html">comment 41</a> you triggered the build with the menu (either by clicking or keyboard shortcut) or by using a toolbar button.  (I would assume you used the keyboard shortcut).</pre>
    </div>

    <div id="c59" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c59">Comment 59</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-10 03:08:02 UTC
        </span>

      </div>




<pre class="bz_comment_text">More observations:

 1) I cannot trigger the bug with the test case with valgrind on my Lion machine.  Maybe the machine is too fast.

 2) On my Snow Leopard machine, the crash is triggered by grab_toplevel being NULL, so get_window_point_from_screen_point crashes due to a read from 0x18.

 3) I have pulled the GDK Quartz code through the Clang static analyzer and found nothing that could affect this. So it is likely not some obvious uninitialized variable causing this.


The guards that have been in place in the GTK+ compiled by bockbuild check for grab_toplevel being NULL. In that case, this crash cannot occur, though you will see a bunch of GTK+ assertions. I am using the stack trace here from <a href="bug.html">comment 48</a>, where "find_window_for_ns_event + 701" is the instruction after the call to get_window_point_from_screen_point which indicates that that call is in progress.

The only way (as far as I can see now) the crash can then occur is as follows:

 1) A non-implicit grab is in place on a toplevel window.

 2) Owner events is zero, such that grab-&gt;window is checked.

 3) grab-&gt;window must be non-NULL and resemble a valid GdkWindow object, otherwise you cannot get past the call to gdk_window_get_effective_toplevel().

 4) The return value (stored in grab_toplevel) of gdk_window_get_effective_toplevel() must be non NULL to make it into get_window_point_from_screen_point.  This implies that the effective toplevel call has not failed (you would have gotten NULL), so you either get grab-&gt;window back or another GdkWindow which did pass the call to gdk_window_get_window_type() (which checks NULL and GDK_IS_WINDOW).


So I *think* we can state grab_toplevel will either be NULL or a pointer which passes GDK_IS_WINDOW. NULL is guarded for.

How can we crash on a GdkWindow pointer? I guess possibly if we access a GdkWindow that has been freed. But a) it wouldn't surprise me if GObject scrubs the type id on destroy (need to check that), b) we have never found this case so far, because valgrind would complain about accessing freed memory. The other case is if we access a GdkWindow pointer that has been corrupted internally (either -&gt;impl in GdkWindowObject, or the toplevel field in GdkWindowImplQuartz). Again, we haven't found a code path like this, because valgrind would IIRC give a hint of such corruption as well.


Is it possible this is caused by some mono memory corruption like what is mentioned as possibility in <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED DUPLICATE" href="https://bugzilla.xamarin.com/show_bug.cgi?id=7820">bug 7820</a>?</pre>
    </div>

    <div id="c60" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c60">Comment 60</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-10 20:21:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">I don't think so, you'd think JIT memory corruption would be more widespread. This seems very specific.

OTOH that does raise a question, maybe that popup window is being shown by a thread? I'll check tomorrow.</pre>
    </div>

    <div id="c61" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c61">Comment 61</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-11 14:44:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">Before suggesting this, I also thought JIT memory corruption would be more widespread and that this case is too specific.

Though from what I recall, this happens most often after completing a build and it is very rare. I would assume performing a build involves threading. Is there anything else that could possibly corrupt memory? Any other tools we can use for debugging?</pre>
    </div>

    <div id="c62" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c62">Comment 62</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-11 15:39:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">Nah, it's not a threading issue, we marshal the build completion event back onto the UI thread.

I hadn't seen this crash in a while, and I assumed it was because I'd trained myself not to click on the editor while the animation was running. However, I can't repro the issue now - and I tried for about 10 minutes. It may be that it's been inadvertently fixed by one of the other patches, or maybe it is a Mono JIT issue that's been fixed, or maybe I was just lucky.

Let's put this bug on hold for a while until we get another repro on the latest builds.</pre>
    </div>

    <div id="c63" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c63">Comment 63</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Rietveld (inactive)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-12-11 15:43:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">Sounds good to me -- thank you for testing.   I can assure you I did test repeatedly clicking on the editor while the animation was running (I even modified the animation to run for a longer period of time).


By the way, in case another repro is found I would be very interested in the log messages in the console from where MonoDevelop was launched next to the stack trace  (if MonoDevelop was launched from the console ...).</pre>
    </div>

    <div id="c64" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c64">Comment 64</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikayla Hutchinson [MSFT]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-05-29 12:25:10 UTC
        </span>

      </div>




<pre class="bz_comment_text">This hasn't been reported on recent builds, I think we can consider it fixed :)</pre>
    </div>

    <div id="c65" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="#c65">Comment 65</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Natterer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-05-29 15:11:28 UTC
        </span>

      </div>




<pre class="bz_comment_text">There goes my oldest open browser tab... :)</pre>
    </div>




</td>
<td>
</td>
</tr></tbody></table>
  </div>


</form>

<hr>


<br>
</div>

    

  
</body></html>
