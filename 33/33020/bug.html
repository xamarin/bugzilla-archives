<html lang="en"><head>
    <title>33020 – Hang in System.Environment.Exit</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style>/* js/yui/assets/skins/sam/autocomplete.css */
.yui-skin-sam .yui-ac{position:relative;font-family:arial;font-size:100%}.yui-skin-sam .yui-ac-input{position:absolute;width:100%}.yui-skin-sam .yui-ac-container{position:absolute;top:1.6em;width:100%}.yui-skin-sam .yui-ac-content{position:absolute;width:100%;border:1px solid #808080;background:#fff;overflow:hidden;z-index:9050}.yui-skin-sam .yui-ac-shadow{position:absolute;margin:.3em;width:100%;background:#000;-moz-opacity:.10;opacity:.10;filter:alpha(opacity=10);z-index:9049}.yui-skin-sam .yui-ac iframe{opacity:0;filter:alpha(opacity=0);padding-right:.3em;padding-bottom:.3em}.yui-skin-sam .yui-ac-content ul{margin:0;padding:0;width:100%}.yui-skin-sam .yui-ac-content li{margin:0;padding:2px 5px;cursor:default;white-space:nowrap;list-style:none;zoom:1}.yui-skin-sam .yui-ac-content li.yui-ac-prehighlight{background:#b3d4ff}.yui-skin-sam .yui-ac-content li.yui-ac-highlight{background:#426fd9;color:#FFF}
/* js/yui/assets/skins/sam/calendar.css */
.yui-calcontainer{position:relative;float:left;_overflow:hidden}.yui-calcontainer iframe{position:absolute;border:0;margin:0;padding:0;z-index:0;width:100%;height:100%;left:0;top:0}.yui-calcontainer iframe.fixedsize{width:50em;height:50em;top:-1px;left:-1px}.yui-calcontainer.multi .groupcal{z-index:1;float:left;position:relative}.yui-calcontainer .title{position:relative;z-index:1}.yui-calcontainer .close-icon{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar{position:relative}.yui-calendar .calnavleft{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar .calnavright{position:absolute;z-index:1;text-indent:-10000em;overflow:hidden}.yui-calendar .calheader{position:relative;width:100%;text-align:center}.yui-calcontainer .yui-cal-nav-mask{position:absolute;z-index:2;margin:0;padding:0;width:100%;height:100%;_width:0;_height:0;left:0;top:0;display:none}.yui-calcontainer .yui-cal-nav{position:absolute;z-index:3;top:0;display:none}.yui-calcontainer .yui-cal-nav .yui-cal-nav-btn{display:-moz-inline-box;display:inline-block}.yui-calcontainer .yui-cal-nav .yui-cal-nav-btn button{display:block;*display:inline-block;*overflow:visible;border:0;background-color:transparent;cursor:pointer}.yui-calendar .calbody a:hover{background:inherit}p#clear{clear:left;padding-top:10px}.yui-skin-sam .yui-calcontainer{background-color:#f2f2f2;border:1px solid #808080;padding:10px}.yui-skin-sam .yui-calcontainer.multi{padding:0 5px 0 5px}.yui-skin-sam .yui-calcontainer.multi .groupcal{background-color:transparent;border:0;padding:10px 5px 10px 5px;margin:0}.yui-skin-sam .yui-calcontainer .title{background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;border-bottom:1px solid #ccc;font:100% sans-serif;color:#000;font-weight:bold;height:auto;padding:.4em;margin:0 -10px 10px -10px;top:0;left:0;text-align:left}.yui-skin-sam .yui-calcontainer.multi .title{margin:0 -5px 0 -5px}.yui-skin-sam .yui-calcontainer.withtitle{padding-top:0}.yui-skin-sam .yui-calcontainer .calclose{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -300px;width:25px;height:15px;top:.4em;right:.4em;cursor:pointer}.yui-skin-sam .yui-calendar{border-spacing:0;border-collapse:collapse;font:100% sans-serif;text-align:center;margin:0}.yui-skin-sam .yui-calendar .calhead{background:transparent;border:0;vertical-align:middle;padding:0}.yui-skin-sam .yui-calendar .calheader{background:transparent;font-weight:bold;padding:0 0 .6em 0;text-align:center}.yui-skin-sam .yui-calendar .calheader img{border:0}.yui-skin-sam .yui-calendar .calnavleft{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -450px;width:25px;height:15px;top:0;bottom:0;left:-10px;margin-left:.4em;cursor:pointer}.yui-skin-sam .yui-calendar .calnavright{background:url(../../js/yui/assets/skins/sam/sprite.png) no-repeat 0 -500px;width:25px;height:15px;top:0;bottom:0;right:-10px;margin-right:.4em;cursor:pointer}.yui-skin-sam .yui-calendar .calweekdayrow{height:2em}.yui-skin-sam .yui-calendar .calweekdayrow th{padding:0;border:0}.yui-skin-sam .yui-calendar .calweekdaycell{color:#000;font-weight:bold;text-align:center;width:2em}.yui-skin-sam .yui-calendar .calfoot{background-color:#f2f2f2}.yui-skin-sam .yui-calendar .calrowhead,.yui-skin-sam .yui-calendar .calrowfoot{color:#a6a6a6;font-size:85%;font-style:normal;font-weight:normal;border:0}.yui-skin-sam .yui-calendar .calrowhead{text-align:right;padding:0 2px 0 0}.yui-skin-sam .yui-calendar .calrowfoot{text-align:left;padding:0 0 0 2px}.yui-skin-sam .yui-calendar td.calcell{border:1px solid #ccc;background:#fff;padding:1px;height:1.6em;line-height:1.6em;text-align:center;white-space:nowrap}.yui-skin-sam .yui-calendar td.calcell a{color:#06c;display:block;height:100%;text-decoration:none}.yui-skin-sam .yui-calendar td.calcell.today{background-color:#000}.yui-skin-sam .yui-calendar td.calcell.today a{background-color:#fff}.yui-skin-sam .yui-calendar td.calcell.oom{background-color:#ccc;color:#a6a6a6;cursor:default}.yui-skin-sam .yui-calendar td.calcell.oom a{color:#a6a6a6}.yui-skin-sam .yui-calendar td.calcell.selected{background-color:#fff;color:#000}.yui-skin-sam .yui-calendar td.calcell.selected a{background-color:#b3d4ff;color:#000}.yui-skin-sam .yui-calendar td.calcell.calcellhover{background-color:#426fd9;color:#fff;cursor:pointer}.yui-skin-sam .yui-calendar td.calcell.calcellhover a{background-color:#426fd9;color:#fff}.yui-skin-sam .yui-calendar td.calcell.previous{color:#e0e0e0}.yui-skin-sam .yui-calendar td.calcell.restricted{text-decoration:line-through}.yui-skin-sam .yui-calendar td.calcell.highlight1{background-color:#cf9}.yui-skin-sam .yui-calendar td.calcell.highlight2{background-color:#9cf}.yui-skin-sam .yui-calendar td.calcell.highlight3{background-color:#fcc}.yui-skin-sam .yui-calendar td.calcell.highlight4{background-color:#cf9}.yui-skin-sam .yui-calendar a.calnav{border:1px solid #f2f2f2;padding:0 4px;text-decoration:none;color:#000;zoom:1}.yui-skin-sam .yui-calendar a.calnav:hover{background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;border-color:#a0a0a0;cursor:pointer}.yui-skin-sam .yui-calcontainer .yui-cal-nav-mask{background-color:#000;opacity:.25;filter:alpha(opacity=25)}.yui-skin-sam .yui-calcontainer .yui-cal-nav{font-family:arial,helvetica,clean,sans-serif;font-size:93%;border:1px solid #808080;left:50%;margin-left:-7em;width:14em;padding:0;top:2.5em;background-color:#f2f2f2}.yui-skin-sam .yui-calcontainer.withtitle .yui-cal-nav{top:4.5em}.yui-skin-sam .yui-calcontainer.multi .yui-cal-nav{width:16em;margin-left:-8em}.yui-skin-sam .yui-calcontainer .yui-cal-nav-y,.yui-skin-sam .yui-calcontainer .yui-cal-nav-m,.yui-skin-sam .yui-calcontainer .yui-cal-nav-b{padding:5px 10px 5px 10px}.yui-skin-sam .yui-calcontainer .yui-cal-nav-b{text-align:center}.yui-skin-sam .yui-calcontainer .yui-cal-nav-e{margin-top:5px;padding:5px;background-color:#edf5ff;border-top:1px solid black;display:none}.yui-skin-sam .yui-calcontainer .yui-cal-nav label{display:block;font-weight:bold}.yui-skin-sam .yui-calcontainer .yui-cal-nav-mc{width:100%;_width:auto}.yui-skin-sam .yui-calcontainer .yui-cal-nav-y input.yui-invalid{background-color:#ffee69;border:1px solid #000}.yui-skin-sam .yui-calcontainer .yui-cal-nav-yc{width:4em}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn{border:1px solid #808080;background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 0;background-color:#ccc;margin:auto .15em}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn button{padding:0 8px;font-size:93%;line-height:2;*line-height:1.7;min-height:2em;*min-height:auto;color:#000}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn.yui-default{border:1px solid #304369;background-color:#426fd9;background:url(../../js/yui/assets/skins/sam/sprite.png) repeat-x 0 -1400px}.yui-skin-sam .yui-calcontainer .yui-cal-nav .yui-cal-nav-btn.yui-default button{color:#fff}
/* skins/standard/global.css */
body {font-family: sans-serif;color: #000;background: #fff url(../../skins/standard/global/body-back.gif) repeat-x;}body, td, th, input, dt, #titles {font-family: Verdana, sans-serif;font-size: small;}pre, code, kbd {font-size: medium;}#bugzilla-body {clear: both;}#bugzilla-body th {font-weight: bold;vertical-align: top;}#header {margin-bottom: 1em;}#header form, #header form input,#footer form, #footer form input{font-size: 95%;display: inline;}#header .links {border-left: 1px solid #747E93;border-right: 1px solid #747E93;border-bottom: 1px solid #747E93;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;padding: 0.5em;}#lang_links_container {float: right;white-space: nowrap;}#lang_links_container .links {border: none;padding: .5em;}.lang_current {font-weight: bold;}#message {border: 1px solid red;margin: 0.3em 0em;padding: 0.3em;color: green;}form.mini_login input.bz_login  {width: 10em;}form.mini_login input.bz_password {width: 6em;}form.mini_login input.bz_remember {margin: 0;}#banner {}#titles {width: 100%;background-color: #404D6C;color: #fff;border-top-left-radius: 5px;border-top-right-radius: 5px;margin: 0;vertical-align: bottom;display: table;}#titles a {color: #fff;}#titles p {margin: 0;padding: 0;}#titles #title {font-weight: bold;padding: 0.5em;white-space: nowrap;display: table-cell;}#titles #subtitle {font-weight: normal;text-align: center;padding: 0.5em;display: table-cell;}#titles #information {font-weight: normal;text-align: right;font-size: 90%;padding: 0.5em;white-space: nowrap;display: table-cell;}#footer {clear: both;margin-top: 1em;width: 100%;background: #edf2f2;border-top: 1px solid #ddd;border-bottom: 1px solid #ddd;}#footer #useful-links {padding-left: 1ex;padding-right: 1ex;}#footer ul {list-style-type: none;}#links-saved ul {display: inline;}#links-saved th {vertical-align: top;}#footer .label {white-space: nowrap;vertical-align: top;}#footer .links {vertical-align: top;}ul.links {margin: 0;padding: 0;list-style-type: none;}ul.links li {display: inline;white-space: nowrap;}table.tabs {width: 100%;}.tabs th, .tabs td {padding: 1em;}.tabs td {background: #eee;text-align: center;border-style: solid;border-color: black;border-width: 0px 0px 2px 0px;}.tabs td.selected {background: white;border-width: 2px 2px 0px 2px;}.tabs td.spacer {background: white;}a {color: #039;}a:visited {color: #636;}a:hover {color: #333;}a:active {color: #000;}.clickable_area {cursor: pointer;}textarea {font-family: monospace;}a.controller {font-size: 115%;}div#docslinks {float: right;border: 1px solid black;padding: 1ex;font-size: 80%;}#docslinks h2 {margin: 0;}.rss {background: transparent url(../../skins/standard/../../images/rss_small.png) no-repeat;padding-left: 16px;line-height: 1.5em;}.bz_bug_link {}.bz_bug_link.bz_status_UNCONFIRMED {font-style: italic;}.bz_obsolete {text-decoration: line-through;}.bz_inactive {text-decoration: line-through;}.bz_closed,.bz_CLOSED td {text-decoration: line-through;}.bz_private {color: darkred;background: #f3eeee;}.bz_disabled {color: #a0a0a0;}.bz_comment_table td {vertical-align: top;}.bz_comment {margin-bottom: 2em;}.bz_comment_text, .uneditable_textarea, tbody.file pre {font-family: monospace;white-space: pre-wrap;}.bz_comment_text {width: 50em;}.bz_comment_text span.quote {color: #65379c;white-space: pre;overflow: auto;display: block;}.bz_comment_user, .bz_comment_time, .bz_comment_number,.bz_private_checkbox, .bz_comment_actions{margin: 0 .5em;}.bz_comment_actions, .bz_comment_number, .bz_private_checkbox {float: right;}.bz_collapse_expand_comments {padding: 0;margin: 0 0 0 1em;list-style-type: none;}.bz_collapse_expand_comments li {margin-bottom: .5em;}.bz_collapse_comment {text-decoration: none;}.bz_private_checkbox input {margin: 0;vertical-align: middle;}.bz_comment_head, .bz_first_comment_head {padding-top: .1em;padding-bottom: .1em;padding-left: .5em;background-color: #e0e0e0;}.bz_comment_user_images img {vertical-align: bottom;}.bz_comment_hilite pre {background-color: lightgreen;margin: 0;padding: 1em 0;}.bz_comment_collapse_reason,.bz_default_collapsed .bz_comment_number {font-weight: normal;}.bz_default_hidden, .bz_tui_hidden, .bz_hidden_field, .bz_hidden_option {display: none !important;}table#flags th,table#flags td {vertical-align: middle;text-align: left;}#email_prefs, #saved_search_prefs, #shared_search_prefs,#bug_activity {border: 1px solid black;border-collapse: collapse;}#email_prefs th,#shared_search_prefs th,#saved_search_prefs th {text-align: center;}#email_prefs th, #email_prefs td,#shared_search_prefs th, #shared_search_prefs td,#saved_search_prefs th, #saved_search_prefs td,#bug_activity td {border: 1px solid;padding: 0.3em;}#email_prefs th.role_header {width: 10%;}#bug_activity td {vertical-align: top;}#user_prefs th, #user_prefs td {padding: 0.5em;}#permissions {margin-left: auto;margin-right: auto;width: 40em;}#permissions p {margin-top: 2em;margin-bottom: 0.5em;}#permissions li {list-style-type: none;}#permissions table td {vertical-align: top;}.column_header {background-color: #66f;}.column_header th {text-align: center;}.flag_select {min-width: 3em;}input.requestee {width: 15em;}#error_msg {font-size: x-large;}#post_err_msg, form#check {clear: both;}.warning {color: red;}.throw_error {background-color: red;color: black;font-size: 120%;margin-bottom: 2em;padding: 0.5em 1em;float: left;}.label {font-weight: bold;}.throw_error a:visited {color: darkblue ;}dt {font-weight: bold;}body > dl > dt {border-top: dotted gray thin;}dl dl > dt {border-top: none;}.arrow_button {font-size: 150%;}#attachment_table {border-collapse: collapse;border: 1px solid #333333;}#attachment_table th, .bz_attach_footer, .bz_time_tracking_table th,.dependency_tree_controls {background-color: #E0E0E0;color: black;}#attachment_table td, .bz_time_tracking_table th, .bz_time_tracking_table td {border: 1px solid #333333;}#attachment_table th, #attachment_table td {padding: 0.3em;}.bz_attach_extra_info, .bz_info {font-size: smaller;}.bz_attach_flags, .bz_attach_footer, .bz_flags, .nowrap {white-space: nowrap;}.bz_attach_view_hide {float: right;padding-left: 1em;}#user_match_table {border-collapse: collapse;}#user_match_table td {vertical-align: top;border-bottom: 1px solid black;padding: 1em 0.5em;}div.user_match {margin-bottom: 1em;}.indented {margin-left: 3em;}.box {border: 1px solid black;color: black;background-color: #ffc;margin: 1em;padding: 0.5em 1em;}.collapsed,.bz_default_collapsed .bz_private_checkbox,.bz_default_collapsed .bz_comment_user,.bz_default_collapsed .bz_comment_user_images,.bz_default_collapsed .bz_comment_time,.bz_default_collapsed .bz_comment_tags,.bz_default_collapsed .bz_comment_text,.bz_default_collapsed .bz_collapsed_actions{display: none;}#serverpush_msg {margin-top: 20%;text-align: center;font-size: xx-large;}@media print {#header, #footer {display: none;}div.bz_query_buttons {display: none;}body {background-image: none;background-color: #fff;}}.field_label {text-align: right;vertical-align: top;font-weight: bold;}.field_help_link {cursor: help;}.field_value, form#Create th, form#Create td, .top {vertical-align: top;}.bottom {vertical-align: bottom;}.field_value .text_input {width: 100%;min-width: 25em;}.uneditable_textarea {max-width: 30em;font-size: medium;}th.required:before {content: "* ";}th.required:before, span.required_star {color: red;}input.required, select.required, span.required_explanation {background-color: #fff7cd;color: #000;}.calendar_button {background: transparent url(../../skins/standard/global/calendar.png) no-repeat;width: 20px;height: 20px;vertical-align: middle;}.calendar_button span { display: none }.yui-calcontainer {display: none;background-color: white;padding: 10px;border: 1px solid #404D6C;}.bug_urls {margin: 0;padding: 0;list-style-type: none;}pre.field_textarea_readonly {margin: 2px;padding: 4px;overflow: auto;float: left;max-width: 30em;max-height: 7em;border: 1px solid #CCC;font-family: monospace;white-space: pre-wrap;}.yui-skin-sam .yui-ac-input { position:static !important;vertical-align:middle !important; }.yui-skin-sam .yui-ac-container { left:0px !important; }.yui-skin-sam .yui-ac { display: inline-block; }#bugzilla-body .yui-ac-content {max-height: 19em;overflow: auto;overflow-x: hidden;}#keywords_container {padding-top: .2em;}#keywords_container .yui-ac-content {margin-left: -1px;}#comment_tabs {border-spacing: 0;}.comment_tab {display: table-cell;border: 1px solid silver;padding: 2px 1em;cursor: pointer;background: transparent;}.active_comment_tab {background: #fff;font-weight: bold;}#comment_preview {border: 1px solid silver;padding: 1px;overflow: auto;margin: 0px;}#comment_preview_text {margin: 0px;width: auto;}#comment_preview_loading {font-style: italic;}#comment {margin: 0px 0px 1em 0px;}.validation_error_text {font-size: 120%;color: #B70000;font-weight: bold;}.validation_error_field, input.validation_error_field {border: 2px solid #B70000;background-color: #FFEBEB;}form th {text-align: right;}.left {text-align: left;}.center {text-align: center;}.right {text-align: right;}.middle {vertical-align: middle;}.inline {display: inline;}tr.shared_search {background-color: #fff7cd;color: #000;}.multi-columns {columns: 3;-moz-columns: 3;-webkit-columns: 3;}#page-index {padding: 0.2em 0.2em 0.15em 0.2em;max-width: 1000px;}.intro, .outro {text-align: center;}#new_release {border: 2px solid red;padding: 0.5em 1em;margin: 1em;font-weight: bold;}#new_release .notice {font-size: 80%;font-weight: normal;}#welcome-admin a {font-weight: bold;}.bz_common_actions {text-align: center;}.bz_common_actions ul {list-style-type: none;padding: 0;}.bz_common_actions ul li {display: inline;vertical-align: top;}.bz_common_actions ul li a {display: inline-block;height: 170px;width: 145px;margin: 0 2ex 2em 0;}.bz_common_actions ul li a span {position: relative;top: 90%;font-weight: bold;}.bz_common_actions a,.bz_common_actions a:visited,.bz_common_actions a:hover {text-decoration: none;}#enter_bug { background: url(../../skins/standard/index/file-a-bug.png)  no-repeat; }#query     { background: url(../../skins/standard/index/search.png)      no-repeat; }#account   { background: url(../../skins/standard/index/new-account.png) no-repeat; }#help      { background: url(../../skins/standard/index/help.png)        no-repeat; }#quicksearchForm {clear: both;text-align: center;margin-bottom: 2em;}#quicksearchForm #quicksearch_main {width: 27em;}#quicksearchForm {margin: 0;padding: 0;}#page-index table {border-collapse: collapse;margin: auto;}#welcome {font-size: x-large;font-weight: bold;text-align: center;margin: 0 0 0.8em 0;padding: 0;}#common_queries ul {list-style: none;padding-left: 1.5em;}#common_queries li a {text-decoration: none;}ul#quicksearch_links {margin-bottom: 1em;}ul.additional_links {list-style: none;margin: 0;padding: 0;}ul.additional_links li {display: inline;}ul.additional_links li.bz_default_hidden {display: none;}body.narrow_page #bugzilla-body > * {max-width: 45em;}.req_new {color: red;}.req_table {border-collapse: collapse;}.req_table td, .req_table th {border: 1px solid black;padding: .25em;}.qs_help li {margin-top: 1ex;}.qs_fields th {padding: 0 .25em;}.qs_fields th.field_nickname {text-align: left;}.qs_fields td {padding: .25em;border-top: 1px solid gray;}.qs_fields .field_name {width: 10em;}table.field_value_explanation {table-layout: fixed;border-collapse: collapse;}.field_value_explanation thead h2 {margin: 0;}.field_value_explanation .header_row td {text-align: center;font-size: 120%;font-weight: bold;}.field_value_explanation tbody td {border: 1px solid black;padding: 1em;}.field_value_explanation dt, .field_descriptions dt {margin-top: 1em;}.field_descriptions dt {font-size: 120%;}#duplicates_table {border-collapse: collapse;}#duplicates_table .resolved {background-color: #d9d9d9;color: black;}#duplicates_table thead tr {background-color: #ccc;color: black;}#duplicates_table thead tr th {vertical-align: middle;}#duplicates_table td, #duplicates_table th {border: 1px solid black;padding: .1em .25em;}#duplicates_table tbody td {text-align: center;}#duplicates_table tbody td.short_desc {text-align: left;}
/* skins/standard/bug.css */
.enter_bug_form table {border-spacing: 0;border-width: 0;}.enter_bug_form td, .enter_bug_form th {padding: .25em;}.enter_bug_form th {text-align: right;}#Create #field_container_component {width: 1px;}#Create #field_container_reporter {width: 100%;}#Create .comment, #guided_form #description {vertical-align: top;overflow: auto;color: green;}#guided_form #description {display: inline;margin-left: 10px;}#Create #comp_desc_container td {padding: 0;}#Create #comp_desc {height: 11ex;}#Create #os_guess_note {padding-top: 0;}#Create #os_guess_note div {max-width: 35em;}#Create .field_value .text_input {max-width: 50em;}#possible_duplicates th {text-align: center;background: none;border-collapse: collapse;}#possible_duplicates td {vertical-align: middle;}#possible_duplicates .yui-dt-col-update_token {white-space: nowrap;}table#flags th, table#flags td,table#bug_flags th, table#bug_flags td,table#attachment_flags th, table#attachment_flags td {text-align: left;vertical-align: baseline;font-size: small;}.guided_form_field {background-color: #ffc;}#somebugs {width: 100%;height: 500px;}.good {color: #090;}.bad {color: #900;}.bz_short_desc_container {margin: 8px 0;padding: 0.3em;background-color: rgb(208, 208, 208);border-radius: 0.5em;font-size: 125%;font-weight: bold;}.bz_bug .edit_form {width: 100%;}.bz_bug .edit_form table {width: 100%;}.bz_bug #alias {min-width: 0;width: 10em;}table#flags {width: auto;}.bz_column_spacer {width: 0.5em;}.related_actions {font-size: 0.85em;float: right;list-style-type: none;white-space: nowrap;margin: 0;padding: 0;}.related_actions li {display: inline;}.navigation_link {color: #777;font-style: italic;}.bz_show_bug_column {vertical-align: top;}.bz_section_spacer {height: 1em;}#duplicate_settings {white-space: nowrap;}#bz_big_form_parts td {vertical-align: top;}.bz_group_visibility_section {margin-left: 1em;}.bz_group_visibility_section .instructions {font-style: italic;}#bz_restrict_group_visibility_help .instructions {margin-top: 0;}#bz_enable_role_visibility_help {margin-top: 1em;}.bz_time_tracking_table {border-collapse: collapse;}.bz_time_tracking_table th {text-align: center;}.bz_time_tracking_table td {text-align: center;}.bz_time_tracking_table th,.bz_time_tracking_table td {padding: 4px;}.bz_time_tracking_table .bz_summarize_time {text-align: right;}.bz_time_tracking_table #deadline {width: 7em;}#summary tr td {vertical-align:top;}#status {margin-bottom: 3ex;}.knob-buttons {float: right;}.text_input, .bz_userfield, #keywords_container, #tag_container {width: 100%;}.bz_bug .bz_short_desc_container {width: inherit;}.bz_comment_tags {margin-top: 3px;}.bz_comment_tag {border: 1px solid #c8c8ba;padding: 1px 3px;margin-right: 2px;border-radius: 0.5em;background-color: #eee;color: #000;}#bz_ctag_div {display: inline-block;}#bz_ctag_error {border: 1px solid #ff6666;padding: 0px 2px;border-radius: 0.5em;margin: 2px;display: inline-block;}#comment_tags_collapse_expand_container {padding-top: 1em;}#comment_tags_collapse_expand {list-style-type: none;padding-left: 1em;}#comment_tags_collapse_expand li {margin-bottom: 0px;}ul.tree {padding-left: 0em;margin-left: 1em;display: block;}ul.tree ul {padding-top: 3px;display: block;}ul.tree li {padding-top: 3px;text-indent: -1.2em;padding-left: 0.5em;padding-bottom: 3px;list-style-type: none;background: url(../../skins/standard/dependency-tree/bug-item.png) no-repeat;}ul.tree li a.b {padding-left: 30px;margin-right: -14px;text-decoration: none;}ul.tree li a.b_open {background: url(../../skins/standard/dependency-tree/tree-open.png) center no-repeat;cursor: pointer;}ul.tree li a.b_closed {background: url(../../skins/standard/dependency-tree/tree-closed.png) center no-repeat;cursor: pointer;}ul.tree a.tree_link img {border: 0;}.summ_info {display: none;font-size: 75%;}.hint {font-size: 90%;margin: 0.2em;padding: 0.1em;}.hint h3, .hint ul {margin-top: 0.1em;margin-bottom: 0.1em;}.summ A, .summ_deep A {text-decoration: none;color: darkblue;}.summ_h A {background-color: #ffffaa;color: #333;font-weight: bold;}.dependency_tree_controls input[type=submit] {min-width: 3em;}table.attachment_entry th {text-align: right;vertical-align: baseline;white-space: nowrap;}table.attachment_entry td {text-align: left;vertical-align: baseline;padding-bottom: 5px;}.file_head {font-weight: bold;font-size: 1em;background-color: #c3c3c3;border: 1px solid black;}.file_head a {text-decoration: none;font-family: monospace;font-size: 1.1em;}.file_collapse {display: none;}.section_head {background-color: #f0f0f0;border: 1px solid black;text-align: left;padding: 0.2em;}.section_head .link_here {float: right;padding-left: 1em;padding-right: 0.5em;}.lines_count a {padding-left: 0.5em;padding-right: 1em;}table.file_table {table-layout: fixed;width: 100%;empty-cells: show;border-spacing: 0px;border-collapse: collapse;border-bottom: 1px solid black;}tbody.file pre {display: inline;font-size: 0.9em;}tbody.file pre:empty {display: block;}.changed {background-color: lightblue;}.added {background-color: lightgreen;}.removed {background-color: #FFCC99;}.num {background-color: #ffe9ae;text-align:right;padding: 0 0.3em;width: 3em;}table.attachment_info th {text-align: right;vertical-align: top;}table.attachment_info td {text-align: left;vertical-align: top;}#noview {text-align: left;vertical-align: middle;}#attachment_attributes div {padding-bottom: 0.4em;}#attachment_attributes label {font-weight: bold;}#attachment_attributes .block {display: block;}#smallCommentFrame, #attachment_flags {float: left;}#smallCommentFrame {margin-right: 1.5em;}#attachment_comments_and_flags, #attachment_actions {clear: both;margin-bottom: 1ex;}#attachment_information_read_only .title {font-weight: bold;font-size: 1.5em;padding: 0;margin: 0;}#attachment_information_read_only .title #bz_edit {font-size: 0.7em;}#attachment_information_read_only .details {font-size: 90%;}#attachment_info.read #attachment_information_edit {display: none;}#attachment_info.edit #attachment_information_read_only {display: none;}#attachment_info.edit #attachment_view_window {float: left;width: 80%;}#attachment_info.edit #attachment_information_edit {width: 20%;}#attachment_info.edit #attachment_information_edit input.text,#attachment_info.edit #attachment_information_edit textarea {width: 90%;}#attachment_isobsolete {padding-right: 1em;}#attachment_information_edit {float: left;}#smallCommentFrame textarea {display: block;}textarea.bz_private {border: 1px solid #F8C8BA;}#update {clear: both;display: block;}div#update_container {clear: both;padding: 1.5em 0;}#attachment_flags {margin-bottom: 1em;}#attachment_flags p {padding-bottom: 0;margin-bottom: 0;}#editFrame, #viewDiffFrame, #viewFrame {height: 400px;width: 95%;margin-left: 2%;}.viewall_frame_container {width: 75%;margin: 2em auto;}.viewall_desc {width: 100%;border: 1px solid black;border-spacing: 0px;border-collapse: collapse;}.viewall_desc th, .viewall_desc td {border: 1px solid black;padding: 0.3em;}.viewall_frame {width: 100%;height: 350px;}.no_javascript .bz_hide, .no_javascript .bz_edit {display: none;}#hidden_obsolete_message {text-align: left;width: 75%;margin: 0  auto;font-weight: bold;}
/* skins/contrib/Dusk/global.css */
body {background: #c8c8c8;font-family: Helvetica, Arial, Geneva;padding-left: 1em;padding-right: 1em;}#titles {border-top-left-radius: 5px;border-top-right-radius: 5px;}#header .links, #footer {background-color: #929bb1;color: #ddd;}#header {border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;border: none;}#header a, #footer a {color: white;text-decoration: none;}#header a:hover, #footer a:hover {text-decoration: underline;}#bugzilla-body {background: #f0f0f0;color: black;border: 1px solid #747e93;padding: 10px;font-size: 10pt;border-radius: 5px;}a {color: #6070cf;}a:hover {color: #8090ef;}hr {border-color: #969696;border-style: dashed;border-width: 1px;margin-top: 10px;}#bug-form td {padding-top: 2px;}#attachment-list {border: 2px solid #c8c8ba;font-size: 9pt;}#attachment-list th {background-color: #e6e6d8;border: none;border-bottom: 1px solid #c8c8ba;text-align: left;}#attachment-list th a {color: #646456;}#attachment-list td {border: none;}#attachment-list-actions td {border-top: 1px solid #c8c8ba;}#comments th {font-size: 9pt;font-weight: bold;padding-top: 5px;padding-right: 5px;padding-bottom: 10px;text-align: right;vertical-align: top;white-space: nowrap;}#comments td {padding-top: 2px;}.reply-button a {padding-left: 2px;padding-right: 2px;}.bz_comment {background-color: #e8e8e8;margin: 1px 1px 10px 1px;border-width: 1px;border-style: solid;border-color: #c8c8ba;padding: 5px;font-size: 9pt;}.bz_comment_head, .bz_first_comment_head {margin: 0; padding: 0;background-color: transparent;font-weight: bold;}.bz_comment_user {margin-left: 0;}.bz_comment.bz_private {background-color: #f0e8e8;border-color: #f8c8ba;}.comment_rule {display: none;}#footer {border: 1px solid #747e93;width: 100%;border-radius: 5px;}#footer #links-actions,#footer #links-edit,#footer #links-saved,#footer #links-special {margin-top: 2ex;}#footer .links {border-spacing: 30px;margin-bottom: 2ex;}.separator {color: #cccccc;}.tabbed .tabbody {background: #f8f8f8;padding: 1em;border-style: solid;border-color: #000000;border-width: 0 3px 3px 1px;}.tabs {margin: 0;padding: 0;border-collapse: collapse;}.tabs td {background: #c8c8c8;border-width: 1px;}.tabs td.selected {background: #f8f8f8;border-width: 1px 3px 0 1px;}.tabs td.spacer {background: transparent;border-top: none;border-left: none;border-right: none;}.bz_row_odd {background-color: #f0f0f0;}#page-index .outro {clear:both;}@media print {#header,#footer,.navigation {display: none;}body {background-image: none;background-color: #ffffff;}#bugzilla-body {border: none;margin: 0;padding: 0;}}
</style>

<style>/* skins/custom/global.css */
#banner > div {border-radius: 5px;}#banner a {color: #6070cf}
</style>

    


    


    

    
    <link rel="search" type="application/opensearchdescription+xml" title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><link href="https://c.s-microsoft.com/mscc/statics/mscc-0.4.1.min.css" rel="stylesheet" type="text/css">

      

    <style>.wrapper {
    margin: 0 auto;
    box-sizing: border-box;
    -ms-box-sizing: border-box;
}

#global-footer {
    background-color: #354b60;
}

#global-footer li,#global-footer ul {
    list-style: none;
    padding: 0;
    border: 0;
    margin: 0;
    font: inherit;
    color: inherit;
    line-height: normal
}

#global-footer footer {
    margin-top: 60px;
    background: rgba(44,62,80,.5);
    clear: both;
    padding: 30px;
    margin: 0;
    font-size: 14px;
    color: #ecf0f1;
}

#global-footer footer .wrapper {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -ms-flex-align: center;
    /* align-items:center; */
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
}

#global-footer footer .microsoft-logo img {
    display: block;
    margin: 0 auto;
    width: 110px;
}

#global-footer footer .contact {
    text-align: left
}

#global-footer footer .legal {
    text-align: right
}

#global-footer footer a,#global-footer footer span {
    padding: 0 10px
}

#global-footer footer a {
    color: inherit;
    text-decoration: none;
}

#global-footer footer a:hover {
    color: #fff;
    text-decoration: none;
}

#global-footer .sub-footer {
    background-color: #233140;
    color: hsla(0,0%,100%,.7);
    font-size: 14px;
    padding: 3px;
    -webkit-font-smoothing: antialiased;
    -moz-font-smoothing: antialiased
}

@media (max-width: 992px) {
    html:not(.non-responsive) #global-footer footer {
        padding:0
    }

    html:not(.non-responsive) #global-footer footer .wrapper {
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        max-width: 430px
    }

    html:not(.non-responsive) #global-footer footer .microsoft-logo {
        -webkit-box-ordinal-group: 1;
        -ms-flex-order: 0;
        order: 0
    }

    html:not(.non-responsive) #global-footer footer .wrapper>:not(.microsoft-logo) {
        -webkit-box-ordinal-group: 2;
        -ms-flex-order: 1;
        order: 1
    }

    html:not(.non-responsive) #global-footer footer .contact,html:not(.non-responsive) #global-footer footer .legal,html:not(.non-responsive) #global-footer footer .microsoft-logo {
        float: none;
        padding: 20px 0;
        text-align: center
    }

    html:not(.non-responsive) #global-footer footer .contact,html:not(.non-responsive) #global-footer footer .legal {
        padding-top: 0
    }
}
</style>
  </head>

  <body class="bugzilla-xamarin-com
                 bz_bug
                 bz_status_CONFIRMED
                 bz_product_Runtime
                 bz_component_GC
                 bz_bug_33020 yui-skin-sam">

  <div id="header">

    <div id="titles">
      <span id="title">Bugzilla – Bug&nbsp;33020</span>

        <span id="subtitle" class="subheader">Hang in System.Environment.Exit</span>

        <span id="information" class="header_addl_info">Last modified: 2017-09-06 15:34:26 UTC</span>
    </div>


    <div id="common_links">
    </div>
  </div>

  <div id="bugzilla-body">




<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2017-09-06 15:34:26">
  <input type="hidden" name="id" value="33020">
  <input type="hidden" name="token" value="1559158718-jT7WOYNhEuHUVhcR-I91Lmuf0Sss0Z-ip4oMdd_m5aM">
<div class="bz_short_desc_container edit_form">
     <a href="bug.html"><b>Bug&nbsp;33020</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">Hang in System.Environment.Exit</span>
     </span>

    <div id="summary_input"><span class="field_label " id="field_label_short_desc">


  <a title="The bug summary is a short sentence which succinctly describes what the bug is about." class="field_help_link" href="#">Summary:</a>

</span>Hang in System.Environment.Exit
    </div>
  </div>
  
  <table class="edit_form">
    <tbody><tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">
        <table>
          <tbody><tr>
    <th class="field_label">
      <a href="#">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CONFIRMED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_alias">


  <a title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla." class="field_help_link" href="#">Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_product">


  <a title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list." class="field_help_link" href="#">Product:</a>

</th>
  <td class="field_value " id="field_container_product">Runtime

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label " id="field_label_classification">


  <a title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation." class="field_help_link" href="#">Classification:</a>

</th>
  <td class="field_value " id="field_container_classification">Mono

</td>
    </tr>
    
    
    
    <tr><th class="field_label " id="field_label_component">


  <a title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list." class="field_help_link" href="#">Component:</a>

</th>
  <td class="field_value " id="field_container_component">GC

  ()
</td>
    </tr>
    <tr><th class="field_label " id="field_label_version">


  <a title="The version field defines the version of the software the bug was found in." class="field_help_link" href="#">Version:</a>

</th>
<td>4.8.0 (C9)
  </td>
    </tr>
    
    
    
    <tr><th class="field_label " id="field_label_rep_platform">


  <a title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;." class="field_help_link" href="#">Hardware:</a>

</th>
      <td class="field_value">PC
        Linux
      </td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
      <th class="field_label">
        <label accesskey="i">
          <a href="#"><u>I</u>mportance</a></label>:
      </th>
      <td>---
       normal
      </td>
    </tr>

      <tr><th class="field_label " id="field_label_target_milestone">


  <a title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it." class="field_help_link" href="#">Target Milestone:</a>

</th><td>---
  </td>
      </tr>

          <tr><th class="field_label " id="field_label_assigned_to">


  <a title="The person in charge of resolving the bug." class="field_help_link" href="#">Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Bugzilla</span>
</span>
      </td>
    </tr>

    
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_bug_file_loc">


  <a title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen." class="field_help_link" href="#">URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label " id="field_label_dependson">


  <a title="The bugs listed here must be resolved before this bug can be resolved." class="field_help_link" href="#">Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>

  <tr><th class="field_label " id="field_label_blocked">


  <a title="This bug must be resolved before the bugs listed in this field can be resolved." class="field_help_link" href="#">Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>

        </tbody></table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tbody><tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2015-08-12 15:29 UTC by <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
    </td>
  </tr>

  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2017-09-06 15:34 UTC
      (<a href="activity.html">History</a>)
    </td>

  </tr>
<tr>
      <th class="field_label">
        <label accesskey="a">
          CC List:
        </label>
      </th>
      <td>8
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="alex.koeplinger">alex.koeplinger</option>
                <option value="jo.shields">jo.shields</option>
                <option value="masafa">masafa</option>
                <option value="meebey">meebey</option>
                <option value="mono-bugs+mono">mono-bugs+mono</option>
                <option value="mono-bugs+runtime">mono-bugs+runtime</option>
                <option value="vargaz">vargaz</option>
                <option value="WoefulDerelict">WoefulDerelict</option>
            </select>
        </div>
          
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr>
      <th class="field_label " id="field_label_cf_tags">


  <a title="A custom Free Text field in this installation of Bugzilla." class="field_help_link" href="#">Tags:</a>

</th>
  <td class="field_value " id="field_container_cf_tags">

</td>
    </tr>
    <tr>
      <th class="field_label " id="field_label_cf_bug_regression">


  <a title="If this bug is not a regression select no, otherwise select yes and complete the &quot;last known good build&quot; entry." class="field_help_link" href="#">Is this bug a regression?:</a>

</th>
  <td class="field_value " id="field_container_cf_bug_regression">---

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field" id="field_label_cf_bug_regression_build">


  <a title="What is the last known good build? (e.g. C7, 4.5.x, etc.)" class="field_help_link" href="#">Last known good build:</a>

</th>
  <td class="field_value  bz_hidden_field" id="field_container_cf_bug_regression_build">

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </tbody></table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </tbody></table>

  <table id="bz_big_form_parts">
  <tbody><tr>
  <td>

    


<br>
<table id="attachment_table">
  <tbody><tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain">
        <td>
            <a href="https://bugzilla.xamarin.com/attachment.cgi?id=18236&amp;file=thread.list" title="View the content of the attachment">
          <b>MonoThreadInfo dump and Thread Backtrace</b></a>

          <span class="bz_attach_extra_info">
              (32.07 KB,
                text/plain)

            <br>
            <a href="#attach_18236" title="Go to the comment associated with the attachment">2016-10-26 17:27 UTC</a>,

            <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
          </span>
        </td>


        <td>
          <a href="https://bugzilla.xamarin.com/attachment.cgi?id=18236&amp;file=thread.list">Details</a>
        </td>
      </tr>

  
</tbody></table>
<br>

  </td>
  <td>
  </td>
  </tr></tbody></table>
<hr>

<div id="add_comment" class="bz_section_additional_comments">
<div class="box" style="margin: 1px 1px 10px 1px; max-width: 47.8em">
    <p>
        <strong>Notice (2018-05-24)</strong>: bugzilla.xamarin.com is now in
        <strong>read-only</strong> mode.
    </p>
    <p>
        Please join us on
        <a href="https://developercommunity.visualstudio.com/spaces/8/index.html">
        Visual Studio Developer Community</a> and in the
        <a href="https://github.com/xamarin">Xamarin</a> and
        <a href="https://github.com/mono">Mono</a> organizations on
        GitHub to continue tracking issues. Bugzilla will remain
        available for reference in read-only mode. We will continue to work
        on <strong>open</strong> Bugzilla bugs, copy them to the new locations
        as needed for follow-up, and add the new items under <strong>Related
        Links</strong>.
    </p>
    <p>
        Our sincere thanks to everyone who has contributed on this bug
        tracker over the years. Thanks also for your understanding as we
        make these adjustments and improvements for the future.
    </p>
    <hr><p>
        <strong>Please create a new report for Bug&nbsp;33020</strong> on 
            <a href="https://github.com/mono">GitHub</a> or <a href="https://docs.microsoft.com/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017">Developer Community</a> if you have new
        information to add and do not yet see a matching new report. </p>
    <p>
        If the latest results still closely match this report, you can use the
        original description:
    </p>
    <ul>
        <li>
            Export the original title and description:
            <span class="bz_comment_tag" style="display:inline-block">
                <a href="bug.html">GitHub Markdown</a>
            </span> or
            <span class="bz_comment_tag" style="display:inline-block">
                <a href="bug.html">Developer Community HTML</a>
            </span>
        </li>
        <li>
            Copy the title and description into the new report. Adjust them
            to be up-to-date if needed.
        </li>
        <li>Add your new information.</li>
    </ul>
    <p>In special cases on GitHub you might also want the comments:
        <span class="bz_comment_tag" style="display:inline-block">
            <a href="bug.html">GitHub Markdown with public comments</a>
        </span>
    </p>
</div>

    <div style="margin: 4ex 0">
        <table><tbody><tr><th class="field_label " id="field_label_see_also">


  <a title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields." class="field_help_link" href="#">Related Links:</a>

</th>
  <td class="field_value " id="field_container_see_also">

</td>
    </tr>
        </tbody></table>
    </div>

    <table id="bug_status_bottom" class="status">
        <tbody><tr>
            <th class="field_label">
                <a href="#">Status</a>:
            </th>
            <td><div id="status">CONFIRMED


  <span id="resolution_settings">
  </span>

</div>


            </td>
        </tr>
    </tbody></table>

</div>
    <hr>

  
  <div id="comments">




<!-- This auto-sizes the comments and positions the collapse/expand links
     to the right. -->
<table class="bz_comment_table">
<tbody><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-08-12 15:29:41 UTC
        </span>

      </div>




<pre class="bz_comment_text">Using the following script:

while [ 1 ]
do 
    MONO_PATH=$HOME/mono/mcs/class/lib/net_4_x  ../../runtime/mono-wrapper subthread-exit.exe &gt;/dev/null
    echo -n "$? "
done

After anywhere between 20 and 800 iterations the process will hang. 

gdb shows the following:

Thread 4 (Thread 0x7f5ed4fff700 (LWP 16717)):
#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185
#1  0x00000000005f78bc in thread_func (thread_data=0x0) at sgen-thread-pool.c:118
#2  0x00007f5ed5bf3182 in start_thread (arg=0x7f5ed4fff700) at pthread_create.c:312
#3  0x00007f5ed592047d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 3 (Thread 0x7f5ed2d15700 (LWP 16718)):
#0  sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85
#1  0x000000000061ac07 in mono_sem_wait (sem=sem@entry=0x949c00 &lt;finalizer_sem&gt;, alertable=alertable@entry=1)
    at mono-semaphore.c:107
#2  0x00000000005a13b6 in finalizer_thread (unused=&lt;optimized out&gt;) at gc.c:1096
#3  0x0000000000583e2b in start_wrapper_internal (data=&lt;optimized out&gt;) at threads.c:723
#4  start_wrapper (data=&lt;optimized out&gt;) at threads.c:770
#5  0x0000000000621746 in inner_start_thread (arg=0x7ffc03654980) at mono-threads-posix.c:97
#6  0x00007f5ed5bf3182 in start_thread (arg=0x7f5ed2d15700) at pthread_create.c:312
#7  0x00007f5ed592047d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 2 (Thread 0x7f5ed2b14700 (LWP 16719)):
#0  0x00007f5ed5bfab9d in nanosleep () at ../sysdeps/unix/syscall-template.S:81
#1  0x0000000000633339 in monoeg_g_usleep (microseconds=60560) at gdate-unix.c:53
#2  0x000000000061f63b in suspend_sync_nolock (id=id@entry=140045301499840, interrupt_kernel=interrupt_kernel@entry=1)
    at mono-threads.c:869
#3  0x000000000061faa2 in mono_thread_info_safe_suspend_and_run (id=140045301499840, 
    interrupt_kernel=interrupt_kernel@entry=1, callback=callback@entry=0x580e90 &lt;suspend_thread_critical&gt;, 
    user_data=user_data@entry=0x7f5ed2b13430) at mono-threads.c:890
#4  0x0000000000581959 in suspend_thread_internal (thread=0x7f5ed667c130, interrupt=1) at threads.c:4532
#5  0x000000000058313f in mono_thread_suspend_all_other_threads () at threads.c:3152
#6  0x00000000005373e6 in ves_icall_System_Environment_Exit (result=0) at icall.c:5999
#7  0x00000000405376a2 in ?? ()
#8  0x00007f5ec4001910 in ?? ()
#9  0x00007f5ed5000620 in ?? ()
#10 0x00007f5ed5000448 in ?? ()
#11 0x00007f5ed5000448 in ?? ()
#12 0x00007f5ed5000560 in ?? ()
#13 0x00007f5ec4000e10 in ?? ()
#14 0x00000000405356f8 in ?? ()
#15 0x00007f5ed2b13a30 in ?? ()
#16 0x00007f5ed2b13910 in ?? ()
#17 0x00000000405356f3 in ?? ()
#18 0x00007f5ed2b13a30 in ?? ()
#19 0x00007f5ed2eb6fcb in System_Threading_ThreadHelper_ThreadStart_Context_object (state=0x0)
    at /root/mono/external/referencesource/mscorlib/system/threading/thread.cs:68
#20 0x00007f5ed2e8dc77 in System_Threading_ExecutionContext_RunInternal_System_Threading_ExecutionContext_System_Threading_ContextCallback_object_bool (executionContext=..., callback=..., state=0x7f5ed5000560, preserveSyncCtx=false)
    at /root/mono/external/referencesource/mscorlib/system/threading/executioncontext.cs:581
#21 0x00007f5ed2e8daa1 in System_Threading_ExecutionContext_Run_System_Threading_ExecutionContext_System_Threading_ContextCallback_object_bool (executionContext=..., callback=..., state=0x7f5ed5000560, preserveSyncCtx=false)
    at /root/mono/external/referencesource/mscorlib/system/threading/executioncontext.cs:530
#22 0x00007f5ed2e8da2a in System_Threading_ExecutionContext_Run_System_Threading_ExecutionContext_System_Threading_ContextCallback_object (executionContext=..., callback=..., state=0x7f5ed5000560)
    at /root/mono/external/referencesource/mscorlib/system/threading/executioncontext.cs:519
#23 0x00007f5ed2eb711f in System_Threading_ThreadHelper_ThreadStart (this=...)
    at /root/mono/external/referencesource/mscorlib/system/threading/thread.cs:105
#24 0x0000000040535669 in ?? ()
#25 0x000000000000001f in ?? ()
#26 0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f5ed672c7c0 (LWP 16708)):
#0  sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85
#1  0x000000000061ac07 in mono_sem_wait (sem=sem@entry=0xd3a970, alertable=alertable@entry=0) at mono-semaphore.c:107
#2  0x000000000061f92a in mono_thread_info_wait_for_resume (info=&lt;optimized out&gt;) at mono-threads.c:110
#3  mono_thread_info_end_self_suspend () at mono-threads.c:691
#4  0x000000000058398c in self_suspend_internal (thread=0x7f5ed667c130) at threads.c:4547
#5  mono_thread_execute_interruption (thread=thread@entry=0x7f5ed667c130) at threads.c:4048
#6  0x0000000000584e39 in ves_icall_System_Threading_Thread_Sleep_internal (ms=1200) at threads.c:1204
#7  0x0000000040535542 in ?? ()
#8  0x0000000000da0960 in ?? ()
#9  0x00007ffc03654b70 in ?? ()
#10 0x0000000040534e40 in ?? ()
#11 0x0000000000d3fb10 in ?? ()
#12 0x0000000040534d50 in ?? ()
#13 0x0000000000d628e0 in ?? ()
#14 0x00007f5ed672c758 in ?? ()
#15 0x00007ffc03654880 in ?? ()
#16 0x00007ffc03654790 in ?? ()
#17 0x00007f5ed2eb79c7 in System_Threading_Thread_Sleep_int (millisecondsTimeout=1200)
    at /root/mono/external/referencesource/mscorlib/system/threading/thread.cs:715
#18 0x0000000040534de6 in ?? ()
#19 0x00007f5ed50004a8 in ?? ()
#20 0x00007f5ed5000448 in ?? ()
#21 0x0000000040534d50 in ?? ()
#22 0x0000000040534f28 in ?? ()
#23 0x000000000000001f in ?? ()
#24 0x0000000000000000 in ?? ()

Thread 2 is continually waking up and sleeping again, each time incrementing the microsecond count by 10.

Ubuntu 14.04.3 LTS - Linux ubuntu11-x64-01 3.16.0-45-generic #60~14.04.1-Ubuntu SMP Fri Jul 24 21:16:23 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

Neale</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexander Köplinger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-09-14 06:45:53 UTC
        </span>

      </div>




<pre class="bz_comment_text">I think I see the same hang with a bunch of other runtime tests: <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed" title="RESOLVED FIXED - Some runtime tests occasionally hang on Linux amd64" href="https://bugzilla.xamarin.com/show_bug.cgi?id=33283">https://bugzilla.xamarin.com/show_bug.cgi?id=33283</a></pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mirco Bauer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-25 17:33:30 UTC
        </span>

      </div>




<pre class="bz_comment_text">I can reproduce this issue on Mono 4.2.1. That test code hangs in 1 out of 10 runs for me.

mono -V
Mono JIT compiler version 4.2.1 (Debian 4.2.1.102+dfsg2-5)

This issue affects Smuxi, see <a href="https://smuxi.im/issues/show/1084">https://smuxi.im/issues/show/1084</a></pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mirco Bauer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-25 17:34:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">meebey@redhorse:~/Downloads$ mcs subthread-exit.cs
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting

^C
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting
meebey@redhorse:~/Downloads$ mono subthread-exit.exe
Thread running
Thread exiting
^C
meebey@redhorse:~/Downloads$</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-25 17:54:31 UTC
        </span>

      </div>




<pre class="bz_comment_text">Hmm, this seemed to fix our problem: <a href="https://github.com/mono/mono/commit/23e34d77f2fd23ab5d61f6ba4aa905817f57668a">https://github.com/mono/mono/commit/23e34d77f2fd23ab5d61f6ba4aa905817f57668a</a>

But that's from September and would pre-date 4.2.1?</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jo Shields</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-25 18:19:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">It's in master from September, but isn't in any tagged release</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Llewelyn Trahaearn</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-29 23:38:51 UTC
        </span>

      </div>




<pre class="bz_comment_text">I can confirm that this issue effects Smuxi on my 64-bit Arch Linux system based around an Intel Nehalem i7. The test application subthread-exit hangs after attempting to run it successively in loop under the current 4.2.2.30 release from the Arch repository.

Pulling the modified mono-context.h from <a href="https://github.com/mono/mono/commit/23e34d77f2fd23ab5d61f6ba4aa905817f57668a">https://github.com/mono/mono/commit/23e34d77f2fd23ab5d61f6ba4aa905817f57668a</a> into a build of 4.2.2.30 resolves the issue. Smuxi exits as expected and the test application subthread-exit executed correctly over a thousand times before I finally interrupted the loop.

A copy of the PKGBUILD is available here for inspection: <a href="https://gist.github.com/WoefulDerelict/568619501509d7a75281">https://gist.github.com/WoefulDerelict/568619501509d7a75281</a></pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mirco Bauer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-01-30 11:07:47 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thank you for testing the patch. So the fix should get cherry-picked for the other release branches.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jo Shields</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-02-01 11:09:39 UTC
        </span>

      </div>




<pre class="bz_comment_text">This commit is already in the branch for the next major release

I don't know if we plan to make another minor release based on the current major - I need to wait for the east coast to wake up for a definitive answer. If yes, I'll ask for the required QA approval to cherry-pick to that branch. Meanwhile, I'd recommend to downstreams that they cherry-pick this fix at a distribution level to their 4.2.2 packages.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-10-13 14:17:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">A similar problem exists with 4.8 that rears its head more often. From the person running the test suite:

- It happens every time but I have to run all the tests, if I just run the 1
suite of tests its hanging in then it will work . It's like something is
happening in the other tests that's building up to when it hits this point and
can not exit anymore.

- I did find the offending code in the Environment.Exit which was trying to do
threading shutdown and commented it out and everything worked ok but 
what are the consequences of not doing this cleanup

- I did notice too some fixme comments on this method mentioning there is some
hanging issues they are trying to figure out too.

Problem description - 

When running tests using mono-4.8, eventually exiting the nunitrunner will get stuck trying to shutdown. In past releases this problem would arise sporadically but is now happening consistently:

(gdb) thr apply all bt

Thread 13 (Thread 0x7f4b691f9700 (LWP 121322)):
#0  0x00007f4b6fd046d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x000000000072558f in mono_os_cond_wait (mutex=0xb21680 &lt;lock&gt;, cond=0xb21640 &lt;work_cond&gt;)
    at ../../mono/utils/mono-os-mutex.h:150
#2  thread_func (thread_data=0x0) at sgen-thread-pool.c:110
#3  0x00007f4b6fd00dc5 in start_thread () from /lib64/libpthread.so.0
#4  0x00007f4b6f817ced in clone () from /lib64/libc.so.6

Thread 12 (Thread 0x7f4b66ada700 (LWP 121323)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x00000000005c69fc in mono_os_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0xb119e0 &lt;finalizer_sem&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_coop_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0xb119e0 &lt;finalizer_sem&gt;)
    at ../../mono/utils/mono-coop-semaphore.h:40
#3  finalizer_thread (unused=unused@entry=0x0) at gc.c:905
#4  0x00000000005a3c6c in start_wrapper_internal (stack_ptr=0x7f4b66ad9de8, start_info=0x0) at threads.c:760
#5  start_wrapper (data=0x1dcd880) at threads.c:824
#6  0x000000000074d33b in inner_start_thread (data=0x1dcd8e0) at mono-threads.c:1181
#7  0x00007f4b6fd00dc5 in start_thread () from /lib64/libpthread.so.0
#8  0x00007f4b6f817ced in clone () from /lib64/libc.so.6

Thread 11 (Thread 0x7f4b637ac700 (LWP 121324)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b4c000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b4c0008c0) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3b3c in mono_thread_interruption_checkpoint_request (
    bypass_abort_protection=bypass_abort_protection@entry=1) at threads.c:4544
#5  0x00000000005a498a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4569
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#6  0x000000000047ec29 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#7  0x00000000004b6234 in mono_magic_trampoline (regs=&lt;optimized out&gt;, 
    code=0x416ae074 "L\213\360H\205\300u\336", &lt;incomplete sequence \353\232&gt;, arg=0x1e2f6b0, tramp=&lt;optimized out&gt;)
    at mini-trampolines.c:831
#8  0x0000000041df128c in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 10 (Thread 0x7f4b635ab700 (LWP 121325)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b40000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b400008c0) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3701 in mono_wait_uninterrupted (numhandles=numhandles@entry=1, handles=handles@entry=0x7f4b635aa4a8, 
    waitall=waitall@entry=0, ms=ms@entry=9999, error=error@entry=0x7f4b635aa4b0, thread=&lt;optimized out&gt;) at threads.c:1592
#5  0x00000000005a5856 in ves_icall_System_Threading_WaitHandle_WaitOne_internal (handle=0x406, ms=9999) at threads.c:1722
#6  0x000000004042c338 in ?? ()
#7  0x0000000000000002 in ?? ()
#8  0x00007f4b501d5018 in ?? ()
#9  0x00007f4b501d4fe8 in ?? ()
#10 0x000000000000270f in ?? ()
#11 0x0000000000000000 in ?? ()

Thread 9 (Thread 0x7f4b3deff700 (LWP 121331)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b2c000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b2c0008c0) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3b3c in mono_thread_interruption_checkpoint_request (bypass_abort_protection=&lt;optimized out&gt;)
    at threads.c:4544
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#5  0x00000000416dd81c in ?? ()
#6  0x00007f4b5cadae28 in ?? ()
#7  0x00007f4b5cadadb8 in ?? ()
#8  0x000000000000000d in ?? ()
#9  0x00007f4b3defe750 in ?? ()
#10 0x0000000000000000 in ?? ()

Thread 8 (Thread 0x7f4b3dcfe700 (LWP 121362)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b200044b0)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b20004450) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a5343 in ves_icall_System_Threading_Thread_Sleep_internal (ms=10000) at threads.c:1218
#5  0x00000000405a2932 in ?? ()
#6  0x00007f4b58076ed8 in ?? ()
#7  0x00007f4b58076e68 in ?? ()
#8  0x00007f4b58076e68 in ?? ()
#9  0x00007f4b58076e68 in ?? ()
#10 0x0000000000002710 in ?? ()
#11 0x00007f4b2000d9a0 in ?? ()
#12 0x00007f4b3dcfd310 in ?? ()
#13 0x00007f4b3dcfd840 in ?? ()
#14 0x00007f4b3dcfd360 in ?? ()
#15 0x00000000405a2891 in ?? ()
#16 0x00007f4b58076f30 in ?? ()
#17 0x00007f4b58076f30 in ?? ()
#18 0x00007f4b3dcfd840 in ?? ()
#19 0x00000000408691aa in ?? ()
#20 0x0000000000000000 in ?? ()

---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
Thread 7 (Thread 0x7f4b1bfff700 (LWP 121364)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b14000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b140008c0) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a5343 in ves_icall_System_Threading_Thread_Sleep_internal (ms=5000) at threads.c:1218
#5  0x00000000405a2932 in ?? ()
#6  0x00007f4b5b5cfb58 in ?? ()
#7  0x00007f4b5b5cfae8 in ?? ()
#8  0x00007f4b5b5cfae8 in ?? ()
#9  0x00007f4b5b5cfae8 in ?? ()
#10 0x0000000000001388 in ?? ()
#11 0x00007f4b14002200 in ?? ()
#12 0x0000000000000000 in ?? ()

Thread 6 (Thread 0x7f4b1b3fb700 (LWP 121397)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4afc000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4afc0008c0) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a5343 in ves_icall_System_Threading_Thread_Sleep_internal (ms=3000) at threads.c:1218
#5  0x00000000405a2932 in ?? ()
#6  0x00007f4b5bf2dbd8 in ?? ()
#7  0x00007f4b1b3fa7e8 in ?? ()
#8  0x00007f4b5bf2dab0 in ?? ()
#9  0x00007f4b59e99868 in ?? ()
#10 0x0000000000000bb8 in ?? ()
#11 0x00007f4afc001d90 in ?? ()
#12 0x00007f4b1b3fa6d0 in ?? ()
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#13 0x00007f4b1b3fa840 in ?? ()
#14 0x00007f4b1b3fa710 in ?? ()
#15 0x00000000405a2891 in ?? ()
#16 0x00007f4b59e99868 in ?? ()
#17 0x0000000040928c4c in ?? ()
#18 0x0000000040928c1c in ?? ()
#19 0x0000000040928a1a in ?? ()
#20 0x00007f4b5bf2dc30 in ?? ()
#21 0x0000000040429694 in ?? ()
#22 0x5f74656700656b6f in ?? ()
#23 0x00007f4b5bf2dab0 in ?? ()
#24 0x0000000002782c98 in ?? ()
#25 0x0000000000000000 in ?? ()

Thread 5 (Thread 0x7f4b3f2d2700 (LWP 121944)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074ae82 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f4b0400caa0)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f4b0400ca40) at mono-threads.c:156
#3  0x00000000005a34ed in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3b3c in mono_thread_interruption_checkpoint_request (
    bypass_abort_protection=bypass_abort_protection@entry=1) at threads.c:4544
#5  0x00000000005a498a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4569
#6  0x000000000047ec29 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#7  0x00000000004b6234 in mono_magic_trampoline (regs=&lt;optimized out&gt;, 
    code=0x404baba0 "H\213\310D\211}\260H\211M\270H\205\300t\020H\213E\270H\213\370\350\004\200\223\001\306E\250", 
    arg=0x1e2f6b0, tramp=&lt;optimized out&gt;) at mini-trampolines.c:831
#8  0x0000000041df128c in ?? ()
#9  0x00007f4b3f2d160c in ?? ()
#10 0x00007f4b04009065 in ?? ()
#11 0x00000000404baba0 in ?? ()
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#12 0x0000000000871a10 in ?? ()
#13 0x00007f4b3f2d16d0 in ?? ()
#14 0x00007f4b3f2d1588 in ?? ()
#15 0x00007f4b3f2d26c0 in ?? ()
#16 0x0000000000000001 in ?? ()
#17 0x0000000000000000 in ?? ()

Thread 4 (Thread 0x7f4b1b7fd700 (LWP 121945)):
#0  0x00007f4b6f756972 in sigsuspend () from /lib64/libc.so.6
#1  0x000000000074e876 in suspend_signal_handler (_dummy=&lt;optimized out&gt;, info=&lt;optimized out&gt;, context=0x7f4b1b7fc040)
    at mono-threads-posix-signals.c:208
#2  &lt;signal handler called&gt;
#3  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#4  0x000000000041fc9a in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#5  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f4b00001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#6  mono_coop_sem_timedwait (sem=0x7f4b00001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#7  0x00000000005ca246 in mono_monitor_try_enter_inflated (id=72, allow_interruption=1, ms=4294967295, obj=0x7f4b3ca162a8)
    at monitor.c:886
#8  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f4b3ca162a8, ms=&lt;optimized out&gt;) at monitor.c:1310
#9  0x00000000404bab83 in ?? ()
#10 0x00007f4b00000008 in ?? ()
#11 0x00007f4b3ca162a8 in ?? ()
#12 0x0000000000000000 in ?? ()

Thread 3 (Thread 0x7f4b1b5fc700 (LWP 121946)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fc9a in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f4b00001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f4b00001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005ca246 in mono_monitor_try_enter_inflated (id=78, allow_interruption=1, ms=4294967295, obj=0x7f4b3ca162a8)
    at monitor.c:886
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f4b3ca162a8, ms=&lt;optimized out&gt;) at monitor.c:1310
#6  0x00000000404bab83 in ?? ()
#7  0x00007f4b00000008 in ?? ()
#8  0x00007f4b3ca162a8 in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 2 (Thread 0x7f4b1b1fa700 (LWP 121948)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fc9a in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f4b00001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f4b00001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005ca246 in mono_monitor_try_enter_inflated (id=79, allow_interruption=1, ms=4294967295, obj=0x7f4b3ca162a8)
    at monitor.c:886
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f4b3ca162a8, ms=&lt;optimized out&gt;) at monitor.c:1310
#6  0x00000000404bab83 in ?? ()
#7  0x00007f4b00000008 in ?? ()
#8  0x00007f4b3ca162a8 in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f4b70823780 (LWP 121321)):
#0  0x00007f4b6fd06790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074b87c in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (sem=0xb222e0 &lt;suspend_semaphore&gt;, flags=MONO_SEM_FLAGS_NONE, timeout_ms=4294967295)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_threads_wait_pending_operations () at mono-threads.c:241
#4  0x000000000074c55d in suspend_sync (interrupt_kernel=1, tid=139960560637696) at mono-threads.c:928
#5  suspend_sync_nolock (interrupt_kernel=1, id=139960560637696) at mono-threads.c:945
#6  mono_thread_info_safe_suspend_and_run (id=139960560637696, interrupt_kernel=1, 
    callback=callback@entry=0x59e5c0 &lt;async_suspend_critical&gt;, user_data=user_data@entry=0x7ffe116ac6d0)
    at mono-threads.c:988
#7  0x000000000059ee3c in async_suspend_internal (thread=0x7f4ab6d0bc30, interrupt=&lt;optimized out&gt;) at threads.c:4867
#8  0x00000000005a204c in mono_thread_suspend_all_other_threads () at threads.c:3385
#9  0x000000000054d8d6 in ves_icall_System_Environment_Exit (result=0) at icall.c:6772
#10 0x00000000416eabd2 in ?? ()
#11 0x00007f4b500007c0 in ?? ()
#12 0x00007f4b500c1620 in ?? ()
#13 0x00007f4b500c2420 in ?? ()
#14 0x0000000000000000 in ?? ()</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-10-13 17:29:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">The area in question is in Icall.c.ves_icall_System_environment_exit(). Note the big fixme note. I'm not sure which one it was but I commented out these 2 lines in the method: 

Mono_thread_suspend_app_other_thread(); 
Mono_runtime_quit(); 

With those commented out all our tests and integration tests all worked without a problem but Im not sure what kind of problems it has with .net. Regardless, something in there trying to suspend threads seems to be a problem.</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-10-21 15:56:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">The symptoms sometimes change. In this case there are no more messages after the last one listed here:

-------------- Start of Thread Suspension ---------------
2016-10-21 07:28:38 [113058] SUSPENDING tid 0x7fb448768700
2016-10-21 07:28:38 [113058] ------ BEGIN GLOBAL OP sp 0 rp 0 ap 0 wd 0 po 0 (sp + rp + ap == wd) (wd == po)
2016-10-21 07:28:38 [113058] [ASYNC_SUSPEND_REQUESTED][0x7fb448768700] RUNNING -&gt; ASYNC_SUSPEND_REQUESTED (0 -&gt; 1)
2016-10-21 07:28:38 [113058] sending signal 39 to 0x7fb42c0008c0[0x7fb448768700]
2016-10-21 07:28:38 [113058] added 0x7fb448768700 to pending suspend
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-COUNT] 1
2016-10-21 07:28:38 [113058] SIGNAL HANDLER FOR 0x7fb448768700 [(nil)]
2016-10-21 07:28:38 [113058] [FINISH_ASYNC_SUSPEND][0x7fb448768700] ASYNC_SUSPEND_REQUESTED -&gt; ASYNC_SUSPENDED (1 -&gt; 1)
2016-10-21 07:28:38 [113058] [INITIATOR-NOTIFY-SUSPEND] 0x7fb448768700
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-WAITING]
2016-10-21 07:28:38 [113058] Suspending 1 threads took 0 ms.
2016-10-21 07:28:38 [113058] interrupt prepare    tid 0x7fb448768700 token 0x7fb42c005a30
2016-10-21 07:28:38 [113058] [RESUME][0x7fb448768700] ASYNC_SUSPENDED -&gt; RUNNING (1 -&gt; 0)
2016-10-21 07:28:38 [113058] added 0x7fb448768700 to pending suspend
2016-10-21 07:28:38 [113058] sending signal 37 to 0x7fb42c0008c0[0x7fb448768700]
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-COUNT] 1
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-WAITING]
2016-10-21 07:28:38 [113058] [INITIATOR-NOTIFY-RESUME] 0x7fb448768700
2016-10-21 07:28:38 [113058] Suspending 1 threads took 0 ms.
2016-10-21 07:28:38 [113058] ------ END GLOBAL OP sp 1 rp 1 ap 0 wd 2 po 2
2016-10-21 07:28:38 [113058] interrupt finish     token 0x7fb42c005a30
2016-10-21 07:28:38 [113058] SUSPENDING tid 0x7fb448969700
2016-10-21 07:28:38 [113058] ------ BEGIN GLOBAL OP sp 1 rp 1 ap 0 wd 2 po 2 (sp + rp + ap == wd) (wd == po)
2016-10-21 07:28:38 [113058] [ASYNC_SUSPEND_REQUESTED][0x7fb448969700] RUNNING -&gt; ASYNC_SUSPEND_REQUESTED (0 -&gt; 1)
2016-10-21 07:28:38 [113058] sending signal 39 to 0x7fb4280008c0[0x7fb448969700]
2016-10-21 07:28:38 [113058] added 0x7fb448969700 to pending suspend
2016-10-21 07:28:38 [113058] interrupt uninstall  tid 0x7fb448768700 previous_token 0xffffffffffffffff interrupted TRUE
2016-10-21 07:28:38 [113058] interrupt clear self tid 0x7fb448768700 previous_token (nil)
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-COUNT] 1
2016-10-21 07:28:38 [113058] BEGIN SELF SUSPEND OF 0x7fb42c0008c0
2016-10-21 07:28:38 [113058] SIGNAL HANDLER FOR 0x7fb448969700 [(nil)]
2016-10-21 07:28:38 [113058] [SELF_SUSPEND_REQUEST][0x7fb448768700] RUNNING -&gt; SELF_SUSPEND_REQUESTED (0 -&gt; 1)
2016-10-21 07:28:38 [113058] FINISH SELF SUSPEND OF 0x7fb42c0008c0
2016-10-21 07:28:38 [113058] [STATE_POLL][0x7fb448768700] SELF_SUSPEND_REQUESTED -&gt; SELF_SUSPENDED (1 -&gt; 1)
2016-10-21 07:28:38 [113058] [FINISH_ASYNC_SUSPEND][0x7fb448969700] ASYNC_SUSPEND_REQUESTED -&gt; ASYNC_SUSPENDED (1 -&gt; 1)
2016-10-21 07:28:38 [113058] [INITIATOR-NOTIFY-SUSPEND] 0x7fb448969700
2016-10-21 07:28:38 [113058] **WAIT self-resume 0x7fb448768700
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-WAITING]
2016-10-21 07:28:38 [113058] Suspending 1 threads took 0 ms.
2016-10-21 07:28:38 [113058] interrupt prepare    tid 0x7fb448969700 token 0x7fb42800e900
2016-10-21 07:28:38 [113058] [RESUME][0x7fb448969700] ASYNC_SUSPENDED -&gt; RUNNING (1 -&gt; 0)
2016-10-21 07:28:38 [113058] added 0x7fb448969700 to pending suspend
2016-10-21 07:28:38 [113058] sending signal 37 to 0x7fb4280008c0[0x7fb448969700]
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-COUNT] 1
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-WAITING]
2016-10-21 07:28:38 [113058] [INITIATOR-NOTIFY-RESUME] 0x7fb448969700
2016-10-21 07:28:38 [113058] Suspending 1 threads took 0 ms.
2016-10-21 07:28:38 [113058] interrupt uninstall  tid 0x7fb448969700 previous_token 0xffffffffffffffff interrupted TRUE
2016-10-21 07:28:38 [113058] ------ END GLOBAL OP sp 2 rp 2 ap 0 wd 4 po 4
2016-10-21 07:28:38 [113058] interrupt finish     token 0x7fb42800e900
2016-10-21 07:28:38 [113058] ------ BEGIN GLOBAL OP sp 2 rp 2 ap 0 wd 4 po 4 (sp + rp + ap == wd) (wd == po)
2016-10-21 07:28:38 [113058] sending signal 39 to 0x7fb4280008c0[0x7fb448969700]
2016-10-21 07:28:38 [113058] added 0x7fb448969700 to pending suspend
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-COUNT] 1
2016-10-21 07:28:38 [113058] [INITIATOR-WAIT-WAITING]

The traceback looks like this:

(gdb) thread apply all bt

Thread 13 (Thread 0x7f18f68ac700 (LWP 8570)):
#0  0x00007f18fd3b76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x000000000072564f in mono_os_cond_wait (mutex=0xb22680 &lt;lock&gt;, cond=0xb22640 &lt;work_cond&gt;)
    at ../../mono/utils/mono-os-mutex.h:150
#2  thread_func (thread_data=0x0) at sgen-thread-pool.c:110
#3  0x00007f18fd3b3dc5 in start_thread () from /lib64/libpthread.so.0
#4  0x00007f18fcecaced in clone () from /lib64/libc.so.6

Thread 12 (Thread 0x7f18f418d700 (LWP 8571)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x00000000005c6aac in mono_os_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0xb129e0 &lt;finalizer_sem&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_coop_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0xb129e0 &lt;finalizer_sem&gt;)
    at ../../mono/utils/mono-coop-semaphore.h:40
#3  finalizer_thread (unused=unused@entry=0x0) at gc.c:905
#4  0x00000000005a3d1c in start_wrapper_internal (stack_ptr=0x7f18f418cde8, start_info=0x0) at threads.c:760
#5  start_wrapper (data=0x1f21890) at threads.c:824
#6  0x000000000074dedb in inner_start_thread (data=0x1f218f0) at mono-threads.c:1181
#7  0x00007f18fd3b3dc5 in start_thread () from /lib64/libpthread.so.0
#8  0x00007f18fcecaced in clone () from /lib64/libc.so.6

Thread 11 (Thread 0x7f18f0e55700 (LWP 8572)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18dc000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18dc0008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3bec in mono_thread_interruption_checkpoint_request (
    bypass_abort_protection=bypass_abort_protection@entry=1) at threads.c:4544
#5  0x00000000005a4a3a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4569
#6  0x000000000047ecc9 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#7  0x00000000004b62c4 in mono_magic_trampoline (regs=&lt;optimized out&gt;,
    code=0x41e21f84 "L\213\360H\205\300u\336", &lt;incomplete sequence \353\232&gt;, arg=0x1f836c0, tramp=&lt;optimized out&gt;)
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
    at mini-trampolines.c:831
#8  0x000000004063028c in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 10 (Thread 0x7f18f0c54700 (LWP 8573)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18d0000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18d00008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a37b1 in mono_wait_uninterrupted (numhandles=numhandles@entry=1, handles=handles@entry=0x7f18f0c534a8,
    waitall=waitall@entry=0, ms=ms@entry=4184, error=error@entry=0x7f18f0c534b0, thread=&lt;optimized out&gt;)
    at threads.c:1592
#5  0x00000000005a5906 in ves_icall_System_Threading_WaitHandle_WaitOne_internal (handle=0x406, ms=4184)
    at threads.c:1722
#6  0x0000000040f20338 in ?? ()
#7  0x0000000000000002 in ?? ()
#8  0x00007f18e01d52d0 in ?? ()
#9  0x00007f18e01d52a0 in ?? ()
#10 0x0000000000001058 in ?? ()
#11 0x0000000000000000 in ?? ()

Thread 9 (Thread 0x7f18c35ff700 (LWP 8579)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18b0000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18b00008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3bec in mono_thread_interruption_checkpoint_request (bypass_abort_protection=&lt;optimized out&gt;)
    at threads.c:4544
#5  0x0000000041e5181c in ?? ()
#6  0x00007f18ecad9cf8 in ?? ()
#7  0x00007f18ecad9c88 in ?? ()
#8  0x000000000000000d in ?? ()
#9  0x00007f18c35fe750 in ?? ()
#10 0x0000000000000000 in ?? ()

Thread 8 (Thread 0x7f18c33fe700 (LWP 8611)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18b40044b0)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18b4004450) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a53f3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=10000) at threads.c:1218
#5  0x0000000041096932 in ?? ()
#6  0x00007f18e8077500 in ?? ()
#7  0x00007f18e8077490 in ?? ()
#8  0x00007f18e8077490 in ?? ()
#9  0x00007f18e8077490 in ?? ()
#10 0x0000000000002710 in ?? ()
#11 0x00007f18b400cc80 in ?? ()
#12 0x00007f18c33fd310 in ?? ()
#13 0x00007f18c33fd840 in ?? ()
#14 0x00007f18c33fd360 in ?? ()
#15 0x0000000041096891 in ?? ()
#16 0x00007f18e8077558 in ?? ()
#17 0x00007f18e8077558 in ?? ()
#18 0x00007f18c33fd840 in ?? ()
#19 0x000000004135c95a in ?? ()
#20 0x0000000000000000 in ?? ()

Thread 7 (Thread 0x7f18a96ff700 (LWP 8613)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18a4000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18a40008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a53f3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=5000) at threads.c:1218
#5  0x0000000041096932 in ?? ()
#6  0x00007f18eb5cfa00 in ?? ()
#7  0x00007f18eb5cf990 in ?? ()
#8  0x00007f18eb5cf990 in ?? ()
#9  0x00007f18eb5cf990 in ?? ()
#10 0x0000000000001388 in ?? ()
#11 0x00007f18a4002200 in ?? ()
#12 0x0000000000000000 in ?? ()

Thread 6 (Thread 0x7f18a8afb700 (LWP 8654)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f188c000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f188c0008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a53f3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=3000) at threads.c:1218
#5  0x0000000041096932 in ?? ()
#6  0x00007f18ebf2c740 in ?? ()
#7  0x00007f18a8afa7e8 in ?? ()
#8  0x00007f18ebf2c618 in ?? ()
#9  0x00007f18e1e097a8 in ?? ()
#10 0x0000000000000bb8 in ?? ()
#11 0x00007f188c001d90 in ?? ()
#12 0x00007f18a8afa6d0 in ?? ()
#13 0x00007f18a8afa840 in ?? ()
#14 0x00007f18a8afa710 in ?? ()
#15 0x0000000041096891 in ?? ()
#16 0x00007f18e1e097a8 in ?? ()
#17 0x000000004141861c in ?? ()
#18 0x00000000414185ec in ?? ()
#19 0x00000000414183ea in ?? ()
#20 0x00007f18ebf2c798 in ?? ()
#21 0x0000000040f1d694 in ?? ()
#22 0x206f6e2700656b6f in ?? ()
#23 0x00007f18ebf2c618 in ?? ()
#24 0x00000000028d2a58 in ?? ()
#25 0x0000000000000000 in ?? ()

Thread 5 (Thread 0x7f18a8cfc700 (LWP 9000)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074afc2 in mono_os_sem_wait (flags=MONO_SEM_FLAGS_NONE, sem=0x7f18c4000920)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_thread_info_wait_for_resume (info=0x7f18c40008c0) at mono-threads.c:156
#3  0x00000000005a359d in mono_thread_execute_interruption () at threads.c:4424
#4  0x00000000005a3bec in mono_thread_interruption_checkpoint_request (
    bypass_abort_protection=bypass_abort_protection@entry=1) at threads.c:4544
#5  0x00000000005a4a3a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4569
#6  0x000000000047ecc9 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#7  0x00000000004b62c4 in mono_magic_trampoline (regs=&lt;optimized out&gt;,
    code=0x40faeba0 "H\213\310D\211}\260H\211M\270H\205\300t\020H\213E\270H\213\370\350\004\060h\377\306E\250",
    arg=0x1f836c0, tramp=&lt;optimized out&gt;) at mini-trampolines.c:831
#8  0x000000004063028c in ?? ()
#9  0x00007f18a8cfb60c in ?? ()
#10 0x00007f18c4001d95 in ?? ()
#11 0x0000000040faeba0 in ?? ()
#12 0x0000000000872a10 in ?? ()
#13 0x00007f18a8cfb6d0 in ?? ()
#14 0x00007f18a8cfb588 in ?? ()
#15 0x00007f18a8cfc6c0 in ?? ()
#16 0x0000000000000001 in ?? ()
#17 0x0000000000000000 in ?? ()

Thread 4 (Thread 0x7f18a88fa700 (LWP 9002)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fcda in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1890001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f1890001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005ca2f6 in mono_monitor_try_enter_inflated (id=84, allow_interruption=1, ms=4294967295,
    obj=0x7f18c240ecf0) at monitor.c:886
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f18c240ecf0, ms=&lt;optimized out&gt;) at monitor.c:1310
#6  0x0000000040faeb83 in ?? ()
#7  0x00007f1800000008 in ?? ()
#8  0x00007f18c240ecf0 in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 3 (Thread 0x7f18a90fe700 (LWP 9003)):
#0  0x00007f18fce09972 in sigsuspend () from /lib64/libc.so.6
#1  0x000000000074f416 in suspend_signal_handler (_dummy=&lt;optimized out&gt;, info=&lt;optimized out&gt;, context=0x7f18a90fd040)
    at mono-threads-posix-signals.c:208
#2  &lt;signal handler called&gt;
#3  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#4  0x000000000041fcda in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#5  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1890001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#6  mono_coop_sem_timedwait (sem=0x7f1890001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#7  0x00000000005ca2f6 in mono_monitor_try_enter_inflated (id=85, allow_interruption=1, ms=4294967295,
    obj=0x7f18c240ecf0) at monitor.c:886
#8  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f18c240ecf0, ms=&lt;optimized out&gt;) at monitor.c:1310
#9  0x0000000040faeb83 in ?? ()
#10 0x00007f1800000008 in ?? ()
#11 0x00007f18c240ecf0 in ?? ()
#12 0x0000000000000000 in ?? ()

Thread 2 (Thread 0x7f18a8efd700 (LWP 9005)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fcda in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1890001dc0)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f1890001dc0, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005ca2f6 in mono_monitor_try_enter_inflated (id=86, allow_interruption=1, ms=4294967295,
    obj=0x7f18c240ecf0) at monitor.c:886
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f18c240ecf0, ms=&lt;optimized out&gt;) at monitor.c:1310
#6  0x0000000040faeb83 in ?? ()
#7  0x00007f1800000008 in ?? ()
#8  0x00007f18c240ecf0 in ?? ()
#9  0x0000000000000000 in ?? ()

Thread 1 (Thread 0x7f18fded6780 (LWP 8569)):
#0  0x00007f18fd3b9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000074c33c in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (sem=0xb232e0 &lt;suspend_semaphore&gt;, flags=MONO_SEM_FLAGS_NONE, timeout_ms=4294967295)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_threads_wait_pending_operations () at mono-threads.c:241
#4  0x000000000074d0fd in suspend_sync (interrupt_kernel=1, tid=139743892334336) at mono-threads.c:928
#5  suspend_sync_nolock (interrupt_kernel=1, id=139743892334336) at mono-threads.c:945
#6  mono_thread_info_safe_suspend_and_run (id=139743892334336, interrupt_kernel=1,
    callback=callback@entry=0x59e670 &lt;async_suspend_critical&gt;, user_data=user_data@entry=0x7ffcfc2a8b70)
    at mono-threads.c:988
#7  0x000000000059eeec in async_suspend_internal (thread=0x7f1865bed430, interrupt=&lt;optimized out&gt;) at threads.c:4867
#8  0x00000000005a20fc in mono_thread_suspend_all_other_threads () at threads.c:3385
#9  0x000000000054d97c in ves_icall_System_Environment_Exit (result=0) at icall.c:6774
#10 0x0000000041e5ebd2 in ?? ()
#11 0x00007f18e00007c0 in ?? ()
#12 0x00007f18e00c1620 in ?? ()
#13 0x00007f18e00c2420 in ?? ()
#14 0x0000000000000000 in ?? ()
(gdb)</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-10-26 17:27:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="https://bugzilla.xamarin.com/attachment.cgi?id=18236&amp;file=thread.list" name="attach_18236" title="MonoThreadInfo dump and Thread Backtrace">attachment 18236</a> <a href="https://bugzilla.xamarin.com/attachment.cgi?id=18236&amp;file=thread.list" title="MonoThreadInfo dump and Thread Backtrace">[details]</a></span>
MonoThreadInfo dump and Thread Backtrace

When the hang was detected we used gdb to examine the threads. Attached are the MonoThreadInfo contents for all of the threads in the thread_list. At the bottom of that output is the output of gdb's thr apply all bt command. I am not sure how easy it would be to correlate the two lots of output.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-11-15 22:51:52 UTC
        </span>

      </div>




<pre class="bz_comment_text">After applying the recent sets of patches related to thread suspend/resume, the problem has not gone away. It's interesting with the patch it patched mono-threads-posix.c  in mono_threads_suspend_begin_async_resume but it seems that it was hanging in mono_threads_suspend_begin_async_suspend doing mono_threads_pthread_kill  so we are in the area but not in the resume but rather in the suspend. Here is the full stack:
 
(gdb) thread apply all bt
 
Thread 13 (Thread 0x7f15b93dc700 (LWP 12174)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x00000000006372bf in mono_os_cond_wait (mutex=0x9c5c60 &lt;lock&gt;, cond=0x9c5c20 &lt;work_cond&gt;) at ../../mono/utils/mono-os-mutex.h:146
#2  thread_func (thread_data=0x7f15c0a1f008) at sgen-thread-pool.c:110
#3  0x00007f15bfee3dc5 in start_thread () from /lib64/libpthread.so.0
#4  0x00007f15bf9faced in clone () from /lib64/libc.so.6
 
Thread 12 (Thread 0x7f15b6c25700 (LWP 12175)):
#0  0x00007f15bfee9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x00000000005cfe7c in mono_os_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0x9b6900 &lt;finalizer_sem&gt;)
    at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_coop_sem_wait (flags=MONO_SEM_FLAGS_ALERTABLE, sem=0x9b6900 &lt;finalizer_sem&gt;) at ../../mono/utils/mono-coop-semaphore.h:40
#3  finalizer_thread (unused=unused@entry=0x0) at gc.c:907
#4  0x00000000005aa996 in start_wrapper_internal (stack_ptr=0x7f15b6c24de8, start_info=0x0) at threads.c:851
#5  start_wrapper (data=0xd16570) at threads.c:902
#6  0x0000000000658d3b in inner_start_thread (data=0xd165d0) at mono-threads.c:1133
#7  0x00007f15bfee3dc5 in start_thread () from /lib64/libpthread.so.0
#8  0x00007f15bf9faced in clone () from /lib64/libc.so.6
 
Thread 11 (Thread 0x7f15b38e0700 (LWP 12177)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f15b38df320) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f15b38df398, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x115dac0, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005aa50c in mono_thread_interruption_checkpoint_request (bypass_abort_protection=bypass_abort_protection@entry=1)
    at threads.c:4440
#7  0x00000000005ab81a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4465
#8  0x000000000047fe39 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#9  0x00000000004b76d4 in mono_magic_trampoline (regs=&lt;optimized out&gt;,
    code=0x41a25404 "L\213\360H\205\300u\336", &lt;incomplete sequence \353\232&gt;, arg=0xda1cf8, tramp=&lt;optimized out&gt;)
    at mini-trampolines.c:831
#10 0x0000000041c9b38c in ?? ()
#11 0x0000000000000000 in ?? ()
 
Thread 10 (Thread 0x7f15b36df700 (LWP 12178)):
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---   
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f15b36de320) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f15b36de398, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x145f1f0, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005a9f21 in mono_wait_uninterrupted (numhandles=numhandles@entry=1, handles=handles@entry=0x7f15b36de4a8,
    waitall=waitall@entry=0, ms=ms@entry=9660, error=error@entry=0x7f15b36de4b0, thread=&lt;optimized out&gt;) at threads.c:1690
#7  0x00000000005ac856 in ves_icall_System_Threading_WaitHandle_WaitOne_internal (handle=0x402, ms=9660) at threads.c:1810
#8  0x0000000041eb79d8 in ?? ()
#9  0x0000000000000002 in ?? ()
#10 0x00007f15a01d8b98 in ?? ()
#11 0x00007f15a01d8b68 in ?? ()
#12 0x00000000000025bc in ?? ()
#13 0x0000000000000000 in ?? ()
 
Thread 9 (Thread 0x7f156bfff700 (LWP 12192)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f156bffe500) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f156bffe578, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x30c9830, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005aa50c in mono_thread_interruption_checkpoint_request (bypass_abort_protection=&lt;optimized out&gt;) at threads.c:4440
#7  0x0000000041a538ec in ?? ()
#8  0x00007f15aff53db0 in ?? ()
#9  0x00007f15aff53d40 in ?? ()
#10 0x000000000000000d in ?? ()
#11 0x00007f156bffe740 in ?? ()
#12 0x0000000000000000 in ?? ()
 
Thread 8 (Thread 0x7f156bdfe700 (LWP 12223)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f156bdfd230) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f156bdfd2a8, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x3d68900, timeout=timeout@entry=4294967295) at os-event-unix.c:93
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005ac3a3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=10000) at threads.c:1318
#7  0x000000004203ffd2 in ?? ()
#8  0x00007f15ab606780 in ?? ()
#9  0x00007f15ab606710 in ?? ()
#10 0x00007f15ab606710 in ?? ()
#11 0x00007f15ab606710 in ?? ()
#12 0x0000000000002710 in ?? ()
#13 0x00007f155c00c580 in ?? ()
#14 0x00007f156bdfd320 in ?? ()
#15 0x00007f156bdfd840 in ?? ()
#16 0x00007f156bdfd370 in ?? ()
#17 0x000000004203ff31 in ?? ()
#18 0x00007f15ab6067d0 in ?? ()
#19 0x00007f15ab6067d0 in ?? ()
#20 0x00007f156bdfd840 in ?? ()
#21 0x00000000422ea1ee in ?? ()
#22 0x00007f156bdfd5b0 in ?? ()
#23 0x00000000005d7238 in mono_class_vtable (domain=&lt;optimized out&gt;, klass=&lt;optimized out&gt;) at object.c:1765
#24 0x00007f15c09a6708 in ?? ()
#25 0x00000000011f85e0 in ?? ()
#26 0x00000000422e9eb0 in ?? ()
#27 0x00000000011f85e0 in ?? ()
#28 0x0000000000000000 in ?? ()
 
Thread 7 (Thread 0x7f15586ff700 (LWP 12225)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f15586fe570) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f15586fe5e8, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x445bb60, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005ac3a3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=5000) at threads.c:1318
#7  0x000000004203ffd2 in ?? ()
#8  0x00007f15aeab0a60 in ?? ()
#9  0x00007f15aeab09f0 in ?? ()
#10 0x00007f15aeab09f0 in ?? ()
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#11 0x00007f15aeab09f0 in ?? ()
#12 0x0000000000001388 in ?? ()
#13 0x00007f1554001dd0 in ?? ()
#14 0x0000000000000000 in ?? ()
 
Thread 6 (Thread 0x7f15537fb700 (LWP 12259)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f15537fa5d0) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f15537fa648, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x7f153800dca0, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005ac3a3 in ves_icall_System_Threading_Thread_Sleep_internal (ms=3000) at threads.c:1318
#7  0x000000004203ffd2 in ?? ()
#8  0x00007f15af41e9f8 in ?? ()
#9  0x00007f15537fa7e8 in ?? ()
#10 0x00007f15af41e8d0 in ?? ()
#11 0x00007f151b382a20 in ?? ()
#12 0x0000000000000bb8 in ?? ()
#13 0x00007f153c001d90 in ?? ()
#14 0x00007f15537fa6d0 in ?? ()
#15 0x00007f15537fa840 in ?? ()
#16 0x00007f15537fa710 in ?? ()
#17 0x000000004203ff31 in ?? ()
#18 0x00007f151b382a20 in ?? ()
#19 0x00000000423a8abb in ?? ()
#20 0x00000000423a8a8b in ?? ()
#21 0x00000000423a885a in ?? ()
#22 0x00007f15af41ea48 in ?? ()
#23 0x0000000041eb4f44 in ?? ()
#24 0x00ff000000000000 in ?? ()
#25 0x00007f15af41e8d0 in ?? ()
#26 0x00000000016ebb88 in ?? ()
#27 0x0000000000000000 in ?? ()
 
Thread 5 (Thread 0x7f15539fc700 (LWP 13541)):
#0  0x00007f15bf939972 in sigsuspend () from /lib64/libc.so.6
#1  0x000000000065a8a6 in suspend_signal_handler (_dummy=&lt;optimized out&gt;, info=&lt;optimized out&gt;, context=0x7f15539fb040)
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
    at mono-threads-posix-signals.c:164
#2  &lt;signal handler called&gt;
#3  0x00007f15bfee9790 in sem_wait () from /lib64/libpthread.so.0
#4  0x000000000041fa01 in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;) at ../../mono/utils/mono-os-semaphore.h:209
#5  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1548009e10)
    at ../../mono/utils/mono-os-semaphore.h:242
#6  mono_coop_sem_timedwait (sem=0x7f1548009e10, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#7  0x00000000005d38d0 in mono_monitor_try_enter_inflated (id=79, allow_interruption=1, ms=4294967295, obj=0x7f15697bb4d0) at monitor.c:905
#8  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f15697bb4d0, ms=&lt;optimized out&gt;) at monitor.c:1358
#9  0x0000000041f3dce3 in ?? ()
#10 0x00007f1500000008 in ?? ()
#11 0x00007f15697bb4d0 in ?? ()
#12 0x0000000000000000 in ?? ()
 
Thread 4 (Thread 0x7f15535fa700 (LWP 13542)):
#0  0x00007f15bfee76d5 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
#1  0x0000000000646d7f in mono_os_cond_wait (mutex=0x9c5dc0 &lt;signal_mutex&gt;, cond=0x7f15535f9360) at mono-os-mutex.h:146
#2  mono_os_event_wait_multiple (events=events@entry=0x7f15535f93d8, nevents=nevents@entry=1, waitall=waitall@entry=1,
    timeout=timeout@entry=4294967295) at os-event-unix.c:186
#3  0x000000000064704f in mono_os_event_wait_one (event=event@entry=0x7f1564003f70, timeout=timeout@entry=4294967295) at os-event-unix.c:93
#4  0x00000000005a571f in self_suspend_internal () at threads.c:4837
#5  0x00000000005a9d0d in mono_thread_execute_interruption () at threads.c:4320
#6  0x00000000005aa50c in mono_thread_interruption_checkpoint_request (bypass_abort_protection=bypass_abort_protection@entry=1)
    at threads.c:4440
#7  0x00000000005ab81a in mono_thread_force_interruption_checkpoint_noraise () at threads.c:4465
#8  0x000000000047fe39 in mono_interruption_checkpoint_from_trampoline () at jit-icalls.c:1909
#9  0x00000000004b76d4 in mono_magic_trampoline (regs=&lt;optimized out&gt;,
    code=0x41f3dd00 "H\213\310D\211}\260H\211M\270H\205\300t\020H\213E\270H\213\370\350\244\357\325\377\306E\250", arg=0xda1cf8,
    tramp=&lt;optimized out&gt;) at mini-trampolines.c:831
#10 0x0000000041c9b38c in ?? ()
#11 0x00007f15535f9608 in ?? ()
#12 0x00007f154002f275 in ?? ()
#13 0x0000000041f3dd00 in ?? ()
#14 0x0000000000708ab0 in ?? ()
#15 0x00007f15535f96d0 in ?? ()
#16 0x00007f15535f9588 in ?? ()
#17 0x00007f15535fa6c0 in ?? ()
#18 0x0000000000000002 in ?? ()
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#19 0x0000000000000000 in ?? ()
 
Thread 3 (Thread 0x7f1553dfe700 (LWP 13543)):
#0  0x00007f15bfee9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fa01 in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;) at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1548009e10)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f1548009e10, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005d38d0 in mono_monitor_try_enter_inflated (id=83, allow_interruption=1, ms=4294967295, obj=0x7f15697bb4d0) at monitor.c:905
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f15697bb4d0, ms=&lt;optimized out&gt;) at monitor.c:1358
#6  0x0000000041f3dce3 in ?? ()
#7  0x00007f1500000008 in ?? ()
#8  0x00007f15697bb4d0 in ?? ()
#9  0x0000000000000000 in ?? ()
 
Thread 2 (Thread 0x7f1553fff700 (LWP 13545)):
#0  0x00007f15bfee9790 in sem_wait () from /lib64/libpthread.so.0
#1  0x000000000041fa01 in mono_os_sem_wait (flags=&lt;optimized out&gt;, sem=&lt;optimized out&gt;) at ../../mono/utils/mono-os-semaphore.h:209
#2  mono_os_sem_timedwait (flags=MONO_SEM_FLAGS_ALERTABLE, timeout_ms=4294967295, sem=0x7f1548009e10)
    at ../../mono/utils/mono-os-semaphore.h:242
#3  mono_coop_sem_timedwait (sem=0x7f1548009e10, timeout_ms=timeout_ms@entry=4294967295, flags=MONO_SEM_FLAGS_ALERTABLE)
    at ../../mono/utils/mono-coop-semaphore.h:54
#4  0x00000000005d38d0 in mono_monitor_try_enter_inflated (id=84, allow_interruption=1, ms=4294967295, obj=0x7f15697bb4d0) at monitor.c:905
#5  ves_icall_System_Threading_Monitor_Monitor_wait (obj=0x7f15697bb4d0, ms=&lt;optimized out&gt;) at monitor.c:1358
#6  0x0000000041f3dce3 in ?? ()
#7  0x00007f1500000008 in ?? ()
#8  0x00007f15697bb4d0 in ?? ()
#9  0x0000000000000000 in ?? ()
 
Thread 1 (Thread 0x7f15c0a06780 (LWP 12173)):
#0  0x00007f15bfee8741 in pthread_kill () from /lib64/libpthread.so.0
#1  0x000000000065a6c8 in mono_threads_pthread_kill (signum=&lt;optimized out&gt;, info=0x7f15380512f0) at mono-threads-posix.c:180
#2  mono_threads_suspend_begin_async_suspend (info=0x7f15380512f0, interrupt_kernel=&lt;optimized out&gt;) at mono-threads-posix.c:267
#3  0x000000000065876b in suspend_sync (interrupt_kernel=1, tid=139729574020864) at mono-threads.c:875
#4  suspend_sync_nolock (interrupt_kernel=1, id=139729574020864) at mono-threads.c:907
#5  mono_thread_info_safe_suspend_and_run (id=139729574020864, interrupt_kernel=1,
    callback=callback@entry=0x5a4da0 &lt;async_suspend_critical&gt;, user_data=user_data@entry=0x7ffdcc2404b0) at mono-threads.c:950
#6  0x00000000005a5656 in async_suspend_internal (thread=0x7f1521eeacc0, interrupt=&lt;optimized out&gt;) at threads.c:4808
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#7  0x00000000005a8896 in mono_thread_suspend_all_other_threads () at threads.c:3281
#8  0x0000000000554ca6 in ves_icall_System_Environment_Exit (result=0) at icall.c:6706
#9  0x0000000041a611a2 in ?? ()
#10 0x00007f15a00007c0 in ?? ()
#11 0x00007f15a00c23f8 in ?? ()
#12 0x00007f15a00c31f0 in ?? ()
#13 0x0000000000000000 in ?? ()
 
2.       For the Reflection.Emit crashing  in the Castle Dynamic proxy , its still hanging in the same spot and the lost log I gave you is the same. Its interesting that the type that  dynamic proxy is bad. Im wondering if some breaking changes to Reflection is tripping up the Dynamic proxy Generator which in turn is giving something bad to the TypeBuilder. Maybe like what we found where Reflection wasn’t giving all the field information related to events. For me these are breaking changes since its changing original functionality  but I was wondering if its possible to find all breaking changes like this since it might help track down this problem?   this was the error anyhow:
This was the error message you wanted me to print:
 
klass: TypeBuilderInstantiation error: Cannot bind generic parameters
<span class="quote">&gt;of a non-generic type assembly:DynamicProxyGenAssembly2
&gt;type:InvocationGetService_74 member:&lt;none&gt;* Assertion at sre.c:1557,
&gt;condition `res' not met</span>
 
This was the original stack :
 
Assertion at sre.c:1553, condition `res' not met
Stacktrace:
 
  at &lt;unknown&gt; &lt;0xffffffff&gt;
  at (wrapper managed-to-native) System.Reflection.Emit.TypeBuilder.create_runtime_class (System.Reflection.Emit.TypeBuilder) &lt;IL 0x00013, 0x0005a&gt;
  at System.Reflection.Emit.TypeBuilder.CreateTypeInfo () [0x0039c] in /build/monoTrunk/mcs/class/corlib/System.Reflection.Emit/TypeBuilder.cs:818
  at System.Reflection.Emit.TypeBuilder.CreateType () [0x00000] in /build/monoTrunk/mcs/class/corlib/System.Reflection.Emit/TypeBuilder.cs:743
  at Castle.DynamicProxy.Generators.Emitters.AbstractTypeEmitter.BuildType () &lt;IL 0x0000e, 0x00049&gt;
  at Castle.DynamicProxy.Generators.InterfaceProxyWithTargetGenerator.GenerateCode (System.Type,System.Type[],Castle.DynamicProxy.ProxyGenerationOptions) &lt;IL 0x007bf, 0x01c9f&gt;
  at Castle.DynamicProxy.DefaultProxyBuilder.CreateInterfaceProxyTypeWithoutTarget (System.Type,System.Type[],Castle.DynamicProxy.ProxyGenerationOptions) &lt;IL 0x0002b, 0x0008f&gt;
  at Castle.DynamicProxy.ProxyGenerator.CreateInterfaceProxyTypeWithoutTarget (System.Type,System.Type[],Castle.DynamicProxy.ProxyGenerationOptions) &lt;IL 0x0000a, 0x0003e&gt;
  at Castle.DynamicProxy.ProxyGenerator.CreateInterfaceProxyWithoutTarget (System.Type,System.Type[],Castle.DynamicProxy.ProxyGenerationOptions,Castle.Core.Interceptor.IInterceptor[]) &lt;IL 0x00072, 0x000d7&gt;
  at Castle.DynamicProxy.ProxyGenerator.CreateInterfaceProxyWithoutTarget (System.Type,System.Type[],Castle.Core.Interceptor.IInterceptor[]) &lt;IL 0x0000a, 0x00037&gt;
  at Rhino.Mocks.MockRepository.MockInterface (Rhino.Mocks.MockRepository/CreateMockState,System.Type,System.Type[]) &lt;IL 0x00069, 0x0025f&gt;
  at Rhino.Mocks.MockRepository.CreateMockObject (System.Type,Rhino.Mocks.MockRepository/CreateMockState,System.Type[],object[]) &lt;IL 0x00081, 0x00107&gt;
  at Rhino.Mocks.MockRepository.CreateMock&lt;T_REF&gt; (object[]) &lt;IL 0x00060, 0x001bf&gt;
  at Drms.Server.ClientFacing.Services.Tests.CaseBrowsingServiceTests.TestGetScenarioManagersForCurrentStudy () [0x00006] in /build/COFLOW/Src/Server/ClientFacing/Services.Tests/CaseBrowsingServiceTests.cs:403
  at (wrapper runtime-invoke) object.runtime_invoke_void__this__ (object,intptr,intptr,intptr) &lt;IL 0x0004f, 0x000b8&gt;
  at &lt;unknown&gt; &lt;0xffffffff&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke (System.Reflection.MonoMethod,object,object[],System.Exception&amp;) &lt;IL 0x00016, 0x0006c&gt;
  at System.Reflection.MonoMethod.Invoke (object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo) [0x00038] in /build/monoTrunk/mcs/class/cor</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-11-24 10:43:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">Just another observation about the finalizing,  I noticed this:
 
/* Try to abort the thread, in the hope that it is running managed code */
                                                                mono_thread_internal_stop (gc_thread);
 
during the finalize there is a very good chance it's in non managed code since during the shutdown finalize we do an interop call into c++ to do some memory cleanup and shutdown. Not sure if that also could have some relationship but Ill throw it out there anyhow.</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-11-28 01:12:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">In gc.c at line 816 its setting the amount of time it waits for the finalizer thread to finish to 2 seconds because as they said Microsoft seems to do that. If I bump it to 20 seconds we no longer get the finalizer crashing so it looks like bumping it up is causing the finalizers to finish properly. The question is first if after the 2 seconds  if the thread isn’t done then it will try and abort the thread which doesn’t seem to cause it to abort.  Given that is there any way to more forcefully kill the thread.  The second question is if there is any harm to increasing the time to wait for it to shutdown and if not could this be increased or configurable given if we know that for our finalizers we will need more time to exit  and no form of aborting will kill it so we need to give it the time it needs to finish?</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zoltan Varga</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-11-30 21:47:28 UTC
        </span>

      </div>




<pre class="bz_comment_text">There is no configuration variable currently to do that, finalizers are expected to finish quickly, they shouldn't take more than 2 seconds to run.</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-01 15:42:30 UTC
        </span>

      </div>




<pre class="bz_comment_text">Is this 2 seconds for all finalizers or 2 seconds per finalizer? This application has around 6 million of them. It appears to need about 6 seconds to run them all. Under .NET it works fine, post mono 4.4 we crash. Similarly, the comment that "/* Try to abort the thread, in the hope that it is running managed code */" may be overly optimistic.

Also, some additional findings:

In mono_gc_cleanup where we were causing the assert regaurding the finalizer thread not exiting Im a little confused by the logic. It will first wait 2 seconds for the finalizer to exit because as they said that’s what Microsoft does. If it hasn’t finished then it will do this:
 
/* Wait for it to stop */
ret = guarded_wait (gc_thread-&gt;handle, 100, TRUE);
 
We wait for the period then if this return comes back with a timeout it will hit this code:
 
if (ret == WAIT_TIMEOUT) {
printf("guarded wait timeout failed!!");                               
/*
 * The finalizer thread refused to die. There is not much we
 * can do here, since the runtime is shutting down so the
 * state the finalizer thread depends on will vanish.
*/
g_warning ("Shutting down finalizer thread timed out.");
timed_out = TRUE;
}
if (!timed_out) {
int ret;
                printf("infinate wait for exit.");                 
                /* Wait for the thread to actually exit */
                ret = guarded_wait (gc_thread-&gt;handle, INFINITE, TRUE);
                g_assert (ret == WAIT_OBJECT_0);
                mono_thread_join (GUINT_TO_POINTER (gc_thread-&gt;tid));
}
 
From what I gather if there is NOT a timeout then  it will do another guarded wait indefinitely. My question would be wouldn’t it be if there was a timeout from the previous wait then what again indefinitely?  In my test that was failing and removed the NOT and my error went away .
 
Actually in my case I found it was taking a total of 6 seconds to finish the finalizers which was more than the 2 seconds it was waiting. It's interesting it was exiting finalizers for WeakReference objects and lots of them, probably around 100,000 of them. I'm still not sure why its taking so long in these finalizers and what its doing but that’s where it is anyhow.
 
Also, this is all coming from our current version of mono of 4.4.2, I was looking in the trunk and it's quite a bit different so I'm wondering if someone noticed strange things and changed it. I noticed now its looking for a return of “MONO_THREAD_INFO_WAIT_RET_TIMEOUT”. Is there something fishy about this code in mono 4.4.2?</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zoltan Varga</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-01 21:32:19 UTC
        </span>

      </div>




<pre class="bz_comment_text">The app really shouldn't have 6m finalizable objects.
About the 4.4 vs master, there were lots of changes, the master code should be better. The 4.4 code didn't actually abort the finalizer thread, it called mono_thread_stop () which does something else. So I'm not sure how that actually worked.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-05 17:28:50 UTC
        </span>

      </div>




<pre class="bz_comment_text">I am not sure I am reading the code correctly. Is the 2 seconds for ALL finalizers or EACH finalizer? .NET appears to allow 2 seconds per finalizer to a maximum of 40 seconds for all finalizers.</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zoltan Varga</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-05 18:09:37 UTC
        </span>

      </div>




<pre class="bz_comment_text">Those values were correct when the code was written I think, which was a long time ago, maybe .net changed them since.</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-06 16:36:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">So, to confirm. The 2 seconds mono uses is the time for all finalizers not each finalizer?</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zoltan Varga</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-06 23:18:16 UTC
        </span>

      </div>




<pre class="bz_comment_text">Yes</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-06 23:29:16 UTC
        </span>

      </div>




<pre class="bz_comment_text">I am trying to look for the canonical reference for the 2 second / 40 second specification, but there are plenty of references in stackoverflow, MSDN fora, Microsoft blogs, programming tutorials, and books such as ".NET Essential Basics". I will look at the code to see how hard it would be to enforce a 2 second per finalizer and 40 seconds overall. In the interim, would just increasing the existing 2 seconds to 40 be viable?</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zoltan Varga</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-06 23:39:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">Yes, it would probably be okay if MS does it.</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a href="bug.html">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neale Ferguson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-12-07 17:26:02 UTC
        </span>

      </div>




<pre class="bz_comment_text">Changing the 2 to 40 is easy. That will cover the ALL finalizer case. To implement the 2 second per finalizer appears a little more complex. I think it needs to be implemented in mono_gc_run_finalize() and, in particular, ensuring whatever is backing runtime_invoke() in this sequence:

        if (log_finalizers)
                g_log ("mono-gc-finalizers", G_LOG_LEVEL_MESSAGE, "&lt;%s at %p&gt; Calling finalizer.", o-&gt;vtable-&gt;klass-&gt;name, o);

        mono_profiler_gc_finalize_object_begin (o);

        runtime_invoke (o, NULL, &amp;exc, NULL);

        mono_profiler_gc_finalize_object_end (o);

        if (log_finalizers)
                g_log ("mono-gc-finalizers", G_LOG_LEVEL_MESSAGE, "&lt;%s at %p&gt; Returned from finalizer.", o-&gt;vtable-&gt;klass-&gt;name, o);

Gets restricted to 2 seconds. Running it on a thread and then using a mutex/timeout to constrain it to the time limit?</pre>
    </div>




</td>
<td>
</td>
</tr></tbody></table>
  </div>


</form>

<hr>


<br>
</div>

    

  
</body></html>
